<Quests>
  <Quest Name="ScriptsResumeOnStart" Priority="-9999" >
    <Events>
      <SessionStart />
    </Events>
    <Actions>
      <ResumeQuests>
        <Error>
          <Fight/>
        </Error>
      </ResumeQuests>
      <Activate ActionID="PseudoSessionStart" Lock="Visible" />
    </Actions>
  </Quest>

  <Quest Name="AttachScripts_Zone1" Priority="9998">
    <Events>
      <ApplicationStart />
    </Events>
    <Actions>
      <AttachQuestFile File="assets/quest_extensions/zone_1/core.xml" />
      <AttachQuestFile File="assets/quest_extensions/zone_1/story.xml" />
      <AttachQuestFile File="assets/quest_extensions/dynamic_discounts.xml" />
      <AttachQuestFile File="assets/quest_extensions/promotions.xml" />
      <SetVariable Name="FreeReminderShown" Value="0" />
      <SetVariable Name="UpgradeToLevelReminderShown" Value="0" />
      <SetVariable Name="LowFpsWarningShown" Value="0" />
    </Actions>
  </Quest>

  <Quest Name="AttachScripts_Zone2" Priority="9999">
    <Events>
      <ApplicationStart />
    </Events>
    <Conditions>
      <Less Value1="?Fight(ZONE_1|BOSS_LYNX|6).WinCount" Value2="1" Not="1" />
    </Conditions>
    <Actions>
      <AttachQuestFile File="assets/quest_extensions/zone_2/core.xml" />
      <AttachQuestFile File="assets/quest_extensions/zone_2/story.xml" />
    </Actions>
  </Quest>

  <Quest Name="AttachScripts_Zone3" Priority="9999">
    <Events>
      <ApplicationStart />
    </Events>
    <Conditions>
      <Less Value1="?Fight(ZONE_2|BOSS_HERMIT|6).WinCount" Value2="1" Not="1" />
    </Conditions>
    <Actions>
      <AttachQuestFile File="assets/quest_extensions/zone_3/core.xml" />
      <AttachQuestFile File="assets/quest_extensions/zone_3/story.xml" />
    </Actions>
  </Quest>

  <Quest Name="AttachScripts_Zone4" Priority="9999">
    <Events>
      <ApplicationStart />
    </Events>
    <Conditions>
      <Less Value1="?Fight(ZONE_3|BOSS_BUTCHER|6).WinCount" Value2="1" Not="1" />
    </Conditions>
    <Actions>
      <AttachQuestFile File="assets/quest_extensions/zone_4/core.xml" />
      <AttachQuestFile File="assets/quest_extensions/zone_4/story.xml" />
    </Actions>
  </Quest>

  <Quest Name="AttachScripts_Zone5" Priority="9999">
    <Events>
      <ApplicationStart />
    </Events>
    <Conditions>
      <Less Value1="?Fight(ZONE_4|BOSS_WASP|6).WinCount" Value2="1" Not="1" />
    </Conditions>
    <Actions>
      <AttachQuestFile File="assets/quest_extensions/zone_5/core.xml" />
      <AttachQuestFile File="assets/quest_extensions/zone_5/story.xml" />
    </Actions>
  </Quest>

  <Quest Name="AttachScripts_Zone6" Priority="9999">
    <Events>
      <ApplicationStart />
    </Events>
    <Conditions>
      <Less Value1="?Fight(ZONE_5|BOSS_HUNTRESS|6).WinCount" Value2="1" Not="1" />
    </Conditions>
    <Actions>
      <AttachQuestFile File="assets/quest_extensions/zone_6/story.xml" />
    </Actions>
  </Quest>

  <Quest Name="AttachScripts_intermission" Priority="9999">
    <Events>
      <ApplicationStart />
    </Events>
    <Conditions>
      <Less Value1="?Fight(ZONE_6|FINAL_BATTLE|1).WinCount" Value2="1" Not="1" />
    </Conditions>
    <Actions>
      <AttachQuestFile File="assets/quest_extensions/intermission/story.xml" />
    </Actions>
  </Quest>

  <Quest Name="CrashNotification" Priority="-100">
    <Events>
      <SessionStart />
    </Events>
    <Conditions>
      <LessEqual Value1="?SysInfo().DeviceTotalMem" Value2="512" />
      <Equal Value1="?SysInfo().LastSessionCrashed" Value2="1" />
      <Equal Value1="?SysInfo().OsName" Value="WINDOWS" Not="1" />
    </Conditions>
    <Actions>
      <Dialog Type="NoAvatar" Title="dlgAlertTitle" >
        <Line Text="dlgCrashNotification"/>
        <Button Type="Right" Color="Beige" Text="dlgStoryBtnOk" />
      </Dialog>
      <ResetCrashFlag />
    </Actions>
  </Quest>

  <Quest Name="EclipseMode_ButtonOn">
    <Events>
      <MapButtonPress />
    </Events>
    <Conditions>
      <Equal Value1="_$ButtonName" Value2="EclipseModeOn" />
    </Conditions>
    <Actions>
      <SetVariable Name="InEclipseMode" Value="1" />
      <ToggleEclipseMode Toggle="On"/>
      <HideMapButton Name="EclipseModeOn"/>
      <ShowMapButton Name="EclipseModeOff" X="?Sub(?Div(?Multi(768, ?SysInfo().DisplayWidth), ?SysInfo().DisplayHeight),440)" Y="600" Image="eclipse"/>
      <SetMapMask Color="0xDBA37D90" />
<!--      <Foreach Type="Battles" Name="HideNormalModeBattles" />
      <Foreach Type="Battles" Name="ShowEclipseModeBattles" />-->
    </Actions>
  </Quest>

<!--  <Quest Name="HideNormalModeBattles">
    <Conditions>
      <Equal Not="1" Value1="?Battle(_$Iterator).Name" Value2="Tournament_ECLIPSEMODE" />
      <Equal Not="1" Value1="?Battle(_$Iterator).Name" Value2="Challenge_ECLIPSEMODE" />
      <Equal Not="1" Value1="?Battle(_$Iterator).Name" Value2="BOSS_LYNX_ECLIPSEMODE" />
      <Equal Not="1" Value1="?Battle(_$Iterator).Name" Value2="BOSS_HERMIT_ECLIPSEMODE" />
      <Equal Not="1" Value1="?Battle(_$Iterator).Name" Value2="BOSS_BUTCHER_ECLIPSEMODE" />
      <Equal Not="1" Value1="?Battle(_$Iterator).Name" Value2="BOSS_WASP_ECLIPSEMODE" />
      <Equal Not="1" Value1="?Battle(_$Iterator).Name" Value2="BOSS_HUNTRESS_ECLIPSEMODE" />
      <Equal Not="1" Value1="?Battle(_$Iterator).Name" Value2="BOSS_SAMURAI_ECLIPSEMODE" />
      <Operator Type="Or">
        <Operator Type="And">
          <Equal Value1="?Battle(_$Iterator).Type" Value2="BOSSES" />
          <GreaterEqual Value1="?Fight(?Concat(_$Iterator,6)).WinCount" Value2="1" />
        </Operator>
        <Operator Type="And">
          <Equal Value1="?Battle(_$Iterator).Type" Value2="TOURNAMENT" />
          <GreaterEqual Value1="?Fight(?Concat(_$Iterator,24)).WinCount" Value2="1" />
        </Operator>
        <Operator Type="And">
          <Equal Value1="?Battle(_$Iterator).Type" Value2="CHALLENGE" />
          <GreaterEqual Value1="?Fight(?Concat(_$Iterator,24)).WinCount" Value2="1" />
        </Operator>
      </Operator>
    </Conditions>
    <Actions>
      <ToggleBattle Name="_$Iterator" Toggle="off" />
    </Actions>
  </Quest>

  <Quest Name="ShowEclipseModeBattles">
    <Conditions>
      <Operator Type="Or" >
        <Operator Type="Or">
          <Operator Type="And">
            <Equal Value1="?Battle(_$Iterator).Name" Value2="Tournament_ECLIPSEMODE" />
            <GreaterEqual Value1="?Fight(?Concat(?Slice(_$Iterator,0,16),|24)).WinCount" Value2="1" />
          </Operator>
          <Operator Type="And">
            <Equal Value1="?Battle(_$Iterator).Name" Value2="Challenge_ECLIPSEMODE" />
            <GreaterEqual Value1="?Fight(?Concat(?Slice(_$Iterator,0,16),|24)).WinCount" Value2="1" />
          </Operator>
          <Operator Type="And">
            <Equal Value1="?Battle(_$Iterator).Name" Value2="BOSS_LYNX_ECLIPSEMODE" />
            <GreaterEqual Value1="?Fight(ZONE_1|BOSS_LYNX|6).WinCount" Value2="1" />
          </Operator>
          <Operator Type="And">
            <Equal Value1="?Battle(_$Iterator).Name" Value2="BOSS_HERMIT_ECLIPSEMODE" />
            <GreaterEqual Value1="?Fight(ZONE_2|BOSS_HERMIT|6).WinCount" Value2="1" />
          </Operator>
          <Operator Type="And">
            <Equal Value1="?Battle(_$Iterator).Name" Value2="BOSS_BUTCHER_ECLIPSEMODE" />
            <GreaterEqual Value1="?Fight(ZONE_3|BOSS_BUTCHER|6).WinCount" Value2="1" />
          </Operator>
          <Operator Type="And">
            <Equal Value1="?Battle(_$Iterator).Name" Value2="BOSS_BUTCHER_ECLIPSEMODE" />
            <GreaterEqual Value1="?Fight(ZONE_3|BOSS_BUTCHER|6).WinCount" Value2="1" />
          </Operator>
          <Operator Type="And">
            <Equal Value1="?Battle(_$Iterator).Name" Value2="BOSS_BUTCHER_ECLIPSEMODE" />
            <GreaterEqual Value1="?Fight(ZONE_3|BOSS_BUTCHER|6).WinCount" Value2="1" />
          </Operator>
          <Operator Type="And">
            <Equal Value1="?Battle(_$Iterator).Name" Value2="BOSS_BUTCHER_ECLIPSEMODE" />
            <GreaterEqual Value1="?Fight(ZONE_3|BOSS_BUTCHER|6).WinCount" Value2="1" />
          </Operator>
        </Operator>
      </Operator>
    </Conditions>
    <Actions>
      <ToggleBattle Name="_$Iterator" Toggle="on" />
    </Actions>
  </Quest>-->

  <Quest Name="EclipseMode_ButtonOff">
    <Events>
      <MapButtonPress />
    </Events>
    <Conditions>
      <Equal Value1="_$ButtonName" Value2="EclipseModeOff" />
    </Conditions>
    <Actions>
      <SetVariable Name="InEclipseMode" Value="0" />
      <ToggleEclipseMode Toggle="Off"/>
      <HideMapButton Name="EclipseModeOff"/>
      <ShowMapButton Name="EclipseModeOn" X="?Sub(?Div(?Multi(768, ?SysInfo().DisplayWidth), ?SysInfo().DisplayHeight),440)" Y="600" Image="sun_icon"/>
      <SetMapMask Color="0xffffff00" />
<!--      <Foreach Type="Battles" Name="HideEclipseModeBattles" />
      <Foreach Type="Battles" Name="ShowNormalModeBattles" />-->
    </Actions>
  </Quest>

<!--  <Quest Name="ShowNormalModeBattles">
    <Conditions>
      <Equal Not="1" Value1="?Battle(_$Iterator).Name" Value2="Tournament_ECLIPSEMODE" />
      <Equal Not="1" Value1="?Battle(_$Iterator).Name" Value2="Challenge_ECLIPSEMODE" />
      <Equal Not="1" Value1="?Battle(_$Iterator).Name" Value2="BOSS_LYNX_ECLIPSEMODE" />
      <Equal Not="1" Value1="?Battle(_$Iterator).Name" Value2="BOSS_HERMIT_ECLIPSEMODE" />
      <Equal Not="1" Value1="?Battle(_$Iterator).Name" Value2="BOSS_BUTCHER_ECLIPSEMODE" />
      <Equal Not="1" Value1="?Battle(_$Iterator).Name" Value2="BOSS_WASP_ECLIPSEMODE" />
      <Equal Not="1" Value1="?Battle(_$Iterator).Name" Value2="BOSS_HUNTRESS_ECLIPSEMODE" />
      <Equal Not="1" Value1="?Battle(_$Iterator).Name" Value2="BOSS_SAMURAI_ECLIPSEMODE" />
    </Conditions>
    <Actions>
      <ToggleBattle Name="_$Iterator" Toggle="on" />
    </Actions>
  </Quest>

  <Quest Name="HideEclipseModeBattles">
    <Conditions>
      <Operator Type="Or" >
        <Equal Value1="?Battle(_$Iterator).Name" Value2="Tournament_ECLIPSEMODE" />
        <Equal Value1="?Battle(_$Iterator).Name" Value2="Challenge_ECLIPSEMODE" />
        <Equal Value1="?Battle(_$Iterator).Name" Value2="BOSS_LYNX_ECLIPSEMODE" />
        <Equal Value1="?Battle(_$Iterator).Name" Value2="BOSS_HERMIT_ECLIPSEMODE" />
        <Equal Value1="?Battle(_$Iterator).Name" Value2="BOSS_BUTCHER_ECLIPSEMODE" />
        <Equal Value1="?Battle(_$Iterator).Name" Value2="BOSS_WASP_ECLIPSEMODE" />
        <Equal Value1="?Battle(_$Iterator).Name" Value2="BOSS_HUNTRESS_ECLIPSEMODE" />
        <Equal Value1="?Battle(_$Iterator).Name" Value2="BOSS_SAMURAI_ECLIPSEMODE" />
      </Operator>
    </Conditions>
    <Actions>
      <ToggleBattle Name="_$Iterator" Toggle="off" />
    </Actions>
  </Quest>-->

  <Quest Name="SendStrangerInfoAndFight" Group="FightEnter" Priority="9999" Unresumable="1">
    <Events>
      <FightEnter />
    </Events>
    <Conditions>
      <Equal Value1="?SysInfo().UserObserved" Value2="1" />
      <Operator Type="Or">
        <Equal Value1="_$Fight" Value2="ZONE_1|Stranger|lvl4" />
        <Equal Value1="_$Fight" Value2="ZONE_1|Stranger|lvl6" />
        <Operator Type="And">
          <Equal Not="1" Value1="?Fight(_$Fight).Zone" Value2="ZONE_1" />
          <Operator Type="Or">
            <Equal Value1="?Fight(_$Fight).Battle" Value2="Stranger" />
            <Equal Value1="?Fight(_$Fight).Battle" Value2="Stranger_INTERMISSION" />
          </Operator>
        </Operator>
      </Operator>
    </Conditions>
    <Actions>
      <SendStrangerStats Difficulty="_StrangerDifficulty" Result="_StrangerResult" Store="_StrangerStore" />
      <Fight Name="_$Fight" />
    </Actions>
  </Quest>

  <Quest Name="SendStrangerInfo" Priority="9999" Unresumable="1">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="SendStrangerInfo" />
      <Equal Value1="?SysInfo().UserObserved" Value2="1" />
    </Conditions>
    <Actions>
      <SendStrangerStats Difficulty="_StrangerDifficulty" Result="_StrangerResult" Store="_StrangerStore" />
    </Actions>
  </Quest>

  <Quest Name="FirstGuardBeaten">
    <Events>
      <FightEnd />
    </Events>
    <Conditions>
      <Equal Value1="_$Fight" Value2="ZONE_1|BOSS_LYNX|1" />
      <Equal Value1="_$FightResult" Value2="Win" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="globZoneToCheck" Value="ZONE_1" />
      <SetVariable Name="Avatar_Notification" Value="character_may_1_small" />
      <SetVariable Name="Avatar_Assistant_1" Value="character_may_1" />
      <SetVariable Name="Avatar_Assistant_2" Value="character_may_2" />
      <SetVariable Name="Avatar_Assistant_3" Value="character_may_3" />
      <SetVariable Name="Avatar_Assistant_4" Value="character_may_4" />
      <SetVariable Name="Avatar_Assistant_5" Value="character_may_5" />
      <SetVariable Name="Title_Assistant" Value="characterMay" />
      <SetVariable Name="promo_FirstPayment_Image" Value="pile_coins" />
      <SetVariable Name="promo_Multiplier" Value="2" />
      <AttachQuestFile File="assets/quest_extensions/zone_1/core.xml" />
      <AttachQuestFile File="assets/quest_extensions/zone_1/story.xml" />
      <AttachQuestFile File="assets/quest_extensions/dynamic_discounts.xml" />
      <AttachQuestFile File="assets/quest_extensions/promotions.xml" />
      <SetVariable Name="ChallengeUnlockCount" Value="0" />
      <SetVariable Name="DuelUnlockCount" Value="0" />
      <SetVariable Name="StrangerTriggerLevel" Value="5" />
      <Dialog Type="Regular" Title="NAME_LYNX" Image="boss_lynx">
        <Line Text="tutorial_bodyguard_win_1" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Beige" Text="dlgStoryBtnSeeYou" />
      </Dialog>
      <ActScreen Text="Act_1" />
      <Checkpoint />
      <Dialog Type="Regular" Title="_Title_Assistant" Image="_Avatar_Assistant_1">
        <Line Text="tutorial_girl_hello" ButtonText="dlgStoryBtnMore" />
        <Button Type="Left" Color="Red" Text="dlgStoryNegative">
          <Dialog Type="Regular" Title="_Title_Assistant" Image="_Avatar_Assistant_4" >
            <Line Text="tutorial_girl_please" ButtonText="dlgStoryBtnMore" />
            <Button Type="Right" Color="Beige" Text="dlgStoryBtnOk" />
          </Dialog>
        </Button>
        <Button Type="Right" Color="Beige" Text="dlgStoryPositive" />
      </Dialog>
      <Dialog Type="Regular" Title="_Title_Assistant" Image="_Avatar_Assistant_1" >
        <Line Text="tutorial_girl_end" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Beige" Text="dlgStoryBtnOk" />
      </Dialog>
      <Dialog Type="Regular" Title="_Title_Assistant" Image="_Avatar_Assistant_1" >
        <Line Text="tutorial_girl_tournament_1" ButtonText="dlgStoryBtnMore" />
        <Line Text="tutorial_girl_tournament_2" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Beige" Text="dlgStoryBtnOk" />
      </Dialog>
      <ToggleItems Label="ZONE_1_DONATE" Toggle="on" />
      <ShowBattle Name="ZONE_1|Tournament" />
      <SetMapFocus Battle="ZONE_1|Tournament|" />
      <Activate ActionID="TapjoyTutorialCompleted" />
    </Actions>
  </Quest>

  <Quest Name="UpgradesCleanup" Priority="9999" Unresumable="1">
    <Events>
      <SessionStart />
    </Events>
    <Actions>
      <UpgradesCleanup />
    </Actions>
  </Quest>

  <Quest Name="FinetuneStrangerTriggerLevel" Priority="900">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="FinetuneStrangerTriggerLevel" />
      <Equal Value1="?Mod(?Player().Level,6)" Value2="5" />
    </Conditions>
    <Actions>
      <SetVariable Name="StrangerTriggerLevel" Value="?Sum(_StrangerTriggerLevel,1)" />
    </Actions>
  </Quest>

  <Quest Name="FBLikeCheck" Priority="998" Unresumable="1">
    <Events>
      <SessionStart />
    </Events>
    <Conditions>
      <Equal Not="1" Value1="?SysInfo().FacebookLiked" Value2="1" />
      <Equal Value1="_FBLikePress" Value2="1" />
    </Conditions>
    <Actions>
      <FacebookAPICall Type="LikeCheck">
        <Error>
          <SetVariable Name="FBLikePress" Value="0" />
        </Error>
        <Success>
          <GiveCurrency Type="Bonus" Value="1" />
        </Success>
      </FacebookAPICall>
    </Actions>
  </Quest>

  <Quest Name="FBLikePress" Priority="998" Unresumable="1">
    <Events>
      <FreeSectionButton />
    </Events>
    <Conditions>
      <Equal Value1="_$ButtonType" Value2="FacebookLike" />
    </Conditions>
    <Actions>
      <SetVariable Name="FBLikePress" Value="0" />
      <FacebookAPICall Type="Login">
        <Error>
          <SetVariable Name="ShareFlag" Value="0" />
          <Dialog Type="NoAvatar" Title="dlgServiceFBTitle" >
            <Line Text="dlgServiceFBLoginFail{textures/misc/facebook.png}" ButtonText="dlgStoryBtnMore" />
            <Button Type="Right" Color="Beige" Text="dlgStoryBtnOk" />
          </Dialog>
        </Error>
        <Success>
          <SetVariable Name="FBLikePress" Value="1" />
          <SetFBIndicator Value="On" />
          <SetVariable Name="FBconnected" Value="1" />
          <SetVariable Name="FacebookReminded" Value="1" />
          <Activate ActionID="FBReward" />
          <OpenUrl URL="?SysInfo().FBLikeUrl" ALT_URL="?SysInfo().FBLikeAltUrl" />
        </Success>
      </FacebookAPICall>
    </Actions>
  </Quest>

  <Quest Name="FBSetIndicator" Priority="998" Unresumable="1">
    <Events>
      <SessionStart />
    </Events>
    <Conditions>
      <Equal Value1="_FBconnected" Value2="1" />
    </Conditions>
    <Actions>
      <SetFBIndicator Value="On" />
    </Actions>
  </Quest>

  <Quest Name="SetTime0" Priority="998" Unresumable="1">
    <Events>
      <SessionStart />
    </Events>
    <Conditions>
      <Equal Value1="_TimeSet" Value2="1" Not="1" />
    </Conditions>
    <Actions>
      <SetVariable Name="TimeSet" Value="1" />
      <SetVariable Name="LastRatingOfferTime" Value="0" />
    </Actions>
  </Quest>

  <Quest Name="ResetDownloadFlag" Priority="998" Unresumable="1">
    <Events>
      <SessionStart />
    </Events>
    <Conditions>
      <Equal Value1="_ShopDownloadOffer" Value2="1" />
    </Conditions>
    <Actions>
      <SetVariable Name="ShopDownloadOffer" Value="0" />
    </Actions>
  </Quest>

  <Quest Name="FindBestArmor" Unresumable="1">
    <Conditions>
      <Equal Value1="?Purchase(_$Iterator).Type" Value2="Armor" />
      <GreaterEqual Value1="?Purchase(_$Iterator).UpgradeLevel" Value2="_BestAcquiredArmorLevel" />
      <GreaterEqual Value1="?Item(_$Iterator).Quantity" Value2="1" />
    </Conditions>
    <Actions>
      <SetVariable Name="BestAcquiredArmorLevel" Value="?Purchase(_$Iterator).UpgradeLevel" />
      <SetVariable Name="BestArmor" Value="?Purchase(_$Iterator).Name" />
    </Actions>
  </Quest>

  <Quest Name="FindBestWeapon" Unresumable="1">
    <Conditions>
      <Equal Value1="?Purchase(_$Iterator).Type" Value2="Weapon" />
      <GreaterEqual Value1="?Purchase(_$Iterator).UpgradeLevel" Value2="_BestAcquiredWeaponLevel" />
      <GreaterEqual Value1="?Item(_$Iterator).Quantity" Value2="1" />
    </Conditions>
    <Actions>
      <SetVariable Name="BestAcquiredWeaponLevel" Value="?Purchase(_$Iterator).UpgradeLevel" />
    </Actions>
  </Quest>

  <Quest Name="FindBestHelm" Unresumable="1">
    <Conditions>
      <Equal Value1="?Purchase(_$Iterator).Type" Value2="Helm" />
      <GreaterEqual Value1="?Purchase(_$Iterator).UpgradeLevel" Value2="_BestAcquiredHelmLevel" />
      <GreaterEqual Value1="?Item(_$Iterator).Quantity" Value2="1" />
    </Conditions>
    <Actions>
      <SetVariable Name="BestAcquiredHelmLevel" Value="?Purchase(_$Iterator).UpgradeLevel" />
    </Actions>
  </Quest>

  <Quest Name="FindBestRanged" Unresumable="1">
    <Conditions>
      <Equal Value1="?Purchase(_$Iterator).Type" Value2="Ranged" />
      <GreaterEqual Value1="?Purchase(_$Iterator).UpgradeLevel" Value2="_BestAcquiredRangedLevel" />
      <GreaterEqual Value1="?Item(_$Iterator).Quantity" Value2="1" />
    </Conditions>
    <Actions>
      <SetVariable Name="BestAcquiredRangedLevel" Value="?Purchase(_$Iterator).UpgradeLevel" />
    </Actions>
  </Quest>

  <Quest Name="FindBestMagic" Unresumable="1">
    <Conditions>
      <Equal Value1="?Purchase(_$Iterator).Type" Value2="Magic" />
      <GreaterEqual Value1="?Purchase(_$Iterator).UpgradeLevel" Value2="_BestAcquiredMagicLevel" />
      <GreaterEqual Value1="?Item(_$Iterator).Quantity" Value2="1" />
    </Conditions>
    <Actions>
      <SetVariable Name="BestAcquiredMagicLevel" Value="?Purchase(_$Iterator).UpgradeLevel" />
    </Actions>
  </Quest>

  <Quest Name="FBReward" Priority="998" Unresumable="1">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_FBReward" Value2="1" Not="1" />
      <Equal Value1="_$ActionID" Value2="FBReward" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="FBReward" Value="1" />
      <Dialog Type="NoAvatar" Title="dlgServiceFBTitle" >
        <Line Text="dlgServiceFBReward{textures/misc/facebook.png}" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Green" Text="dlgStoryBtnTakeGems{textures/misc/ruby.png}{5}" />
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="FBRewardPayment" Priority="997">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_FBReward" Value2="1" Not="1" />
      <Equal Value1="_$ActionID" Value2="FBReward" />
    </Conditions>
    <Actions>
      <GiveCurrency Type="Bonus" Value="5" />
    </Actions>
  </Quest>

  <Quest Name="FBFirstTimeOffer" Priority="998" Unresumable="1">
    <Events>
      <FightEnd />
    </Events>
    <Conditions>
      <Greater Value1="?Fight(ZONE_1|BOSS_LYNX|2).WinCount" Value2="0" />
      <Equal Value1="_$Fight" Value2="ZONE_1|BOSS_LYNX|2" Not="1" />
      <Equal Value1="_FacebookOffered" Value2="1" Not="1" />
      <Equal Value1="_FacebookReminded" Value2="1" Not="1" />
      <Equal Value1="?SysInfo().China" Value2="1" Not="1" />
      <Equal Value1="?SysInfo().Amazon" Value2="1" Not="1" />
      <Equal Value1="?SysInfo().OsName" Value2="WP8" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="FacebookOffered" Value="1" />
      <Dialog Type="NoAvatar" Title="dlgServiceFBTitle" >
        <Line Text="dlgServiceFBInvite{textures/misc/facebook.png}{5}{textures/misc/ruby.png}" ButtonText="dlgStoryBtnMore" />
        <Button Type="Left" Color="Beige" Text="dlgStoryBtnCancel">
          <SetVariable Name="ShareFlag" Value="0" />
        </Button>
        <Button Type="Right" Color="Beige" Text="dlgServiceBtnLogin">
          <FacebookAPICall Type="Login">
            <Error>
              <SetVariable Name="ShareFlag" Value="0" />
              <Dialog Type="NoAvatar" Title="dlgServiceFBTitle" >
                <Line Text="dlgServiceFBLoginFail{textures/misc/facebook.png}" ButtonText="dlgStoryBtnMore" />
                <Button Type="Right" Color="Beige" Text="dlgStoryBtnOk" />
              </Dialog>
            </Error>
            <Success>
              <SetFBIndicator Value="On" />
              <SetVariable Name="FBconnected" Value="1" />
              <SetVariable Name="ShareFlag" Value="1" />
              <SetVariable Name="FacebookReminded" Value="1" />
              <Activate ActionID="FBReward" />
            </Success>
          </FacebookAPICall>
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="FBFirstTimeSettingsReminder" Priority="998" Unresumable="1">
    <Events>
      <LoginFacebook />
    </Events>
    <Conditions>
      <Equal Value1="_FacebookReminded" Value2="1" Not="1" />
      <Equal Value1="?SysInfo().China" Value2="1" Not="1" />
      <Equal Value1="?SysInfo().Amazon" Value2="1" Not="1" />
      <Equal Value1="?SysInfo().OsName" Value2="WP8" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="FacebookOffered" Value="1" />
      <SetVariable Name="FacebookReminded" Value="1" />
      <Dialog Type="NoAvatar" Title="dlgServiceFBTitle" >
        <Line Text="dlgServiceFBInvite{textures/misc/facebook.png}{5}{textures/misc/ruby.png}" ButtonText="dlgStoryBtnMore" />
        <Button Type="Left" Color="Beige" Text="dlgStoryBtnCancel">
          <SetVariable Name="ShareFlag" Value="0" />
        </Button>
        <Button Type="Right" Color="Beige" Text="dlgServiceBtnLogin">
          <FacebookAPICall Type="Login">
            <Error>
              <SetVariable Name="ShareFlag" Value="0" />
              <Dialog Type="NoAvatar" Title="dlgServiceFBTitle" >
                <Line Text="dlgServiceFBLoginFail{textures/misc/facebook.png}" ButtonText="dlgStoryBtnMore" />
                <Button Type="Right" Color="Beige" Text="dlgStoryBtnOk" />
              </Dialog>
            </Error>
            <Success>
              <SetFBIndicator Value="On" />
              <SetVariable Name="FBconnected" Value="1" />
              <SetVariable Name="ShareFlag" Value="1" />
              <Activate ActionID="FBReward" />
            </Success>
          </FacebookAPICall>
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="FBFirstTimeShareReminder" Priority="998" Unresumable="1" Group="Share" >
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_FacebookReminded" Value2="1" Not="1" />
      <Equal Value1="_ShareFlag" Value2="1" />
      <Equal Value1="_$ActionID" Value2="Share" />
      <Equal Value1="?SysInfo().China" Value2="1" Not="1" />
      <Equal Value1="?SysInfo().Amazon" Value2="1" Not="1" />
      <Equal Value1="?SysInfo().OsName" Value2="WP8" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="FacebookOffered" Value="1" />
      <Dialog Type="NoAvatar" Title="dlgServiceFBTitle" >
        <Line Text="dlgServiceFBInvite{textures/misc/facebook.png}{5}{textures/misc/ruby.png}" ButtonText="dlgStoryBtnMore" />
        <Button Type="Left" Color="Beige" Text="dlgStoryBtnCancel" >
          <SetVariable Name="ShareFlag" Value="0" />
        </Button>
        <Button Type="Right" Color="Beige" Text="dlgServiceBtnLogin">
          <FacebookAPICall Type="Login">
            <Error>
              <SetVariable Name="ShareFlag" Value="0" />
              <Dialog Type="NoAvatar" Title="dlgServiceFBTitle" >
                <Line Text="dlgServiceFBLoginFail{textures/misc/facebook.png}" ButtonText="dlgStoryBtnMore" />
                <Button Type="Right" Color="Beige" Text="dlgStoryBtnOk" />
              </Dialog>
            </Error>
            <Success>
              <SetFBIndicator Value="On" />
              <SetVariable Name="FBconnected" Value="1" />
              <SetVariable Name="ShareFlag" Value="1" />
              <SetVariable Name="FacebookReminded" Value="1" />
              <Activate ActionID="FBReward" />
              <Activate ActionID="Share" />
            </Success>
          </FacebookAPICall>
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="FBShare" Priority="20" Unresumable="1" Group="Share" >
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_FacebookReminded" Value2="1" />
      <Equal Value1="_FacebookOffered" Value2="1" />
      <Equal Value1="_ShareFlag" Value2="1" />
      <Equal Value1="_$ActionID" Value2="Share" />
      <Equal Value1="?SysInfo().China" Value2="1" Not="1" />
      <Equal Value1="?SysInfo().Amazon" Value2="1" Not="1" />
      <Equal Value1="?SysInfo().OsName" Value2="WP8" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <FacebookAPICall Type="Share">
        <Error>
          <SetVariable Name="ShareFlag" Value="0" />
          <Dialog Type="NoAvatar" Title="dlgServiceFBTitle" >
            <Line Text="dlgServiceFBLoginFail{textures/misc/facebook.png}" ButtonText="dlgStoryBtnMore" />
            <Button Type="Right" Color="Beige" Text="dlgStoryBtnOk" />
          </Dialog>
        </Error>
        <Success>
          <SetFBIndicator Value="On" />
          <SetVariable Name="FBconnected" Value="1" />
          <SetVariable Name="ShareFlag" Value="1" />
        </Success>
      </FacebookAPICall>
    </Actions>
  </Quest>

  <Quest Name="FacebookCommonLogin" Priority="998" Unresumable="1">
    <Events>
      <LoginFacebook />
    </Events>
    <Conditions>
      <Equal Value1="_FacebookReminded" Value2="1" />
      <Equal Value1="_FBconnected" Value2="1" Not="1" />
      <Equal Value1="?SysInfo().China" Value2="1" Not="1" />
      <Equal Value1="?SysInfo().Amazon" Value2="1" Not="1" />
      <Equal Value1="?SysInfo().OsName" Value2="WP8" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <Dialog Type="NoAvatar" Title="dlgServiceFBTitle" >
        <Line Text="dlgServiceFBLogin{textures/misc/facebook.png}" ButtonText="dlgStoryBtnMore" />
        <Button Type="Left" Color="Beige" Text="dlgStoryBtnCancel">
          <SetVariable Name="ShareFlag" Value="0" />
        </Button>
        <Button Type="Right" Color="Beige" Text="dlgServiceBtnLogin">
          <FacebookAPICall Type="Login">
            <Error>
              <SetVariable Name="ShareFlag" Value="0" />
              <Dialog Type="NoAvatar" Title="dlgServiceFBTitle" >
                <Line Text="dlgServiceFBLoginFail{textures/misc/facebook.png}" ButtonText="dlgStoryBtnMore" />
                <Button Type="Right" Color="Beige" Text="dlgStoryBtnOk" />
              </Dialog>
            </Error>
            <Success>
              <SetFBIndicator Value="On" />
              <SetVariable Name="FBconnected" Value="1" />
              <SetVariable Name="ShareFlag" Value="1" />
              <Activate ActionID="FBReward" />
            </Success>
          </FacebookAPICall>
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="FacebookCommonLogout" Priority="998" Unresumable="1">
    <Events>
      <LoginFacebook />
    </Events>
    <Conditions>
      <Equal Value1="_FacebookReminded" Value2="1" />
      <Equal Value1="_FBconnected" Value2="1" />
      <Equal Value1="?SysInfo().China" Value2="1" Not="1" />
      <Equal Value1="?SysInfo().Amazon" Value2="1" Not="1" />
      <Equal Value1="?SysInfo().OsName" Value2="WP8" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <Dialog Type="NoAvatar" Title="dlgServiceFBTitle" >
        <Line Text="dlgServiceFBLogout{textures/misc/facebook.png}" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Beige" Text="dlgServiceBtnLogout">
          <FacebookAPICall Type="Logout">
            <Error/>
            <Success>
              <SetFBIndicator Value="Off" />
              <SetVariable Name="FBconnected" Value="0" />
              <SetVariable Name="ShareFlag" Value="0" />
            </Success>
          </FacebookAPICall>
        </Button>
        <Button Type="Left" Color="Beige" Text="dlgStoryBtnCancel" />
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="NotificationGeneral" Priority="899">
    <Events>
      <Delivery />
    </Events>
    <Conditions/>
    <Actions Place="Map">
      <Wait Frames="1" />
      <Foreach Type="DeliveryItems" Name="DeliveryNotification" />
      <Wait Frames="1" />
      <Foreach Type="DeliveryUpgrades" Name="UpgradeNotification" />
      <Wait Frames="1" />
      <Foreach Type="DeliveryEnchantments" Name="EnchantmentNotification" />
      <Wait Frames="1" />
    </Actions>
  </Quest>

  <Quest Name="DeliveryNotification" Priority="899" Unresumable="1" AllowDoubles="1">
    <Conditions/>
    <Actions Place="Map">
      <Dialog Type="Notification" Image="_Avatar_Notification" >
        <Line Text="delivery_notification{_$Iterator}" />
        <Button Type="Left" Color="Green" />
        <Button Type="Right" Color="Green" Text="btnShopEquip">
          <OpenShop Tab="?Purchase(_$Iterator).Type" Item="_$Iterator" />
          <GiveItem Name="_$Iterator" PutOn="1" Quantity="0" />
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="UpgradeNotification" Priority="895" Unresumable="1" AllowDoubles="1">
    <Actions Place="Map">
      <Dialog Type="Notification" Image="_Avatar_Notification" >
        <Line Text="upgrade_notification{_$Iterator}" />
        <Button Type="Left" Color="Green" />
        <Button Type="Right" Color="Green" Text="dlgStoryBtnStore">
          <OpenShop Tab="?Purchase(_$Iterator).Type" Item="_$Iterator" />
          <GiveItem Name="_$Iterator" PutOn="1" Quantity="0" />
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="EnchantmentNotification" Priority="894" Unresumable="1" AllowDoubles="1">
    <Conditions/>
    <Actions Place="Map">
      <Dialog Type="Notification" Image="_Avatar_Notification" >
        <Line Text="enchantment_notification{?Purchase(_$Iterator).Name}" />
        <Button Type="Left" Color="Green" />
        <Button Type="Right" Color="Green" Text="dlgStoryBtnStore">
          <OpenShop Tab="?Purchase(_$Iterator).Type" Item="?Enchantment(_$Iterator).Item" />
          <GiveItem Name="_$Iterator" PutOn="1" Quantity="0" />
        </Button>
      </Dialog>
    </Actions>  
  </Quest>
  
  <Quest Name="Delivery" Unresumable="1">
    <Events>
      <Purchase />
    </Events>
    <Conditions>
      <Greater Value1="?Purchase(_$Purchase).Timeout" Value2="0" />
      <Equal Not="1" Value1="?Item(_$Purchase).Quantity" Value2="1" />
    </Conditions>
    <Actions Place="Map">
      <Dialog Type="Multiline" Title="_Title_Assistant" Image="_Avatar_Assistant_1" >
        <Line Text="dlgInstantBuyMessage1" ButtonText="dlgStoryBtnMore" />
        <DeliveryDelay Item="?Purchase(_$Purchase).Name" ButtonText="dlgStoryBtnMore">
          <GiveItem Name="?Purchase(_$Purchase).Name" PutOn="1" Quantity="0" />
        </DeliveryDelay>
        <Line Text="dlgInstantBuyMessage2" ButtonText="dlgStoryBtnMore" />
        <Button Type="Left" Color="Beige" Text="dlgStoryBtnWait_2" />
        <Button Type="Right" Color="Green" Text="dlgButtonFinish{textures/misc/ruby.png}{?Item(?Purchase(_$Purchase).Name).BonusDeliveryPrice}">
          <Deliver Item="?Purchase(_$Purchase).Name" />
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="DeliveryUpgrade" Unresumable="1">
    <Events>
      <Purchase />
    </Events>
    <Conditions>
      <Greater Value1="?Purchase(_$Purchase).Timeout" Value2="0" />
      <Equal Value1="?Item(_$Purchase).Quantity" Value2="1" />
      <Equal Not="1" Value1="?Purchase(_$Purchase).Timeout" Value2="?Item(?Purchase(_$Purchase).Name).NextUpgradeDeliveryTime" />
    </Conditions>
    <Actions Place="Map">
      <Dialog Type="Multiline" Title="_Title_Assistant" Image="_Avatar_Assistant_1" >
        <Line Text="dlgInstantBuyMessage1" ButtonText="dlgStoryBtnMore" />
        <DeliveryDelay Item="?Purchase(_$Purchase).Name" ButtonText="dlgStoryBtnMore">
          <GiveItem Name="?Purchase(_$Purchase).Name" PutOn="1" Quantity="0" />
        </DeliveryDelay>
        <Line Text="dlgInstantUpgradeMessage2" ButtonText="dlgStoryBtnMore" />
        <Button Type="Left" Color="Beige" Text="dlgStoryBtnWait_2" />
        <Button Type="Right" Color="Green" Text="dlgButtonUpgrade{textures/misc/ruby.png}{?Item(?Purchase(_$Purchase).Name).NextUpgradeDeliveryPrice}">
          <Deliver Item="?Purchase(_$Purchase).Name" />
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="DeliveryEnchantment" Unresumable="1">
    <Events>
      <Enchantment />
    </Events>
    <Conditions>
      <Greater Value1="?Enchantment(_$Enchantment).Timeout" Value2="0" />
    </Conditions>
    <Actions Place="Map">
      <Dialog Type="Multiline" Title="_Title_Assistant" Image="_Avatar_Assistant_1" >
        <Line Text="dlgInstantBuyMessage1" ButtonText="dlgStoryBtnMore" />
        <DeliveryDelay Enchantment="_$Enchantment" ButtonText="dlgStoryBtnMore">
          <GiveItem Name="?Enchantment(_$Enchantment).Item" PutOn="1" Quantity="0" />
        </DeliveryDelay>
        <Line Text="dlgInstantEnchantmentMessage2" ButtonText="dlgStoryBtnMore" />
        <Button Type="Left" Color="Beige" Text="dlgStoryBtnWait_2" />
        <Button Type="Right" Color="Green" Text="dlgEnchantButton{textures/misc/ruby.png}{?Enchantment(_$Enchantment).BonusDeliveryPrice}"> 
          <Deliver Enchantment="_$Enchantment" />
        </Button>
      </Dialog>
    </Actions>  
  </Quest>

  <Quest Name="WorseArmorEquipped" Group="FightEnter" Priority="11" Unresumable="1">
    <Events>
      <FightEnter />
    </Events>
    <Conditions>
      <Equal Not="1" Value1="_WorseArmorEquippedCheckBox" Value2="1" />
      <Equal Value1="_WorseArmorEquippedReminderFlag" Value2="0" />
      <Greater Value1="_BestAcquiredArmorLevel" Value2="0" />
      <Equal Value1="?Fight(_$Fight).Zone" Value2="Punchbag" Not="1" />
      <Equal Value1="?Fight(_$Fight).Type" Value2="HIDDEN" Not="1" />
      <Equal Value1="?Fight(_$Fight).Type" Value2="PERIODIC" Not="1" />
      <Less Not="1" Value1="?Sub(_BestAcquiredArmorLevel,?Purchase(?Player().Armor).UpgradeLevel)" Value2="50" />
    </Conditions>
    <Actions>
      <SetVariable Name="WorseArmorEquippedReminderFlag" Value="1" />
      <Dialog Type="Multiline" Title="_Title_Assistant" Image="_Avatar_Assistant_1" >
        <Line Text="dlgWorseArmorEquipped" ButtonText="dlgStoryBtnMore" />
        <Button Type="Left" Color="Red" Text="dlgStoryBtnFight">
          <Fight Name="_$Fight" />
        </Button>
        <Button Type="Right" Color="Green" Text="dlgStoryBtnStore">
          <ClearQuestQueue Name="FightEnter" />
          <OpenShop Tab="Armor" />
        </Button>
        <CheckBox Text="dlgDontShowAgain" InitialValue="_WorseArmorEquippedCheckBox">
          <On>
            <SetVariable Name="WorseArmorEquippedCheckBox" Value="1" />
          </On>
          <Off>
            <SetVariable Name="WorseArmorEquippedCheckBox" Value="0" />
          </Off>
        </CheckBox>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="WorseWeaponEquipped" Group="FightEnter" Priority="10" Unresumable="1">
    <Events>
      <FightEnter />
    </Events>
    <Conditions>
      <Equal Not="1" Value1="_WorseWeaponEquippedCheckBox" Value2="1" />
      <Equal Value1="_WorseWeaponEquippedReminderFlag" Value2="0" />
      <Greater Value1="_BestAcquiredWeaponLevel" Value2="0" />
      <Equal Value1="?Fight(_$Fight).Zone" Value2="Punchbag" Not="1" />
      <Equal Value1="?Fight(_$Fight).Type" Value2="HIDDEN" Not="1" />
      <Equal Value1="?Fight(_$Fight).Type" Value2="PERIODIC" Not="1" />
      <Less Not="1" Value1="?Sub(_BestAcquiredWeaponLevel,?Purchase(?Player().Weapon).UpgradeLevel)" Value2="50" />
    </Conditions>
    <Actions>
      <SetVariable Name="WorseWeaponEquippedReminderFlag" Value="1" />
      <Dialog Type="Multiline" Title="_Title_Assistant" Image="_Avatar_Assistant_1" >
        <Line Text="dlgWorseWeaponEquipped" ButtonText="dlgStoryBtnMore" />
        <Button Type="Left" Color="Red" Text="dlgStoryBtnFight">
          <Fight Name="_$Fight" />
        </Button>
        <Button Type="Right" Color="Green" Text="dlgStoryBtnStore">
          <ClearQuestQueue Name="FightEnter" />
          <OpenShop Tab="Weapon" />
        </Button>
        <CheckBox Text="dlgDontShowAgain" InitialValue="_WorseWeaponEquippedCheckBox">
          <On>
            <SetVariable Name="WorseWeaponEquippedCheckBox" Value="1" />
          </On>
          <Off>
            <SetVariable Name="WorseWeaponEquippedCheckBox" Value="0" />
          </Off>
        </CheckBox>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="WorseHelmEquipped" Group="FightEnter" Priority="9" Unresumable="1">
    <Events>
      <FightEnter />
    </Events>
    <Conditions>
      <Equal Not="1" Value1="_WorseHelmEquippedCheckBox" Value2="1" />
      <Equal Value1="_WorseHelmEquippedReminderFlag" Value2="0" />
      <Greater Value1="_BestAcquiredHelmLevel" Value2="0" />
      <Equal Value1="?Fight(_$Fight).Type" Value2="PERIODIC" Not="1" />
      <Equal Value1="?Fight(_$Fight).Type" Value2="HIDDEN" Not="1" />
      <Equal Value1="?Fight(_$Fight).Zone" Value2="Punchbag" Not="1" />
      <Less Not="1" Value1="?Sub(_BestAcquiredHelmLevel,?Purchase(?Player().Helm).UpgradeLevel)" Value2="50" />
    </Conditions>
    <Actions>
      <SetVariable Name="WorseHelmEquippedReminderFlag" Value="1" />
      <Dialog Type="Multiline" Title="_Title_Assistant" Image="_Avatar_Assistant_1" >
        <Line Text="dlgWorseHelmEquipped" ButtonText="dlgStoryBtnMore" />
        <Button Type="Left" Color="Red" Text="dlgStoryBtnFight">
          <Fight Name="_$Fight" />
        </Button>
        <Button Type="Right" Color="Green" Text="dlgStoryBtnStore">
          <ClearQuestQueue Name="FightEnter" />
          <OpenShop Tab="Helm" />
        </Button>
        <CheckBox Text="dlgDontShowAgain" InitialValue="_WorseHelmEquippedCheckBox">
          <On>
            <SetVariable Name="WorseHelmEquippedCheckBox" Value="1" />
          </On>
          <Off>
            <SetVariable Name="WorseHelmEquippedCheckBox" Value="0" />
          </Off>
        </CheckBox>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="PaymentSuccessDialog" Priority="9999" Unresumable="1">
    <Events>
      <Purchase />
    </Events>
    <Conditions>
      <Equal Value1="?Purchase(_$Purchase).Type" Value2="RealMoneyItem" />
    </Conditions>
    <Actions>
      <Dialog Type="NoAvatar" Title="paySuccessTitle" >
        <Line Text="paySuccessMessage" ButtonText="dlgStoryBtnOk" />
        <Button Type="Left" Color="Beige" Text="paySuccessButton" />
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="ShopRefresh" Unresumable="1">
    <Events>
      <Purchase />
    </Events>
    <Conditions>
      <Equal Value1="?Purchase(_$Purchase).Name" Value2="Unlimited_Energy" />
    </Conditions>
    <Actions>
      <UpdateScene />
    </Actions>
  </Quest>

  <Quest Name="ShopPerkResetNotification">
    <Events>
      <Purchase />
    </Events>
    <Conditions>
      <Equal Value1="?Item(_$Purchase).SubType" Value2="PerkReset" />
    </Conditions>
    <Actions>
      <SetVariable Name="FreeReminderShown" Value="1" />
      <ForceExecution Name="PerksWipe" />
    </Actions>
  </Quest>

  <Quest Name="EnergyChecker" Group="FightEnter" Unresumable="1" Priority="50000">
    <Events>
      <FightEnter />
    </Events>
    <Conditions>
      <Equal Value1="?Player().Power" Value2="0" />
      <Equal Value1="?Fight(_$Fight).Zone" Value2="Punchbag" Not="1" />
      <Equal Value1="?Fight(_$Fight).Battle" Value2="Stranger" Not="1" />
      <Equal Value1="?Fight(_$Fight).Battle" Value2="Stranger_INTERMISSION" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <ClearQuestQueue Name="FightEnter" />
      <Activate ActionID="EnergyRefillTutorialChecker" />
    </Actions>
  </Quest>

  <Quest Name="EnergyBarFullEnergy" Group="EnergyBar" Unresumable="1" Priority="20" >
    <Events>
      <EnergyBarPress />
    </Events>
    <Conditions>
      <Equal Value1="?Player().Power" Value2="5" />
    </Conditions>
    <Actions>
      <Dialog Type="Regular" Title="_Title_Assistant" Image="_Avatar_Assistant_1" >
        <Line Text="dlgBuyEnergyMessage1" />
        <Button Type="Right" Color="Beige" Text="dlgStoryBtnOk">
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="EnergyBarSomeEnergy" Group="EnergyBar" Unresumable="1" Priority="20" >
    <Events>
      <EnergyBarPress />
    </Events>
    <Conditions>
      <Operator Type="And">
        <Less Value1="?Player().Power" Value2="5" />
        <Greater Value1="?Player().Power" Value2="0" />
      </Operator>
    </Conditions>
    <Actions>
      <Activate ActionID="EnergyRefillDialogue" />
    </Actions>
  </Quest>

  <Quest Name="EnergyBarZeroEnergy" Group="EnergyBar" Unresumable="1" Priority="20" >
    <Events>
      <EnergyBarPress />
    </Events>
    <Conditions>
      <Equal Value1="?Player().Power" Value2="0" />
    </Conditions>
    <Actions>
      <Activate ActionID="EnergyRefillTutorialChecker" />
    </Actions>
  </Quest>

  <Quest Name="EnergyRefillTutorialNeverRun" Unresumable="1" Priority="20" >
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="EnergyRefillTutorialChecker" />
      <Equal Value1="_EnergyTutor" Value2="1" Not="1" />
    </Conditions>
    <Actions>
      <Activate ActionID="EnergyRefillTutorial" />
    </Actions>
  </Quest>

  <Quest Name="EnergyRefillTutorialDone" Unresumable="1" Priority="20" >
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="EnergyRefillTutorialChecker" />
      <Equal Value1="_EnergyTutor" Value2="1" />
    </Conditions>
    <Actions>
      <Activate ActionID="EnergyRefillDialogue" />
    </Actions>
  </Quest>

  <Quest Name="EnergyRefillTutorialPart1" Unresumable="1" Priority="-20">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="EnergyRefillTutorial" />
    </Conditions>
    <Actions Place="Map">
      <Dialog Type="Regular" Title="characterSensei" Image="character_sensei" >
        <Line Text="tutorial_energy_1{textures/misc/ruby.png}{5}" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Green" Text="dlgStoryBtnTake">
          <SetVariable Name="EnergyTutorialGems" Value="1" />
          <GiveCurrency Type="Bonus" Value="5" Sound="buy" />
          <Activate ActionID="EnergyRefillTutorialPart2Dialogue" />
        </Button>
      </Dialog>
      <Wait Frames="110" Lock="Silent" />
    </Actions>
  </Quest>

  <Quest Name="EnergyRefillTutorialPart2" Unresumable="0" Priority="49999">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="EnergyRefillTutorialPart2Dialogue" />
      <Equal Value1="_EnergyTutorialGems" Value2="1" />
    </Conditions>
    <Actions Place="Map">
      <Dialog Type="Regular" Title="_Title_Assistant" Image="_Avatar_Assistant_1" >
        <Line Text="tutorial_energy_2" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Green" Text="dlgStoryBtnBuyEnergyForGems{textures/misc/ruby.png}{5}">
          <TakeCurrency Type="Bonus" Value="5" Sound="buy">
            <Error>
              <SetVariable Name="EnergyTutor" Value="1" />
            </Error>
            <Success>
              <SetVariable Name="EnergyTutor" Value="1" />
              <SetVariable Name="EnergyTutorialGems" Value="0" />
              <GiveItem Name="Energy_Refill" Quantity="1" PutOn="1" />
            </Success>
          </TakeCurrency>
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="EnergyRefill" Group="FightEnter" Unresumable="1" Priority="49998" AllowDoubles="1">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="?SysInfo().Amazon" Value2="1" Not="1"/>
      <Equal Value1="?SysInfo().China" Value2="1" Not="1"/>
      <Equal Value1="?SysInfo().OsName" Value2="WP8" Not="1"/>
      <Equal Value1="_$ActionID" Value2="EnergyRefillDialogue" />
    </Conditions>
    <Actions Place="Map">
      <Dialog Type="Multiline" Title="_Title_Assistant" Image="_Avatar_Assistant_1" >
        <Line Text="dlgBuyEnergyMessage1" />
        <Line Text="dlgBuyEnergyMessage4" />
        <Line Text="dlgBuyEnergyMessage5{textures/misc/energy.png}">
          <Timer Name="EnergyRefillTimer" />
        </Line>
        <Button Type="Left" Color="Red" Text="dlgCancelButton">
        </Button>
        <Button Type="Middle" Color="Green" Text="dlgGetFreeBtn">
          <Activate ActionID="ShowAdVideo" />
        </Button>
        <Button Type="Right" Color="Green" Text="dlgStoryBtnBuyEnergyForGems{textures/misc/ruby.png}{5}">
          <BuyItem Name="Energy_Refill" Currency="Ruby" />
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="EnergyRefillAmazon" Group="FightEnter" Unresumable="1" Priority="49998" AllowDoubles="1">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Operator Type="Or">
        <Equal Value1="?SysInfo().Amazon" Value2="1" />
				<Equal Value1="?SysInfo().China" Value2="1" />
        <Equal Value1="?SysInfo().OsName" Value2="WP8" />
      </Operator>
      <Equal Value1="_$ActionID" Value2="EnergyRefillDialogue" />
    </Conditions>
    <Actions Place="Map">
      <Dialog Type="Multiline" Title="_Title_Assistant" Image="_Avatar_Assistant_1" >
        <Line Text="dlgBuyEnergyMessage1" />
        <Line Text="dlgBuyEnergyMessage4" />
        <Line Text="dlgBuyEnergyMessage5{textures/misc/energy.png}">
          <Timer Name="EnergyRefillTimer" />
        </Line>
        <Button Type="Left" Color="Red" Text="dlgCancelButton">
        </Button>
        <Button Type="Right" Color="Green" Text="dlgStoryBtnBuyEnergyForGems{textures/misc/ruby.png}{5}">
          <BuyItem Name="Energy_Refill" Currency="Ruby" />
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="ShowAdVideo" Unresumable="1" >
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="ShowAdVideo" />
      <Equal Value1="?SysInfo().Connection" Value2="1" />
    </Conditions>
    <Actions Place="Map">
      <ShowAd Type="Video">
        <Error>
          <Dialog Type="NoAvatar" Title="dlgNotAvaliableTitle" >
            <Line Text="dlgNotAvaliableMessage" ButtonText="dlgStoryBtnOk" />
            <Button Type="Left" Color="Beige" Text="dlgStoryBtnOk" />
          </Dialog>
          <SetVariable Name="ShowVideoError" Value="1" />
          <Activate ActionID="EnergyRefillDialogue" />
        </Error>
        <Success>
          <SetVariable Name="ShowVideoError" Value="0" />
        </Success>
      </ShowAd>
    </Actions>
  </Quest>

  <Quest Name="ShowAdVideoNoNetwork" Unresumable="1" >
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="ShowAdVideo" />
      <Equal Value1="?SysInfo().Connection" Value2="0" />
    </Conditions>
    <Actions Place="Map">
      <Dialog Type="NoAvatar" Title="dlgNotNetworkTitle" >
        <Line Text="dlgNotNetworkMessage" ButtonText="dlgStoryBtnOk" />
        <Button Type="Left" Color="Beige" Text="dlgStoryBtnOk" />
      </Dialog>
      <SetVariable Name="ShowVideoError" Value="1" />
      <Activate ActionID="EnergyRefillDialogue" />
    </Actions>
  </Quest>

  <Quest Name="NewBestWeapon" Unresumable="1">
    <Events>
      <Purchase />
    </Events>
    <Conditions>
      <Equal Value1="?Purchase(_$Purchase).Type" Value2="Weapon" />
      <LessEqual Not="1" Value1="?Purchase(_$Purchase).UpgradeLevel" Value2="_BestAcquiredWeaponLevel" />
    </Conditions>
    <Actions>
      <SetVariable Name="BestAcquiredWeaponLevel" Value="?Purchase(_$Purchase).UpgradeLevel" />
    </Actions>
  </Quest>

  <Quest Name="NewBestArmor" Unresumable="1">
    <Events>
      <Purchase />
    </Events>
    <Conditions>
      <Equal Value1="?Purchase(_$Purchase).Type" Value2="Armor" />
      <LessEqual Not="1" Value1="?Purchase(_$Purchase).UpgradeLevel" Value2="_BestAcquiredArmorLevel" />
    </Conditions>
    <Actions>
      <SetVariable Name="BestAcquiredArmorLevel" Value="?Purchase(_$Purchase).UpgradeLevel" />
    </Actions>
  </Quest>

  <Quest Name="NewBestHelm" Unresumable="1">
    <Events>
      <Purchase />
    </Events>
    <Conditions>
      <Equal Value1="?Purchase(_$Purchase).Type" Value2="Helm" />
      <LessEqual Not="1" Value1="?Purchase(_$Purchase).UpgradeLevel" Value2="_BestAcquiredHelmLevel" />
    </Conditions>
    <Actions>
      <SetVariable Name="BestAcquiredHelmLevel" Value="?Purchase(_$Purchase).UpgradeLevel" />
    </Actions>
  </Quest>

  <Quest Name="NewBestRanged" Unresumable="1">
    <Events>
      <Purchase />
    </Events>
    <Conditions>
      <Equal Value1="?Purchase(_$Purchase).Type" Value2="Ranged" />
      <LessEqual Not="1" Value1="?Purchase(_$Purchase).UpgradeLevel" Value2="_BestAcquiredRangedLevel" />
    </Conditions>
    <Actions>
      <SetVariable Name="BestAcquiredRangedLevel" Value="?Purchase(_$Purchase).UpgradeLevel" />
    </Actions>
  </Quest>

  <Quest Name="NewBestMagic" Unresumable="1">
    <Events>
      <Purchase />
    </Events>
    <Conditions>
      <Equal Value1="?Purchase(_$Purchase).Type" Value2="Magic" />
      <LessEqual Not="1" Value1="?Purchase(_$Purchase).UpgradeLevel" Value2="_BestAcquiredMagicLevel" />
    </Conditions>
    <Actions>
      <SetVariable Name="BestAcquiredMagicLevel" Value="?Purchase(_$Purchase).UpgradeLevel" />
    </Actions>
  </Quest>

  <Quest Name="SetShareFlag">
    <Events>
      <FightEnd />
    </Events>
    <Conditions>
      <Equal Value1="_$LevelUp" Value2="1" />
      <Equal Value1="_ShareFlag" Value2="1" Not="1" />
      <Equal Value1="_ShareFlag" Value2="0" Not="1" />
      <Equal Not="1" Value1="_$FightResult" Value2="Surrender" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="ShareFlag" Value="0" />
    </Actions>
  </Quest>

  <Quest Name="LevelUpFirstTime" Priority="-9">
    <Events>
      <FightEnd />
    </Events>
    <Conditions>
      <Equal Value1="?Player().Level" Value2="2" />
      <Equal Not="1" Value1="_$FightResult" Value2="Surrender" />
      <Equal Value1="_$LevelUp" Value2="1" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="rnd100" Value="?UniformIntRandom(1,100)" />
      <Activate ActionID="DiscountRoll" Sound="learn" />
      <Dialog Type="Multiline" Title="characterSensei" Image="character_sensei" >
        <Line Text="dlgSenseiCongratulation" ButtonText="dlgStoryBtnMore" />
        <Line Text="dlgSenseiLevelIndicator{textures/misc/level.png}{?Player().Level}" FontName="carterOneLevel" ButtonText="dlgStoryBtnMore" />
        <Line Text="dlgSenseiText" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Beige" Text="dlgSenseiProfile">
          <ClearQuestQueue Name="ShowUpgrades" />
          <ChangeScene Destination="Profile" />
        </Button>
      </Dialog>
      <SetVariable Name="WorseWeaponEquippedReminderFlag" Value="0" />
      <SetVariable Name="ShopAdviceOnCurrentLevel" Value="0"/>
      <SetVariable Name="WorseArmorEquippedReminderFlag" Value="0" />
      <SetVariable Name="WorseHelmEquippedReminderFlag" Value="0" />
    </Actions>
  </Quest>

  <Quest Name="SetLevelUpProfileFlag" Priority="10">
    <Events>
      <FightEnd />
    </Events>
    <Conditions>
      <Equal Value1="_LevelUpProfileFlag" Value2="1" />
    </Conditions>
    <Actions>
      <SetVariable Name="LevelUpProfileFlag" Value="0" />
    </Actions>
  </Quest>

  <Quest Name="LevelUpAmazon" Priority="-9">
    <Events>
      <FightEnd />
    </Events>
    <Conditions>
      <Equal Not="1" Value1="?Player().Level" Value2="2" />
      <Equal Not="1" Value1="_$FightResult" Value2="Surrender" />
      <Equal Value1="_$LevelUp" Value2="1" />
      <Operator Type="Or">
        <Equal Value1="?SysInfo().Amazon" Value2="1" />
        <Equal Value1="?SysInfo().OsName" Value2="WP8" />
        <Equal Value1="?SysInfo().China" Value2="1" />
      </Operator>
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="rnd100" Value="?UniformIntRandom(1,100)" />
      <Activate ActionID="DiscountRoll" Sound="learn" />
      <Dialog Type="Multiline" Title="characterSensei" Image="character_sensei" >
        <Line Text="dlgSenseiCongratulation" ButtonText="dlgStoryBtnMore" />
        <Line Text="dlgSenseiLevelIndicator{textures/misc/level.png}{?Player().Level}" FontName="carterOneLevel" ButtonText="dlgStoryBtnMore" />
        <Line Text="dlgSenseiText" ButtonText="dlgStoryBtnMore" />
        <Button Type="Left" Color="Red" Text="dlgServiceBtnLater" >
          <SetVariable Name="LevelUpProfileFlag" Value="0" />
          <Activate ActionID="LevelUpPostpone" />
        </Button>
        <Button Type="Right" Color="Beige" Text="dlgSenseiProfile">
          <ClearQuestQueue Name="ShowUpgrades" />
          <SetVariable Name="LevelUpProfileFlag" Value="1" />
          <ChangeScene Destination="Profile" />
        </Button>
      </Dialog>
      <Activate ActionID="Share" />
      <SetVariable Name="WorseWeaponEquippedReminderFlag" Value="0" />
      <SetVariable Name="ShopAdviceOnCurrentLevel" Value="0"/>
      <SetVariable Name="WorseArmorEquippedReminderFlag" Value="0" />
      <SetVariable Name="WorseHelmEquippedReminderFlag" Value="0" />
    </Actions>
  </Quest>

  <Quest Name="LevelUp" Priority="-9">
    <Events>
      <FightEnd />
    </Events>
    <Conditions>
      <Equal Not="1" Value1="?Player().Level" Value2="2" />
      <Equal Not="1" Value1="_$FightResult" Value2="Surrender" />
      <Equal Value1="_$LevelUp" Value2="1" />
      <Equal Value1="?SysInfo().Amazon" Value2="1" Not="1" />
      <Equal Value1="?SysInfo().OsName" Value2="WP8" Not="1" />
      <Equal Value1="?SysInfo().China" Value2="1" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="rnd100" Value="?UniformIntRandom(1,100)" />
      <Activate ActionID="DiscountRoll" Sound="learn" />
      <Dialog Type="Multiline" Title="characterSensei" Image="character_sensei" >
        <Line Text="dlgSenseiCongratulation" ButtonText="dlgStoryBtnMore" />
        <Line Text="dlgSenseiLevelIndicator{textures/misc/level.png}{?Player().Level}" FontName="carterOneLevel" ButtonText="dlgStoryBtnMore" />
        <Line Text="dlgSenseiText" ButtonText="dlgStoryBtnMore" />
        <Button Type="Left" Color="Red" Text="dlgServiceBtnLater" >
          <SetVariable Name="LevelUpProfileFlag" Value="0" />
          <Activate ActionID="LevelUpPostpone" />
        </Button>
        <CheckBox Text="dlgShareCheckbox" InitialValue="_ShareFlag">
          <On>
            <SetVariable Name="ShareFlag" Value="1" />
          </On>
          <Off>
            <SetVariable Name="ShareFlag" Value="0" />
          </Off>
        </CheckBox>
        <Button Type="Right" Color="Beige" Text="dlgSenseiProfile">
          <ClearQuestQueue Name="ShowUpgrades" />
          <SetVariable Name="LevelUpProfileFlag" Value="1" />
          <ChangeScene Destination="Profile" />
        </Button>
      </Dialog>
      <Activate ActionID="Share" />
      <SetVariable Name="WorseWeaponEquippedReminderFlag" Value="0" />
      <SetVariable Name="ShopAdviceOnCurrentLevel" Value="0"/>
      <SetVariable Name="WorseArmorEquippedReminderFlag" Value="0" />
      <SetVariable Name="WorseHelmEquippedReminderFlag" Value="0" />
    </Actions>
  </Quest>

  <Quest Name="RangedAvailable" Priority="-1" Unresumable="1">
    <Events>
      <ChangeTab />
    </Events>
    <Conditions>
      <Equal Value1="_TournamentsLeftReminderFlag" Value2="1" Not="1" />
      <Equal Value1="_ChallengesLeftReminderFlag" Value2="1" Not="1" />
      <Equal Value1="?Battle(ZONE_2|BOSS_HERMIT).Available" Value2="1" />
      <Equal Value1="_$SceneTo" Value2="Shop" />
      <Equal Value1="_RangedAvailableTag" Value2="1" Not="1" />
      <GreaterEqual Value1="?Player().Level" Value2="8" />
    </Conditions>
    <Actions>
      <OpenShop Tab="Ranged" Item="RANGED_THROWING_DAGGERS" />
      <Dialog Type="Regular" Title="_Title_Assistant" Image="_Avatar_Assistant_3" >
        <Line Text="dlgRangedAvailable"/>
        <Button Type="Right" Color="Green" Text="dlgStoryBtnShowme" />
      </Dialog>
      <SetVariable Name="RangedAvailableTag" Value="1" />
    </Actions>
  </Quest>

  <Quest Name="MagicAvailable" Priority="-1" Unresumable="1">
    <Events>
      <ChangeTab />
    </Events>
    <Conditions>
      <Equal Value1="_TournamentsLeftReminderFlag" Value2="1" Not="1" />
      <Equal Value1="_ChallengesLeftReminderFlag" Value2="1" Not="1" />
      <Equal Value1="?Battle(ZONE_3|BOSS_BUTCHER).Available" Value2="1" />
      <Equal Value1="_$SceneTo" Value2="Shop" />
      <Equal Value1="_MagicAvailableTag" Value2="1" Not="1" />
      <GreaterEqual Value1="?Player().Level" Value2="14" />
    </Conditions>
    <Actions>
      <OpenShop Tab="Magic" Item="MAGIC_FIRE_BALL" />
      <Dialog Type="Regular" Title="_Title_Assistant" Image="_Avatar_Assistant_3" >
        <Line Text="dlgMagicAvailable" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Green" Text="dlgStoryBtnShowme" />
      </Dialog>
      <SetVariable Name="MagicAvailableTag" Value="1" />
    </Actions>
  </Quest>

  <Quest Name="FindTopItems" Priority="-9" Group="ChallengeService|FightEnter" Unresumable="1">
    <Events>
      <FightEnter />
    </Events>
    <Conditions>
      <Equal Value1="_ChallengeRunning" Value2="1" Not="1" />
      <Operator Type="Or">
        <Equal Value1="?Fight(_$Fight).Battle" Value2="Challenge" />
        <Equal Value1="?Fight(_$Fight).Battle" Value2="Challenge_INTERMISSION" />
      </Operator>
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="CurrentChallenge" Value="_$Fight" />
      <Activate ActionID="ChallengeDialog" />
    </Actions>
  </Quest>

  <Quest Name="ChallengeRun" Priority="-9" Group="ChallengeService|FightEnter" Unresumable="1">
    <Events>
      <FightEnter />
    </Events>
    <Conditions>
      <Equal Value1="_ChallengeRunning" Value2="1" />
      <Operator Type="Or">
        <Equal Value1="?Fight(_$Fight).Battle" Value2="Challenge" />
        <Equal Value1="?Fight(_$Fight).Battle" Value2="Challenge_INTERMISSION" />
      </Operator>
    </Conditions>
    <Actions>
      <Fight Name="_CurrentChallenge" />
      <ClearQuestQueue Name="DiscountService" />
      <SetVariable Name="ChallengeRunning" Value="0" />
    </Actions>
  </Quest>

  <Quest Name="ChallengeEnter" Priority="-9" Group="ChallengeService|FightEnter" Unresumable="1">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="ChallengeDialog" />
      <Operator Type="Or">
        <Less Value1="?Item(?Fight(_CurrentChallenge).Helm).Quantity" Value2="1" Not="1" />
        <Equal Value1="?Fight(_CurrentChallenge).Helm" Value2="" />
      </Operator>
      <Operator Type="Or">
        <Less Value1="?Item(?Fight(_CurrentChallenge).Armor).Quantity" Value2="1" Not="1" />
        <Equal Value1="?Fight(_CurrentChallenge).Armor" Value2="" />
      </Operator>
      <Operator Type="Or">
        <Less Value1="?Item(?Fight(_CurrentChallenge).Weapon).Quantity" Value2="1" Not="1" />
        <Equal Value1="?Fight(_CurrentChallenge).Weapon" Value2="" />
      </Operator>
      <Operator Type="Or">
        <Less Value1="?Item(?Fight(_CurrentChallenge).Ranged).Quantity" Value2="1" Not="1" />
        <Equal Value1="?Fight(_CurrentChallenge).Ranged" Value2="" />
      </Operator>
      <Operator Type="Or">
        <Less Value1="?Item(?Fight(_CurrentChallenge).Magic).Quantity" Value2="1" Not="1" />
        <Equal Value1="?Fight(_CurrentChallenge).Magic" Value2="" />
      </Operator>
      <Less Value1="?Purchase(?Player().Helm).UpgradeLevel" Value2="?Multi(100,?Fight(_CurrentChallenge).HelmLevel)" Not="1" />
      <Less Value1="?Purchase(?Player().Armor).UpgradeLevel" Value2="?Multi(100,?Fight(_CurrentChallenge).ArmorLevel)" Not="1" />
      <Less Value1="?Purchase(?Player().Weapon).UpgradeLevel" Value2="?Multi(100,?Fight(_CurrentChallenge).WeaponLevel)" Not="1" />
      <Less Value1="?Purchase(?Player().Ranged).UpgradeLevel" Value2="?Multi(100,?Fight(_CurrentChallenge).RangedLevel)" Not="1" />
      <Less Value1="?Purchase(?Player().Magic).UpgradeLevel" Value2="?Multi(100,?Fight(_CurrentChallenge).MagicLevel)" Not="1" />
    </Conditions>
    <Actions>
      <Dialog Type="Multiline" Title="characterSensei" Image="character_sensei" >
        <Line Text="blank{?Concat(FULL_DESCRIPTION_,?Fight(_CurrentChallenge).Description)}" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Text="dlgStoryBtnFight" Color="Beige">
          <SetVariable Name="ChallengeRunning" Value="1" />
          <Fight Name="_CurrentChallenge" />
          <ClearQuestQueue Name="DiscountService" />
        </Button>
        <Button Type="Left" Text="dlgStoryBtnLeave" Color="Red"/>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="ChallengeDenied1" Priority="-9" Group="ChallengeService|FightEnter" Unresumable="1">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="ChallengeDialog" />
      <Operator Type="And" Not="1">
        <Operator Type="Or">
          <Less Value1="?Item(?Fight(_CurrentChallenge).Weapon).Quantity" Value2="1" Not="1" />
          <Equal Value1="?Fight(_CurrentChallenge).Weapon" Value2="" />
        </Operator>
        <Less Value1="?Purchase(?Player().Weapon).UpgradeLevel" Value2="?Multi(100,?Fight(_CurrentChallenge).WeaponLevel)" Not="1" />
      </Operator>
    </Conditions>
    <Actions>
      <ClearQuestQueue />
      <Dialog Type="Multiline" Title="characterSensei" Image="character_sensei" >
        <Line Text="blank{?Concat(FULL_DESCRIPTION_,?Fight(_CurrentChallenge).Description)}" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Text="dlgStoryBtnStore" Color="Green">
          <OpenShop Tab="Weapon" Item="?Fight(_CurrentChallenge).Weapon" />
        </Button>
        <Button Type="Left" Text="dlgStoryBtnLeave" Color="Red"/>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="ChallengeDenied2" Priority="-9" Group="ChallengeService|FightEnter" Unresumable="1">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="ChallengeDialog" />
      <Operator Type="And" Not="1">
        <Operator Type="Or">
          <Less Value1="?Item(?Fight(_CurrentChallenge).Helm).Quantity" Value2="1" Not="1" />
          <Equal Value1="?Fight(_CurrentChallenge).Helm" Value2="" />
        </Operator>
        <Less Value1="?Purchase(?Player().Helm).UpgradeLevel" Value2="?Multi(100,?Fight(_CurrentChallenge).HelmLevel)" Not="1" />
      </Operator>
    </Conditions>
    <Actions>
      <ClearQuestQueue />
      <Dialog Type="Multiline" Title="characterSensei" Image="character_sensei" >
        <Line Text="blank{?Concat(FULL_DESCRIPTION_,?Fight(_CurrentChallenge).Description)}" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Text="dlgStoryBtnStore" Color="Green">
          <OpenShop Tab="Helm" Item="?Fight(_CurrentChallenge).Helm" />
        </Button>
        <Button Type="Left" Text="dlgStoryBtnLeave" Color="Red"/>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="ChallengeDenied3" Priority="-9" Group="ChallengeService|FightEnter" Unresumable="1">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="ChallengeDialog" />
      <Operator Type="And" Not="1">
        <Operator Type="Or">
          <Less Value1="?Item(?Fight(_CurrentChallenge).Armor).Quantity" Value2="1" Not="1" />
          <Equal Value1="?Fight(_CurrentChallenge).Armor" Value2="" />
        </Operator>
        <Less Value1="?Purchase(?Player().Armor).UpgradeLevel" Value2="?Multi(100,?Fight(_CurrentChallenge).ArmorLevel)" Not="1" />
      </Operator>
    </Conditions>
    <Actions>
      <ClearQuestQueue />
      <Dialog Type="Multiline" Title="characterSensei" Image="character_sensei" >
        <Line Text="blank{?Concat(FULL_DESCRIPTION_,?Fight(_CurrentChallenge).Description)}" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Text="dlgStoryBtnStore" Color="Green">
          <OpenShop Tab="Armor" Item="?Fight(_CurrentChallenge).Armor" />
        </Button>
        <Button Type="Left" Text="dlgStoryBtnLeave" Color="Red"/>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="ChallengeDenied4" Priority="-9" Group="ChallengeService|FightEnter" Unresumable="1">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="ChallengeDialog" />
      <Operator Type="And" Not="1">
        <Operator Type="Or">
          <Less Value1="?Item(?Fight(_CurrentChallenge).Ranged).Quantity" Value2="1" Not="1" />
          <Equal Value1="?Fight(_CurrentChallenge).Ranged" Value2="" />
        </Operator>
        <Less Value1="?Purchase(?Player().Ranged).UpgradeLevel" Value2="?Multi(100,?Fight(_CurrentChallenge).RangedLevel)" Not="1" />
      </Operator>
    </Conditions>
    <Actions>
      <ClearQuestQueue />
      <Dialog Type="Multiline" Title="characterSensei" Image="character_sensei" >
        <Line Text="blank{?Concat(FULL_DESCRIPTION_,?Fight(_CurrentChallenge).Description)}" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Text="dlgStoryBtnStore" Color="Green">
          <OpenShop Tab="Ranged" Item="?Fight(_CurrentChallenge).Ranged" />
          <Dialog Type="Regular" Title="_Title_Assistant" Image="_Avatar_Assistant_1" >
            <Line Text="dlgChallengeUpgradeReminder" ButtonText="dlgStoryBtnMore" />
            <Button Type="Right" Text="dlgStoryThanks" Color="Green" />
          </Dialog>
          <SetVariable Name="UpgradeToLevelReminderShown" Value="1" />
        </Button>
        <Button Type="Left" Text="dlgStoryBtnLeave" Color="Red"/>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="ChallengeDenied5" Priority="-9" Group="ChallengeService|FightEnter" Unresumable="1">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="ChallengeDialog" />
      <Operator Type="And" Not="1">
        <Operator Type="Or">
          <Less Value1="?Item(?Fight(_CurrentChallenge).Magic).Quantity" Value2="1" Not="1" />
          <Equal Value1="?Fight(_CurrentChallenge).Magic" Value2="" />
        </Operator>
        <Less Value1="?Purchase(?Player().Magic).UpgradeLevel" Value2="?Multi(100,?Fight(_CurrentChallenge).MagicLevel)" Not="1" />
      </Operator>
    </Conditions>
    <Actions>
      <ClearQuestQueue />
      <Dialog Type="Multiline" Title="characterSensei" Image="character_sensei" >
        <Line Text="blank{?Concat(FULL_DESCRIPTION_,?Fight(_CurrentChallenge).Description)}" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Text="dlgStoryBtnStore" Color="Green">
          <OpenShop Tab="Magic" Item="?Fight(_CurrentChallenge).Magic" />
          <Dialog Type="Regular" Title="_Title_Assistant" Image="_Avatar_Assistant_1" >
            <Line Text="dlgChallengeUpgradeReminder" ButtonText="dlgStoryBtnMore" />
            <Button Type="Right" Text="dlgStoryThanks" Color="Green" />
          </Dialog>
          <SetVariable Name="UpgradeToLevelReminderShown" Value="1" />
        </Button>
        <Button Type="Left" Text="dlgStoryBtnLeave" Color="Red"/>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="LaunchDuel" Priority="-9" Group="DuelService|FightEnter" Unresumable="1">
    <Events>
      <FightEnter />
    </Events>
    <Conditions>
      <Equal Value1="_DuelRunning" Value2="1" Not="1" />
      <Operator Type="Or">
        <Equal Value1="?Fight(_$Fight).Battle" Value2="Duel" />
        <Equal Value1="?Fight(_$Fight).Battle" Value2="Duel_INTERMISSION" />
      </Operator>
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="CurrentDuel" Value="_$Fight" />
      <Activate ActionID="DuelDialog" />
    </Actions>
  </Quest>

  <Quest Name="DuelRun" Priority="-9" Group="DuelService|FightEnter" Unresumable="1">
    <Events>
      <FightEnter />
    </Events>
    <Conditions>
      <Equal Value1="_DuelRunning" Value2="1" />
      <Operator Type="Or">
        <Equal Value1="?Fight(_$Fight).Battle" Value2="Duel" />
        <Equal Value1="?Fight(_$Fight).Battle" Value2="Duel_INTERMISSION" />
      </Operator>
    </Conditions>
    <Actions>
      <Fight Name="_CurrentDuel" />
      <ClearQuestQueue Name="DiscountService" />
      <SetVariable Name="DuelRunning" Value="0" />
    </Actions>
  </Quest>

  <Quest Name="DuelEnter" Priority="-9" Group="DuelService|FightEnter" Unresumable="1">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$Fight" Value2="ZONE_1|Duel|1" Not="1" />
      <Equal Value1="_$ActionID" Value2="DuelDialog" />
      <Equal Value1="?Fight(_CurrentDuel).Description" Value2="0" Not="1" />
    </Conditions>
    <Actions>
      <Dialog Type="Multiline" Title="characterSensei" Image="character_sensei" >
        <Line Text="blank{?Concat(FULL_DESCRIPTION_,?Fight(_CurrentDuel).Description)}" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Text="dlgStoryBtnFight" Color="Beige">
          <SetVariable Name="DuelRunning" Value="1" />
          <Fight Name="_CurrentDuel" />
          <ClearQuestQueue Name="DiscountService" />
        </Button>
        <Button Type="Left" Text="dlgStoryBtnLeave" Color="Red"/>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="DuelEnterNoDescription" Group="DuelService|FightEnter" Priority="-9" Unresumable="1">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="DuelDialog" />
      <Operator Type="Or">
        <Equal Value1="_$Fight" Value2="ZONE_1|Duel|1" />
        <Equal Value1="?Fight(_CurrentDuel).Description" Value2="0" />
      </Operator>
    </Conditions>
    <Actions>
      <SetVariable Name="DuelRunning" Value="1" />
      <Fight Name="_CurrentDuel" />
    </Actions>
  </Quest>

  <Quest Name="DuelInviteStartup" Priority="9998">
    <Events>
      <SessionStart />
    </Events>
    <Conditions>
      <Equal Value="?Battle(ZONE_1|Duel).Available" Value2="1" />
      <Equal Value="?Fight(ZONE_1|Duel|1).TimeLeft" Value2="0" />
    </Conditions>
    <Actions>
      <Activate ActionID="DuelInvite" />
    </Actions>
  </Quest>

  <Quest Name="DuelInviteFightEnd" Priority="9998">
    <Events>
      <FightEnd />
    </Events>
    <Conditions>
      <Equal Value="?Battle(ZONE_1|Duel).Available" Value2="1" />
      <Equal Not="1" Value="_DuelReminded" Value2="1" />
      <Equal Value="?Fight(ZONE_1|Duel|1).TimeLeft" Value2="0" />
    </Conditions>
    <Actions>
      <Activate ActionID="DuelInvite" />
    </Actions>
  </Quest>

  <Quest Name="DuelInvite" >
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value="_$ActionID" Value2="DuelInvite" />
    </Conditions>
    <Actions>
      <SetVariable Name="DuelReminded" Value="0" />
      <Dialog Type="Notification" Image="_Avatar_Notification" >
        <Line Text="duel_invite" />
        <Button Type="Left" Color="Green" />
        <Button Type="Right" Color="Green" Text="dlgStoryBtnOk" />
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="DuelInviteReset" Priority="9998">
    <Events>
      <FightEnd />
    </Events>
    <Conditions>
      <Equal Value="_DuelReminded" Value2="1" />
      <Equal Value="?Fight(_$Fight).Battle" Value2="Duel" />
      <Equal Value="_$FightResult" Value2="Win" />
    </Conditions>
    <Actions>
      <SetVariable Name="DuelReminded" Value="0" />
    </Actions>
  </Quest>

  <Quest Name="SetCurrentZone" Priority="3500" Group="FightEnter" Unresumable="1">
    <Events>
      <FightEnter />
    </Events>
    <Conditions>
      <Equal Value1="?Fight(_$Fight).Zone" Value2="ZONE_1" Not="1" />
      <Equal Value1="?Fight(_$Fight).Zone" Value2="Punchbag" Not="1" />
      <Equal Value1="?PackAssert(?Fight(_$Fight).Zone).Availability" Value2="1" Not="1" />
      <Equal Not="1" Value1="?Fight(_$Fight).Battle" Value2="BOSS_LYNX_INTERMISSION"/>
      <Equal Not="1" Value1="?Fight(_$Fight).Battle" Value2="BOSS_HERMIT_INTERMISSION" />
      <Equal Not="1" Value1="?Fight(_$Fight).Battle" Value2="BOSS_BUTCHER_INTERMISSION" />
      <Equal Not="1" Value1="?Fight(_$Fight).Battle" Value2="BOSS_WASP_INTERMISSION" />
      <Equal Not="1" Value1="?Fight(_$Fight).Battle" Value2="BOSS_HUNTRESS_INTERMISSION" />
      <Equal Not="1" Value1="?Fight(_$Fight).Battle" Value2="BOSS_SAMURAI_INTERMISSION" />
      <Equal Not="1" Value1="?Fight(_$Fight).Battle" Value2="Tournament_INTERMISSION" />
      <Equal Not="1" Value1="?Fight(_$Fight).Battle" Value2="Challenge_INTERMISSION" />
      <Equal Not="1" Value1="?Fight(_$Fight).Battle" Value2="Survival_INTERMISSION" />
      <Equal Not="1" Value1="?Fight(_$Fight).Battle" Value2="Duel_INTERMISSION" />
      <Equal Not="1" Value1="?Fight(_$Fight).Battle" Value2="Stranger_INTERMISSION" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="globZoneToCheck" Value="?Fight(_$Fight).Zone" />
      <Activate ActionID="FightStartCheck" />
    </Actions>
  </Quest>

  <Quest Name="SetCurrentZone_IM" Priority="3600" Group="FightEnter" Unresumable="1">
    <Events>
      <FightEnter />
    </Events>
    <Conditions>
      <Operator Type="Or">
        <Equal Value1="?Fight(_$Fight).Battle" Value2="BOSS_LYNX_INTERMISSION" />
        <Equal Value1="?Fight(_$Fight).Battle" Value2="BOSS_HERMIT_INTERMISSION" />
        <Equal Value1="?Fight(_$Fight).Battle" Value2="BOSS_BUTCHER_INTERMISSION" />
        <Equal Value1="?Fight(_$Fight).Battle" Value2="BOSS_WASP_INTERMISSION" />
        <Equal Value1="?Fight(_$Fight).Battle" Value2="BOSS_HUNTRESS_INTERMISSION" />
        <Equal Value1="?Fight(_$Fight).Battle" Value2="BOSS_SAMURAI_INTERMISSION" />
        <Equal Value1="?Fight(_$Fight).Battle" Value2="Tournament_INTERMISSION" />
        <Equal Value1="?Fight(_$Fight).Battle" Value2="Challenge_INTERMISSION" />
        <Equal Value1="?Fight(_$Fight).Battle" Value2="Survival_INTERMISSION" />
        <Equal Value1="?Fight(_$Fight).Battle" Value2="Duel_INTERMISSION" />
        <Equal Value1="?Fight(_$Fight).Battle" Value2="Stranger_INTERMISSION" />
      </Operator>
      <Equal Value1="?PackAssert(ZONE_IM).Availability" Value2="1" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="globZoneToCheck" Value="ZONE_IM" />
      <Activate ActionID="FightStartCheck" />
    </Actions>
  </Quest>

  <Quest Name="PackDownloadWrapperNewZone" Priority="-50" Unresumable="1">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Operator Type="Or">
        <Equal Value1="_$ActionID" Value2="ActBegan" />
      </Operator>
      <Equal Value1="?PackAssert(_globZoneToCheck).Availability" Value2="1" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <Activate ActionID="PackDownload" />
    </Actions>
  </Quest>

  <Quest Name="PackDownloadWrapper" Priority="900" Unresumable="1">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Operator Type="Or">
        <Equal Value1="_$ActionID" Value2="PackDownloadRetry" />
        <Equal Value1="_$ActionID" Value2="FightStartCheck" />
        <Equal Value1="_$ActionID" Value2="ShopCheck" />
      </Operator>
    </Conditions>
    <Actions Place="Map">
      <Activate ActionID="PackDownload" />
    </Actions>
  </Quest>

  <Quest Name="ForcedPackDownload" Priority="1100" Unresumable="1">
    <Events>
      <SessionStart />
    </Events>
    <Conditions>
      <Operator Type="Or">
        <Operator Type="And">
          <Equal Value1="?PackAssert(ZONE_2).Availability" Value2="1" Not="1" />
          <Less Value1="?Fight(ZONE_1|BOSS_LYNX|6).WinCount" Value2="1" Not="1" />
        </Operator>
        <Operator Type="And">
          <Equal Value1="?PackAssert(ZONE_3).Availability" Value2="1" Not="1" />
          <Less Value1="?Fight(ZONE_2|BOSS_HERMIT|6).WinCount" Value2="1" Not="1" />
        </Operator>
        <Operator Type="And">
          <Equal Value1="?PackAssert(ZONE_4).Availability" Value2="1" Not="1" />
          <Less Value1="?Fight(ZONE_3|BOSS_BUTCHER|6).WinCount" Value2="1" Not="1" />
        </Operator>
        <Operator Type="And">
          <Equal Value1="?PackAssert(ZONE_5).Availability" Value2="1" Not="1" />
          <Less Value1="?Fight(ZONE_4|BOSS_WASP|6).WinCount" Value2="1" Not="1" />
        </Operator>
        <Operator Type="And">
          <Equal Value1="?PackAssert(ZONE_6).Availability" Value2="1" Not="1" />
          <Less Value1="?Fight(ZONE_5|BOSS_HUNTRESS|6).WinCount" Value2="1" Not="1" />
        </Operator>
        <Operator Type="And">
          <Equal Value1="?Battle(ZONE_1|BOSS_LYNX_INTERMISSION).Available" Value2="1" />
          <Equal Value1="?PackAssert(ZONE_IM).Availability" Value2="1" Not="1" />
        </Operator>
      </Operator>
    </Conditions>
    <Actions>
      <Activate ActionID="ForcedPackDownloadRetry" />
    </Actions>
  </Quest>

  <Quest Name="PackDownloadShop" Priority="900" Unresumable="1">
    <Events>
      <ChangeTab />
    </Events>
    <Conditions>
      <Equal Value1="_$SceneTo" Value2="Shop" />
      <Operator Type="Or">
        <Operator Type="And">
          <Equal Value1="?PackAssert(ZONE_2).Availability" Value2="1" Not="1" />
          <Less Value1="?Fight(ZONE_1|BOSS_LYNX|6).WinCount" Value2="1" Not="1" />
        </Operator>
        <Operator Type="And">
          <Equal Value1="?PackAssert(ZONE_3).Availability" Value2="1" Not="1" />
          <Less Value1="?Fight(ZONE_2|BOSS_HERMIT|6).WinCount" Value2="1" Not="1" />
        </Operator>
        <Operator Type="And">
          <Equal Value1="?PackAssert(ZONE_4).Availability" Value2="1" Not="1" />
          <Less Value1="?Fight(ZONE_3|BOSS_BUTCHER|6).WinCount" Value2="1" Not="1" />
        </Operator>
        <Operator Type="And">
          <Equal Value1="?PackAssert(ZONE_5).Availability" Value2="1" Not="1" />
          <Less Value1="?Fight(ZONE_4|BOSS_WASP|6).WinCount" Value2="1" Not="1" />
        </Operator>
        <Operator Type="And">
          <Equal Value1="?PackAssert(ZONE_6).Availability" Value2="1" Not="1" />
          <Less Value1="?Fight(ZONE_5|BOSS_HUNTRESS|6).WinCount" Value2="1" Not="1" />
        </Operator>
        <Operator Type="And">
          <Equal Value1="?PackAssert(ZONE_IM).Availability" Value2="1" Not="1" />
          <Equal Value1="?Battle(ZONE_1|BOSS_LYNX_INTERMISSION).Available" Value2="1" />
        </Operator>
      </Operator>
      <Equal Value1="_ShopDownloadOffer" Value2="1" Not="1" />
    </Conditions>
    <Actions>
      <Activate ActionID="ShopCheck" />
      <SetVariable Name="ShopDownloadOffer" Value="1" />
    </Actions>
  </Quest>

  <Quest Name="ForcedPackDownloadWrapper" Priority="1100" Unresumable="1">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="ForcedPackDownloadRetry" />
    </Conditions>
    <Actions>
      <Activate ActionID="ForcedPackDownload" />
    </Actions>
  </Quest>

  <Quest Name="currency_alert" Priority="899" Unresumable="1">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Operator Type="Or">
        <Operator Type="And">
          <Equal Value1="_$ActionID" Value2="Zone2CurrencyAlert" />
          <Equal Not="1" Value1="_Zone2CurrencyAlert" Value2="1" />
        </Operator>
        <Operator Type="And">
          <Equal Value1="_$ActionID" Value2="Zone3CurrencyAlert" />
          <Equal Not="1" Value1="_Zone3CurrencyAlert" Value2="1" />
        </Operator>
        <Operator Type="And">
          <Equal Value1="_$ActionID" Value2="Zone4CurrencyAlert" />
          <Equal Not="1" Value1="_Zone4CurrencyAlert" Value2="1" />
        </Operator>
        <Operator Type="And">
          <Equal Value1="_$ActionID" Value2="Zone5CurrencyAlert" />
          <Equal Not="1" Value1="_Zone5CurrencyAlert" Value2="1" />
        </Operator>
        <Operator Type="And">
          <Equal Value1="_$ActionID" Value2="Zone6CurrencyAlert" />
          <Equal Not="1" Value1="_Zone6CurrencyAlert" Value2="1" />
        </Operator>
      </Operator>
    </Conditions>
    <Actions>
      <Wait Frames="1" />
      <Foreach Type="PaidItems" Name="FindCoinItem" />
      <Wait Frames="1" />
      <Dialog Type="Notification" Image="_Avatar_Notification" >
        <Line Text="dlgNewCurrencyPack" />
        <Button Type="Left" Color="Green" />
        <Button Type="Right" Color="Green" Text="dlgStoryBtnOk" />
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="zone2_ForcedPackDownload" Priority="1100" Unresumable="1">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="ForcedPackDownload" />
      <Equal Value1="?PackAssert(ZONE_2).Availability" Value2="1" Not="1" />
      <Less Value1="?Fight(ZONE_1|BOSS_LYNX|6).WinCount" Value2="1" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <ChangeScene Destination="Map" />
      <ClearQuestQueue />
      <Dialog Type="NoAvatar" Title="dlgServiceTitlePackDownload" >
        <Line Text="dlgServiceDownloadDemand{Act_2}{?PackAssert(ZONE_2).Size}" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Beige" Text="dlgServiceAgreeBtn">
          <Download Pack="ZONE_2" Lock="Silent">
            <Error>
              <Dialog Type="NoAvatar" Title="dlgNotNetworkTitle" >
                <Line Text="dlgServiceDownloadError" ButtonText="dlgStoryBtnMore" />
                <Button Type="Right" Color="Beige" Text="dlgServiceBtnRetry">
                  <Activate ActionID="ForcedPackDownloadRetry" />
                </Button>
              </Dialog>
            </Error>
            <Success>
              <ToggleItems Label="ZONE_2" Toggle="on" />
              <Activate ActionID="Zone2CurrencyAlert" />
              <SetVariable Name="Zone2CurrencyAlert" Value="1" />
              <Activate ActionID="ForcedPackDownloadRetry" />
              <Activate ActionID="Update" />
            </Success>
          </Download>
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="zone2_PackDownload" Priority="900" Unresumable="1">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="PackDownload" />
      <Equal Value1="?PackAssert(ZONE_2).Availability" Value2="1" Not="1" />
      <Less Value1="?Fight(ZONE_1|BOSS_LYNX|6).WinCount" Value2="1" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <ClearQuestQueue />
      <Dialog Type="NoAvatar" Title="dlgServiceTitlePackDownload" >
        <Line Text="dlgServiceDownloadDemand{Act_2}{?PackAssert(ZONE_2).Size}" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Beige" Text="dlgServiceAgreeBtn">
          <Download Pack="ZONE_2" Lock="Silent">
            <Error>
              <Dialog Type="NoAvatar" Title="dlgNotNetworkTitle" >
                <Line Text="dlgServiceDownloadError" ButtonText="dlgStoryBtnMore" />
                <Button Type="Right" Color="Beige" Text="dlgServiceBtnRetry">
                  <Activate ActionID="PackDownloadRetry" />
                </Button>
              </Dialog>
            </Error>
            <Success>
              <ToggleItems Label="ZONE_2" Toggle="on" />
              <Activate ActionID="Zone2CurrencyAlert" />
              <SetVariable Name="Zone2CurrencyAlert" Value="1" />
              <Activate ActionID="PackDownloadRetry" />
              <Activate ActionID="Update" />
            </Success>
          </Download>
        </Button>
        <Button Type="Left" Color="Red" Text="dlgServiceDenyBtn">
          <ClearQuestQueue />
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="zone3_ForcedPackDownload" Priority="1100" Unresumable="1">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="ForcedPackDownload" />
      <Equal Value1="?PackAssert(ZONE_3).Availability" Value2="1" Not="1" />
      <Less Value1="?Fight(ZONE_2|BOSS_HERMIT|6).WinCount" Value2="1" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <ChangeScene Destination="Map" />
      <ClearQuestQueue />
      <Dialog Type="NoAvatar" Title="dlgServiceTitlePackDownload" >
        <Line Text="dlgServiceDownloadDemand{Act_3}{?PackAssert(ZONE_3).Size}" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Beige" Text="dlgServiceAgreeBtn">
          <Download Pack="ZONE_3" Lock="Silent">
            <Error>
              <Dialog Type="NoAvatar" Title="dlgNotNetworkTitle" >
                <Line Text="dlgServiceDownloadError" ButtonText="dlgStoryBtnMore" />
                <Button Type="Right" Color="Beige" Text="dlgServiceBtnRetry">
                  <Activate ActionID="ForcedPackDownloadRetry" />
                </Button>
              </Dialog>
            </Error>
            <Success>
              <ToggleItems Label="ZONE_3" Toggle="on" />
              <Activate ActionID="Zone3CurrencyAlert" />
              <SetVariable Name="Zone3CurrencyAlert" Value="1" />
              <Activate ActionID="ForcedPackDownloadRetry" />
              <Activate ActionID="Update" />
            </Success>
          </Download>
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="zone3_PackDownload" Priority="900" Unresumable="1">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="PackDownload" />
      <Equal Value1="?PackAssert(ZONE_3).Availability" Value2="1" Not="1" />
      <Less Value1="?Fight(ZONE_2|BOSS_HERMIT|6).WinCount" Value2="1" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <ClearQuestQueue />
      <Dialog Type="NoAvatar" Title="dlgServiceTitlePackDownload" >
        <Line Text="dlgServiceDownloadDemand{Act_3}{?PackAssert(ZONE_3).Size}" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Beige" Text="dlgServiceAgreeBtn">
          <Download Pack="ZONE_3" Lock="Silent">
            <Error>
              <Dialog Type="NoAvatar" Title="dlgNotNetworkTitle" >
                <Line Text="dlgServiceDownloadError" ButtonText="dlgStoryBtnMore" />
                <Button Type="Right" Color="Beige" Text="dlgServiceBtnRetry">
                  <Activate ActionID="PackDownloadRetry" />
                </Button>
              </Dialog>
            </Error>
            <Success>
              <ToggleItems Label="ZONE_3" Toggle="on" />
              <Activate ActionID="Zone3CurrencyAlert" />
              <SetVariable Name="Zone3CurrencyAlert" Value="1" />
              <Activate ActionID="PackDownloadRetry" />
              <Activate ActionID="Update" />
            </Success>
          </Download>
        </Button>
        <Button Type="Left" Color="Red" Text="dlgServiceDenyBtn">
          <ClearQuestQueue />
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="zone4_ForcedPackDownload" Priority="1100" Unresumable="1">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="ForcedPackDownload" />
      <Equal Value1="?PackAssert(ZONE_4).Availability" Value2="1" Not="1" />
      <Less Value1="?Fight(ZONE_3|BOSS_BUTCHER|6).WinCount" Value2="1" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <ChangeScene Destination="Map" />
      <ClearQuestQueue />
      <Dialog Type="NoAvatar" Title="dlgServiceTitlePackDownload" >
        <Line Text="dlgServiceDownloadDemand{Act_4}{?PackAssert(ZONE_4).Size}" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Beige" Text="dlgServiceAgreeBtn">
          <Download Pack="ZONE_4" Lock="Silent">
            <Error>
              <Dialog Type="NoAvatar" Title="dlgNotNetworkTitle" >
                <Line Text="dlgServiceDownloadError" ButtonText="dlgStoryBtnMore" />
                <Button Type="Right" Color="Beige" Text="dlgServiceBtnRetry">
                  <Activate ActionID="ForcedPackDownloadRetry" />
                </Button>
              </Dialog>
            </Error>
            <Success>
              <ToggleItems Label="ZONE_4" Toggle="on" />
              <Activate ActionID="Zone4CurrencyAlert" />
              <SetVariable Name="Zone4CurrencyAlert" Value="1" />
              <Activate ActionID="ForcedPackDownloadRetry" />
              <Activate ActionID="Update" />
            </Success>
          </Download>
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="zone4_PackDownload" Priority="900" Unresumable="1">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="PackDownload" />
      <Equal Value1="?PackAssert(ZONE_4).Availability" Value2="1" Not="1" />
      <Less Value1="?Fight(ZONE_3|BOSS_BUTCHER|6).WinCount" Value2="1" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <ClearQuestQueue />
      <Dialog Type="NoAvatar" Title="dlgServiceTitlePackDownload" >
        <Line Text="dlgServiceDownloadDemand{Act_4}{?PackAssert(ZONE_4).Size}" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Beige" Text="dlgServiceAgreeBtn">
          <Download Pack="ZONE_4" Lock="Silent">
            <Error>
              <Dialog Type="NoAvatar" Title="dlgNotNetworkTitle" >
                <Line Text="dlgServiceDownloadError" ButtonText="dlgStoryBtnMore" />
                <Button Type="Right" Color="Beige" Text="dlgServiceBtnRetry">
                  <Activate ActionID="PackDownloadRetry" />
                </Button>
              </Dialog>
            </Error>
            <Success>
              <ToggleItems Label="ZONE_4" Toggle="on" />
              <Activate ActionID="Zone4CurrencyAlert" />
              <SetVariable Name="Zone4CurrencyAlert" Value="1" />
              <Activate ActionID="PackDownloadRetry" />
              <Activate ActionID="Update" />
            </Success>
          </Download>
        </Button>
        <Button Type="Left" Color="Red" Text="dlgServiceDenyBtn">
          <ClearQuestQueue />
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="zone5_ForcedPackDownload" Priority="1100" Unresumable="1">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="ForcedPackDownload" />
      <Equal Value1="?PackAssert(ZONE_5).Availability" Value2="1" Not="1" />
      <Less Value1="?Fight(ZONE_4|BOSS_WASP|6).WinCount" Value2="1" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <ClearQuestQueue />
      <ChangeScene Destination="Map" />
      <Dialog Type="NoAvatar" Title="dlgServiceTitlePackDownload" >
        <Line Text="dlgServiceDownloadDemand{Act_5}{?PackAssert(ZONE_5).Size}" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Beige" Text="dlgServiceAgreeBtn">
          <Download Pack="ZONE_5" Lock="Silent">
            <Error>
              <Dialog Type="NoAvatar" Title="dlgNotNetworkTitle" >
                <Line Text="dlgServiceDownloadError" ButtonText="dlgStoryBtnMore" />
                <Button Type="Right" Color="Beige" Text="dlgServiceBtnRetry">
                  <Activate ActionID="ForcedPackDownloadRetry" />
                </Button>
              </Dialog>
            </Error>
            <Success>
              <ToggleItems Label="ZONE_5" Toggle="on" />
              <Activate ActionID="Zone5CurrencyAlert" />
              <SetVariable Name="Zone5CurrencyAlert" Value="1" />
              <Activate ActionID="ForcedPackDownloadRetry" />
              <Activate ActionID="Update" />
            </Success>
          </Download>
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="zone5_PackDownload" Priority="900" Unresumable="1">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="PackDownload" />
      <Equal Value1="?PackAssert(ZONE_5).Availability" Value2="1" Not="1" />
      <Less Value1="?Fight(ZONE_4|BOSS_WASP|6).WinCount" Value2="1" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <ClearQuestQueue />
      <Dialog Type="NoAvatar" Title="dlgServiceTitlePackDownload" >
        <Line Text="dlgServiceDownloadDemand{Act_5}{?PackAssert(ZONE_5).Size}" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Beige" Text="dlgServiceAgreeBtn">
          <Download Pack="ZONE_5" Lock="Silent">
            <Error>
              <Dialog Type="NoAvatar" Title="dlgNotNetworkTitle" >
                <Line Text="dlgServiceDownloadError" ButtonText="dlgStoryBtnMore" />
                <Button Type="Right" Color="Beige" Text="dlgServiceBtnRetry">
                  <Activate ActionID="PackDownloadRetry" />
                </Button>
              </Dialog>
            </Error>
            <Success>
              <ToggleItems Label="ZONE_5" Toggle="on" />
              <Activate ActionID="Zone5CurrencyAlert" />
              <SetVariable Name="Zone5CurrencyAlert" Value="1" />
              <Activate ActionID="PackDownloadRetry" />
              <Activate ActionID="Update" />
            </Success>
          </Download>
        </Button>
        <Button Type="Left" Color="Red" Text="dlgServiceDenyBtn">
          <ClearQuestQueue />
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="zone6_ForcedPackDownload" Priority="1100" Unresumable="1">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="ForcedPackDownload" />
      <Equal Value1="?PackAssert(ZONE_6).Availability" Value2="1" Not="1" />
      <Less Value1="?Fight(ZONE_5|BOSS_HUNTRESS|6).WinCount" Value2="1" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <ClearQuestQueue />
      <ChangeScene Destination="Map" />
      <Dialog Type="NoAvatar" Title="dlgServiceTitlePackDownload" >
        <Line Text="dlgServiceDownloadDemand{Act_6}{?PackAssert(ZONE_6).Size}" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Beige" Text="dlgServiceAgreeBtn">
          <Download Pack="ZONE_6" Lock="Silent">
            <Error>
              <Dialog Type="NoAvatar" Title="dlgNotNetworkTitle" >
                <Line Text="dlgServiceDownloadError" ButtonText="dlgStoryBtnMore" />
                <Button Type="Right" Color="Beige" Text="dlgServiceBtnRetry">
                  <Activate ActionID="ForcedPackDownloadRetry" />
                </Button>
              </Dialog>
            </Error>
            <Success>
              <ToggleItems Label="ZONE_6" Toggle="on" />
              <Activate ActionID="Zone6CurrencyAlert" />
              <SetVariable Name="Zone6CurrencyAlert" Value="1" />
              <Activate ActionID="ForcedPackDownloadRetry" />
              <Activate ActionID="Update" />
            </Success>
          </Download>
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="zone6_PackDownload" Priority="900" Unresumable="1">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="PackDownload" />
      <Equal Value1="?PackAssert(ZONE_6).Availability" Value2="1" Not="1" />
      <Less Value1="?Fight(ZONE_5|BOSS_HUNTRESS|6).WinCount" Value2="1" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <ClearQuestQueue />
      <Dialog Type="NoAvatar" Title="dlgServiceTitlePackDownload" >
        <Line Text="dlgServiceDownloadDemand{Act_6}{?PackAssert(ZONE_6).Size}" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Beige" Text="dlgServiceAgreeBtn">
          <Download Pack="ZONE_6" Lock="Silent">
            <Error>
              <Dialog Type="NoAvatar" Title="dlgNotNetworkTitle" >
                <Line Text="dlgServiceDownloadError" ButtonText="dlgStoryBtnMore" />
                <Button Type="Right" Color="Beige" Text="dlgServiceBtnRetry">
                  <Activate ActionID="PackDownloadRetry" />
                </Button>
              </Dialog>
            </Error>
            <Success>
              <ToggleItems Label="ZONE_6" Toggle="on" />
              <Activate ActionID="Zone6CurrencyAlert" />
              <SetVariable Name="Zone6CurrencyAlert" Value="1" />
              <Activate ActionID="PackDownloadRetry" />
              <Activate ActionID="Update" />
            </Success>
          </Download>
        </Button>
        <Button Type="Left" Color="Red" Text="dlgServiceDenyBtn">
          <ClearQuestQueue />
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="Intermission_ForcedPackDownload" Priority="1100" Unresumable="1">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="ForcedPackDownload" />
      <Equal Value1="?PackAssert(ZONE_IM).Availability" Value2="1" Not="1" />
      <Equal Value1="?Battle(ZONE_1|BOSS_LYNX_INTERMISSION).Available" Value2="1" />
    </Conditions>
    <Actions Place="Map">
      <ClearQuestQueue />
      <ChangeScene Destination="Map" />
      <Dialog Type="NoAvatar" Title="dlgServiceTitlePackDownload" >
        <Line Text="dlgServiceDownloadDemand{Interlude}{?PackAssert(ZONE_IM).Size}" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Beige" Text="dlgServiceAgreeBtn">
          <Download Pack="ZONE_IM" Lock="Silent">
            <Error>
              <Dialog Type="NoAvatar" Title="dlgNotNetworkTitle" >
                <Line Text="dlgServiceDownloadError" ButtonText="dlgStoryBtnMore" />
                <Button Type="Right" Color="Beige" Text="dlgServiceBtnRetry">
                  <Activate ActionID="ForcedPackDownloadRetry" />
                </Button>
              </Dialog>
            </Error>
            <Success>
              <ToggleItems Label="ZONE_IM" Toggle="on" />
              <Activate ActionID="ForcedPackDownloadRetry" />
              <Activate ActionID="Update" />
            </Success>
          </Download>
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="Intermission_PackDownload" Priority="900" Unresumable="1">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="PackDownload" />
      <Equal Value1="?PackAssert(ZONE_IM).Availability" Value2="1" Not="1" />
      <Equal Value1="?Battle(ZONE_1|BOSS_LYNX_INTERMISSION).Available" Value2="1" />
    </Conditions>
    <Actions Place="Map">
      <ClearQuestQueue />
      <Dialog Type="NoAvatar" Title="dlgServiceTitlePackDownload" >
        <Line Text="dlgServiceDownloadDemand{Interlude}{?PackAssert(ZONE_IM).Size}" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Beige" Text="dlgServiceAgreeBtn">
          <Download Pack="ZONE_IM" Lock="Silent">
            <Error>
              <Dialog Type="NoAvatar" Title="dlgNotNetworkTitle" >
                <Line Text="dlgServiceDownloadError" ButtonText="dlgStoryBtnMore" />
                <Button Type="Right" Color="Beige" Text="dlgServiceBtnRetry">
                  <Activate ActionID="PackDownloadRetry" />
                </Button>
              </Dialog>
            </Error>
            <Success>
              <ToggleItems Label="ZONE_IM" Toggle="on" />
              <Activate ActionID="PackDownloadRetry" />
              <Activate ActionID="Update" />
            </Success>
          </Download>
        </Button>
        <Button Type="Left" Color="Red" Text="dlgServiceDenyBtn">
          <ClearQuestQueue />
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="ForcedPackDownload_ResumeQuests" Priority="1000" Unresumable="1">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="ForcedPackDownload" />
      <Operator Type="Or">
        <Equal Value1="?PackAssert(ZONE_1).Availability" Value2="1" Not="1" />
        <Equal Value1="?PackAssert(ZONE_2).Availability" Value2="1" Not="1" />
        <Equal Value1="?PackAssert(ZONE_3).Availability" Value2="1" Not="1" />
        <Equal Value1="?PackAssert(ZONE_4).Availability" Value2="1" Not="1" />
        <Equal Value1="?PackAssert(ZONE_5).Availability" Value2="1" Not="1" />
        <Equal Value1="?PackAssert(ZONE_6).Availability" Value2="1" Not="1" />
        <Equal Value1="?PackAssert(ZONE_IM).Availability" Value2="1" Not="1" />
      </Operator>
    </Conditions>
    <Actions>
      <ResumeQuests />
    </Actions>
  </Quest>

  <Quest Name="LowFPSWarning">
    <Events>
      <FightEnd />
    </Events>
    <Conditions>
      <LessEqual Value1="_$FightAvgFPS" Value2="50" />
      <Greater Value1="_$FightAvgFPS" Value2="0" />
      <Equal Value1="?SysInfo().QualityCondition" Value2="LOW" Not="1"/>
      <Equal Value1="_LowFpsWarningShown" Value2="0"/>
      <Equal Not="1" Value1="_LowFPSWarningCheckBox" Value2="1"/>
    </Conditions>
    <Actions>
      <Dialog Type="NoAvatar" Title="dlgAlertTitle" >
        <Line Text="dlgLowFPSWarning" ButtonText="dlgStoryBtnMore"/>
        <Button Type="Right" Color="Beige" Text="dlgStoryBtnOk" />
        <CheckBox Text="dlgDontShowAgain" InitialValue="_LowFPSWarningCheckBox">
          <On>
            <SetVariable Name="LowFPSWarningCheckBox" Value="1" />
          </On>
          <Off>
            <SetVariable Name="LowFPSWarningCheckBox" Value="0" />
          </Off>
        </CheckBox>
      </Dialog>
      <SetVariable Name="LowFpsWarningShown" Value="1" />
    </Actions>
  </Quest>

  <!-- Language Selection and Downloads-->

  <Quest Name="lang_FirstLaunch" Priority="9999">
    <Events>
      <SessionStart />
    </Events>
    <Conditions>
      <Equal Value1="_lang_FirstLaunch_Shown" Value2="1" Not="1" />
    </Conditions>
    <Actions>
      <SetVariable Name="lang_FirstLaunch_Shown" Value="1" />
      <ClearQuestQueue Name="lang_SessionStartCheck" />
      <Activate ActionID="LangLocaleBased" />
    </Actions>
  </Quest>

  <Quest Name="lang_PackActivation" Priority="880" >
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="ForcedPackDownloadRetry" />
    </Conditions>
    <Actions>
      <SetVariable Name="langPrevious" Value="?Player().Language" />
      <SetVariable Name="langCurrent" Value="?Player().Language" />
      <Activate ActionID="LangReDownload" />
    </Actions>
  </Quest>

  <Quest Name="lang_LocaleBased_chn_tr" Priority="801" Group="LangSelection">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="LangLocaleBased" />
      <Operator Type="Or">
        <Equal Value1="?Slice(?SysInfo().Language,3,4)" Value2="TW" />
        <Equal Value1="?Slice(?SysInfo().Language,3,4)" Value2="MO" />
        <Equal Value1="?Slice(?SysInfo().Language,3,4)" Value2="HK" />
      </Operator>
    </Conditions>
    <Actions>
      <SetVariable Name="langPrevious" Value="?Player().Language" />
      <SetVariable Name="langCurrent" Value="chn_tr" />
      <Activate ActionID="LangReDownload" />
    </Actions>
  </Quest>

  <Quest Name="lang_LocaleBased_chn" Priority="800" Group="LangSelection">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="LangLocaleBased" />
      <Equal Value1="?Slice(?SysInfo().Language,0,1)" Value2="zh" />
    </Conditions>
    <Actions>
      <SetVariable Name="langPrevious" Value="?Player().Language" />
      <SetVariable Name="langCurrent" Value="chn" />
      <Activate ActionID="LangReDownload" />
    </Actions>
  </Quest>

  <Quest Name="lang_LocaleBased_kor" Priority="800" Group="LangSelection">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="LangLocaleBased" />
      <Equal Value1="?Slice(?SysInfo().Language,0,1)" Value2="ko" />
    </Conditions>
    <Actions>
      <SetVariable Name="langPrevious" Value="?Player().Language" />
      <SetVariable Name="langCurrent" Value="kor" />
      <Activate ActionID="LangReDownload" />
    </Actions>
  </Quest>

  <Quest Name="lang_LocaleBased_jpn" Priority="800" Group="LangSelection">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="LangLocaleBased" />
      <Equal Value1="?Slice(?SysInfo().Language,0,1)" Value2="ja" />
    </Conditions>
    <Actions>
      <SetVariable Name="langPrevious" Value="?Player().Language" />
      <SetVariable Name="langCurrent" Value="jpn" />
      <Activate ActionID="LangReDownload" />
    </Actions>
  </Quest>

  <Quest Name="lang_SessionStartCheck" Priority="800" Group="LangSelection">
    <Events>
      <SessionStart />
    </Events>
    <Conditions>
      <Equal Value1="?PackAssert(?Player().Language).Availability" Value2="1" Not="1" />
    </Conditions>
    <Actions>
      <SetVariable Name="langPrevious" Value="?Player().Language" />
      <SetVariable Name="langCurrent" Value="?Player().Language" />
      <Activate ActionID="LangReDownload" />
    </Actions>
  </Quest>

  <Quest Name="lang_MenuSwitch" Group="LangSelection">
    <Events>
      <SettingsLangSwitch />
    </Events>
    <Conditions>
      <Equal Value1="?SysInfo().China" Value2="1" Not="1" />
      <Equal Value1="?SysInfo().Korea" Value2="1" Not="1" />
      <Operator Type="Or">
        <Equal Value1="_$ChosenLocale" Value2="chn" />
        <Equal Value1="_$ChosenLocale" Value2="chn_tr" />
        <Equal Value1="_$ChosenLocale" Value2="kor" />
        <Equal Value1="_$ChosenLocale" Value2="jpn" />
      </Operator>
      <Equal Value1="?PackAssert(_$ChosenLocale).Availability" Value2="1" Not="1" />
    </Conditions>
    <Actions>
      <SetVariable Name="langPrevious" Value="?Player().Language" />
      <SetVariable Name="langCurrent" Value="_$ChosenLocale" />
      <Activate ActionID="LangReDownload" />
    </Actions>
  </Quest>

  <Quest Name="lang_PackDownload_chn_tr" Priority="800" Group="LangSelection">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="LangReDownload" />
      <Equal Value1="_langCurrent" Value2="chn_tr" />
      <Equal Value1="?SysInfo().China" Value2="1" Not="1" />
      <Equal Value1="?PackAssert(chn_tr).Availability" Value2="1" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <Dialog Type="NoAvatar" Title="dlgServiceTitlePackDownload" >
        <Line Text="dlgServiceDownloadDemand{dlgSenseiLevelIndicator{textures/buttons/menu/settings/chn.png}{%ChineseTraditional}}{?PackAssert(chn_tr).Size}" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Green" Text="dlgServiceAgreeBtn">
          <Download Pack="chn_tr" Lock="Silent">
            <Error>
              <Dialog Type="NoAvatar" Title="dlgNotNetworkTitle" >
                <Line Text="dlgServiceDownloadError" ButtonText="dlgStoryBtnMore" />
                <Button Type="Right" Color="Beige" Text="dlgServiceBtnRetry">
                  <ForceExecution Name="lang_PackDownload_chn_tr" />
                </Button>
              </Dialog>
            </Error>
            <Success>
              <SetLanguage Name="chn_tr" />
              <SetVariable Name="langCurrent" Value="chn_tr" />
              <ClearQuestQueue Name="LangSelection"/>
            </Success>
          </Download>
        </Button>
        <Button Type="Left" Color="Red" Text="dlgServiceDenyBtn">
          <SetVariable Name="langCurrent" Value="_langPrevious" />
          <ClearQuestQueue Name="LangSelection"/>
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="lang_PackDownload_chn" Priority="800" Group="LangSelection">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="LangReDownload" />
      <Equal Value1="_langCurrent" Value2="chn" />
      <Equal Value1="?SysInfo().China" Value2="1" Not="1" />
      <Equal Value1="?PackAssert(chn).Availability" Value2="1" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <Dialog Type="NoAvatar" Title="dlgServiceTitlePackDownload" >
        <Line Text="dlgServiceDownloadDemand{dlgSenseiLevelIndicator{textures/buttons/menu/settings/chn.png}{%ChineseSimplified}}{?PackAssert(chn).Size}" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Green" Text="dlgServiceAgreeBtn">
          <Download Pack="chn" Lock="Silent">
            <Error>
              <Dialog Type="NoAvatar" Title="dlgNotNetworkTitle" >
                <Line Text="dlgServiceDownloadError" ButtonText="dlgStoryBtnMore" />
                <Button Type="Right" Color="Beige" Text="dlgServiceBtnRetry">
                  <Activate ActionID="LangReDownload" />
                </Button>
              </Dialog>
            </Error>
            <Success>
              <SetLanguage Name="chn" />
              <SetVariable Name="langCurrent" Value="chn" />
              <ClearQuestQueue Name="LangSelection"/>
            </Success>
          </Download>
        </Button>
        <Button Type="Left" Color="Red" Text="dlgServiceDenyBtn">
          <SetVariable Name="langCurrent" Value="_langPrevious" />
          <ClearQuestQueue Name="LangSelection"/>
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="lang_PackDownload_kor" Priority="800" Group="LangSelection">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="LangReDownload" />
      <Equal Value1="_langCurrent" Value2="kor" />
      <Equal Value1="?SysInfo().Korea" Value2="1" Not="1" />
      <Equal Value1="?PackAssert(kor).Availability" Value2="1" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <Dialog Type="NoAvatar" Title="dlgServiceTitlePackDownload" >
        <Line Text="dlgServiceDownloadDemand{dlgSenseiLevelIndicator{textures/buttons/menu/settings/kor.png}{%Korean}}{?PackAssert(kor).Size}" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Green" Text="dlgServiceAgreeBtn">
          <Download Pack="kor" Lock="Silent">
            <Error>
              <Dialog Type="NoAvatar" Title="dlgNotNetworkTitle" >
                <Line Text="dlgServiceDownloadError" ButtonText="dlgStoryBtnMore" />
                <Button Type="Right" Color="Beige" Text="dlgServiceBtnRetry">
                  <ForceExecution Name="lang_PackDownload_kor" />
                </Button>
              </Dialog>
            </Error>
            <Success>
              <SetLanguage Name="kor" />
              <SetVariable Name="langCurrent" Value="kor" />
              <ClearQuestQueue Name="LangSelection"/>
            </Success>
          </Download>
        </Button>
        <Button Type="Left" Color="Red" Text="dlgServiceDenyBtn">
          <SetVariable Name="langCurrent" Value="_langPrevious" />
          <ClearQuestQueue Name="LangSelection"/>
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="lang_PackDownload_jpn" Priority="800" Group="LangSelection">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="LangReDownload" />
      <Equal Value1="_langCurrent" Value2="jpn" />
      <Equal Value1="?PackAssert(jpn).Availability" Value2="1" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <Dialog Type="NoAvatar" Title="dlgServiceTitlePackDownload" >
        <Line Text="dlgServiceDownloadDemand{dlgSenseiLevelIndicator{textures/buttons/menu/settings/jpn.png}{%Japanese}}{?PackAssert(jpn).Size}" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Green" Text="dlgServiceAgreeBtn">
          <Download Pack="jpn" Lock="Silent">
            <Error>
              <Dialog Type="NoAvatar" Title="dlgNotNetworkTitle" >
                <Line Text="dlgServiceDownloadError" ButtonText="dlgStoryBtnMore" />
                <Button Type="Right" Color="Beige" Text="dlgServiceBtnRetry">
                  <ForceExecution Name="lang_PackDownload_jpn" />
                </Button>
              </Dialog>
            </Error>
            <Success>
              <SetLanguage Name="jpn" />
              <SetVariable Name="langCurrent" Value="jpn" />
              <ClearQuestQueue Name="LangSelection"/>
            </Success>
          </Download>
        </Button>
        <Button Type="Left" Color="Red" Text="dlgServiceDenyBtn">
          <SetVariable Name="langCurrent" Value="_langPrevious" />
          <ClearQuestQueue Name="LangSelection"/>
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="ShowUpgrades" Priority="-10">
    <Events>
      <FightEnd />
    </Events>
    <Conditions>
      <Equal Not="1" Value1="_$FightResult" Value2="Surrender" />
      <Operator Type="Or">
        <Less Value1="?Item(WEAPON_SAI).Quantity" Value2="1" Not="1" />
        <Less Value1="?Item(ARMOR_OLD_LEATHER).Quantity" Value2="1" Not="1" />
        <Less Value1="?Item(HELM_KENDO_MASK).Quantity" Value2="1" Not="1" />
        <Less Value1="?Player().Level" Value2="4" Not="1" />
      </Operator>
      <Equal Value1="_ShowUpgrades" Value2="1" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <ShowUpgrades />
      <Dialog Type="Regular" Title="_Title_Assistant" Image="_Avatar_Assistant_1" >
        <Line Text="upgrades_unlocked" ButtonText="dlgStoryBtnMore" />
        <Button Type="Left" Color="Red" Text="dlgLaterBtn" />
        <Button Type="Right" Color="Green" Text="dlgStoryBtnStore">
          <Activate ActionID="ShowUpgrades" />
        </Button>
      </Dialog>
      <SetVariable Name="ShowUpgrades" Value="1" />
    </Actions>
  </Quest>

  <Quest Name="ShowUpgradesSai" Priority="20">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="ShowUpgrades" />
      <Less Value1="?Item(WEAPON_SAI).Quantity" Value2="1" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <OpenShop Tab="Weapon" Item="WEAPON_SAI" />
    </Actions>
  </Quest>

  <Quest Name="ShowUpgradesOldLeather" Priority="20">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="ShowUpgrades" />
      <GreaterEqual Not="1" Value1="?Item(WEAPON_SAI).Quantity" Value2="1" />
      <Less Value1="?Item(ARMOR_OLD_LEATHER).Quantity" Value2="1" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <OpenShop Tab="Armor" Item="ARMOR_OLD_LEATHER" />
    </Actions>
  </Quest>

  <Quest Name="ShowUpgradesKendoMask" Priority="20">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="ShowUpgrades" />
      <GreaterEqual Not="1" Value1="?Item(WEAPON_SAI).Quantity" Value2="1" />
      <GreaterEqual Not="1" Value1="?Item(ARMOR_OLD_LEATHER).Quantity" Value2="1" />
      <Less Value1="?Item(HELM_KENDO_MASK).Quantity" Value2="1" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <OpenShop Tab="Helm" Item="HELM_KENDO_MASK" />
    </Actions>
  </Quest>

  <Quest Name="ShowUpgradesKnives" Priority="20">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="ShowUpgrades" />
      <GreaterEqual Not="1"  Value1="?Item(WEAPON_SAI).Quantity" Value2="1" />
      <GreaterEqual Not="1"  Value1="?Item(ARMOR_OLD_LEATHER).Quantity" Value2="1" />
      <GreaterEqual Not="1"  Value1="?Item(HELM_KENDO_MASK).Quantity" Value2="1" />
    </Conditions>
    <Actions Place="Map">
      <OpenShop Tab="Weapon" Item="WEAPON_KNIVES" />
    </Actions>
  </Quest>

  <Quest Name="ShowNews" Priority="-20" Unresumable="1">
    <Events>
      <SessionStart />
    </Events>
    <Conditions>
      <Equal Value1="_Zone1Discount1Offer" Value2="1" Not="1" />
      <Less Value1="?Fight(ZONE_1|Tournament|1).WinCount" Value2="1" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <ShowNews />
    </Actions>
  </Quest>

  <Quest Name="DifficultyAlert" Group="FightEnter">
    <Events>
      <FightEnter />
    </Events>
    <Conditions>
      <Less Value1="?Fight(_$Fight).Difficulty" Value2="5" Not="1" />
      <Equal Value1="_DifficultyAlert" Value2="1" Not="1" />
      <Equal Value1="_$Fight" Value2="ZONE_1|BOSS_LYNX|6" Not="1" />
      <Equal Value1="?Fight(_$Fight).Zone" Value2="ZONE_1" />
      <Equal Value1="?Fight(_$Fight).Battle" Value2="Survival" Not="1" />
      <Equal Value1="?Fight(_$Fight).Battle" Value2="BOSS_LYNX_INTERMISSION" Not="1" />
      <Equal Value1="?Fight(_$Fight).Battle" Value2="BOSS_HERMIT_INTERMISSION" Not="1" />
      <Equal Value1="?Fight(_$Fight).Battle" Value2="BOSS_BUTCHER_INTERMISSION" Not="1" />
      <Equal Value1="?Fight(_$Fight).Battle" Value2="BOSS_WASP_INTERMISSION" Not="1" />
      <Equal Value1="?Fight(_$Fight).Battle" Value2="BOSS_HUNTRESS_INTERMISSION" Not="1" />
      <Equal Value1="?Fight(_$Fight).Battle" Value2="BOSS_SAMURAI_INTERMISSION" Not="1" />
      <Equal Value1="?Fight(_$Fight).Battle" Value2="FINAL_BATTLE" Not="1" />
      <Equal Value1="?Fight(_$Fight).Battle" Value2="Survival_INTERMISSION" Not="1" />
      <Equal Value1="?Fight(_$Fight).Battle" Value2="Stranger" Not="1" />
      <Equal Value1="?Fight(_$Fight).Battle" Value2="Stranger_INTERMISSION" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <Dialog Type="Regular" Title="_Title_Assistant" Image="_Avatar_Assistant_1" >
        <Line Text="tutorial_difficulty_notice" ButtonText="dlgStoryBtnMore" />       
        <Button Type="Left" Color="Beige" Text="dlgLaterBtn" >
          <ClearQuestQueue Name="FightEnter" />
        </Button>
        <Button Type="Right" Color="Red" Text="dlgStoryBtnFight">
          <Fight Name="_$Fight" />
        </Button>
      </Dialog>
      <SetVariable Name="DifficultyAlert" Value="1" />
    </Actions>
  </Quest>

  <Quest Name="RatingOfferChina" Unresumable="1" Priority="-10" Group="Advertising">
    <Events>
      <FightEnd />
    </Events>
    <Conditions>
      <Equal Value1="?Fight(_$Fight).Zone" Value2="Punchbag" Not="1" />
      <Equal Value1="_$FightResult" Value2="Win" />
      <Equal Value1="_$Fight" Value2="ZONE_1|BOSS_LYNX|1" Not="1" />
      <Equal Value1="_$Fight" Value2="ZONE_1|BOSS_LYNX|2" Not="1" />
      <Equal Value1="_$Fight" Value2="ZONE_1|Tournament|1" Not="1" />
      <Equal Value1="?SysInfo().Amazon" Value2="1" Not="1" />
      <Equal Value1="?SysInfo().OsName" Value2="WP8" Not="1" />
      <Equal Value1="?SysInfo().China" Value2="1" />
      <Equal Value1="_RatingTurnedOff" Value2="1" Not="1" />
      <Greater Value1="?Sub(?SysInfo().Time,_LastRatingOfferTime)" Value2="?Multi(8,60,60)" />
    </Conditions>
    <Actions>
      <Dialog Type="Multiline" Title="_Title_Assistant" Image="_Avatar_Assistant_4" >
        <Line Text="rateDlgMessage" ButtonText="dlgStoryBtnMore" />
        <Button Type="Left" Color="Red" Text="rateDlgBtn3Text">
          <SetVariable Name="RatingTurnedOff" Value="1" />
        </Button>
        <Button Type="Middle" Color="Beige" Text="rateDlgBtn2Text">
          <SetVariable Name="LastRatingOfferTime" Value="?SysInfo().Time" />
        </Button>
        <Button Type="Right" Color="Green" Text="rateDlgBtn1Text">
          <SetVariable Name="RatingTurnedOff" Value="1" />
          <OpenUrl URL="?SysInfo().RatingUrl" />
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="RatingOffer" Unresumable="1" Priority="-10" Group="Advertising">
    <Events>
      <FightEnd />
    </Events>
    <Conditions>
      <Equal Value1="?Fight(_$Fight).Zone" Value2="Punchbag" Not="1" />
      <Equal Value1="_$FightResult" Value2="Win" />
      <Equal Value1="_$Fight" Value2="ZONE_1|BOSS_LYNX|1" Not="1" />
      <Equal Value1="_$Fight" Value2="ZONE_1|BOSS_LYNX|2" Not="1" />
      <Equal Value1="_$Fight" Value2="ZONE_1|Tournament|1" Not="1" />
      <Equal Value1="?SysInfo().Amazon" Value2="1" Not="1" />
      <Equal Value1="?SysInfo().OsName" Value2="WP8" Not="1" />
      <Equal Value1="?SysInfo().China" Value2="1" Not="1" />
      <Equal Value1="_RatingTurnedOff" Value2="1" Not="1" />
      <Greater Value1="?Sub(?SysInfo().Time,_LastRatingOfferTime)" Value2="?Multi(8,60,60)" />
    </Conditions>
    <Actions>
      <Dialog Type="Multiline" Title="_Title_Assistant" Image="_Avatar_Assistant_4" >
        <Line Text="rateDlgMessage1" ButtonText="dlgStoryBtnMore" />
        <Button Type="Left" Color="Red" Text="dlgStoryNegative">
          <Dialog Type="Multiline" Title="_Title_Assistant" Image="_Avatar_Assistant_3" >
            <Line Text="rateDlgMessage3" ButtonText="dlgStoryBtnMore" />
            <Button Type="Left" Color="Red" Text="rateDlgBtn3Text">
              <SetVariable Name="RatingTurnedOff" Value="1" />
            </Button>
            <Button Type="Middle" Color="Beige" Text="rateDlgBtn2Text">
              <SetVariable Name="LastRatingOfferTime" Value="?SysInfo().Time" />
            </Button>
            <Button Type="Right" Color="Green" Text="dlgStoryBtnOk">
              <SetVariable Name="RatingTurnedOff" Value="1" />
              <OpenUrl URL="?SysInfo().FBLikeUrl" ALT_URL="?SysInfo().FBLikeAltUrl" />
            </Button>
          </Dialog>
        </Button>
        <Button Type="Right" Color="Green" Text="rateDlgBtn1Text">
          <Dialog Type="Multiline" Title="_Title_Assistant" Image="_Avatar_Assistant_4" >
            <Line Text="rateDlgMessage2" ButtonText="dlgStoryBtnMore" />
            <Button Type="Left" Color="Red" Text="rateDlgBtn3Text">
              <SetVariable Name="RatingTurnedOff" Value="1" />
            </Button>
            <Button Type="Middle" Color="Beige" Text="rateDlgBtn2Text">
              <SetVariable Name="LastRatingOfferTime" Value="?SysInfo().Time" />
            </Button>
            <Button Type="Right" Color="Green" Text="rateDlgBtn1Text">
              <SetVariable Name="RatingTurnedOff" Value="1" />
              <OpenUrl URL="?SysInfo().RatingUrl" />
            </Button>
          </Dialog>
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="RollMoPubAd" Unresumable="1" Priority="-100" Group="Advertising">
    <Events>
      <FightEnd />
    </Events>
    <Conditions>
      <Equal Not="1" Value1="_$FightResult" Value2="Surrender" />
      <Equal Value1="?Fight(_$Fight).Zone" Value2="Punchbag" Not="1" />
      <Equal Value1="?Fight(_$Fight).Zone" Value2="ZONE_1" Not="1" />
      <Equal Value1="_$Fight" Value2="ZONE_6|FINAL_BATTLE|1" Not="1"/>
      <Equal Value1="?SysInfo().OsName" Value="WINDOWS" Not="1" />
    </Conditions>
    <Actions>
      <SetVariable Name="OurAdRoll" Value="?UniformIntRandom(1,100)"/>
      <SetVariable Name="PubAdRoll" Value="?UniformIntRandom(1,100)"/>
      <Activate ActionID="ShowAd" />
    </Actions>
  </Quest>

  <Quest Name="ShowAd" Unresumable="1" Priority="-100" Group="Advertising">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="ShowAd" />
      <Equal Value1="?SysInfo().OsName" Value="WINDOWS" Not="1" />
      <Greater Not="1" Value1="_PubAdRoll" Value2="?SessionSettings().AdvertRate" />
      <Greater Not="1" Value1="_DiscipleFlag" Value2="0" />
      <Less Not="1" Value1="_OurAdRoll" Value2="15" />
    </Conditions>
    <Actions>
      <ShowAd Type="MoPub" Lock="Visible" >
        <Error />
        <Success />
      </ShowAd>
    </Actions>
  </Quest>

  <Quest Name="ShowOurAd" Unresumable="1" Priority="-101" Group="Advertising">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="ShowAd" />
      <Equal Value1="?SysInfo().OsName" Value="WINDOWS" Not="1" />
      <Greater Not="1" Value1="_PubAdRoll" Value2="?SessionSettings().AdvertRate" />
      <Greater Not="1" Value1="_DiscipleFlag" Value2="0" />
      <Less Value1="_OurAdRoll" Value2="15" />
    </Conditions>
    <Actions>
      <Dialog Type="Multiline" Title="_Title_Assistant" Image="_Avatar_Assistant_1" IgnoreBack="1">
        <Line Text="dlgPaymentAd" ButtonText="dlgStoryBtnMore" />
        <Button Type="Left" Color="Red" Text="dlgLaterBtn" />
        <Button Type="Right" Color="Green" Text="dlgStoryBtnStore">
          <OpenShop Tab="Ruby" />
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="TapjoyOnTutorialCompletionAndroid" >
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="TapjoyTutorialCompleted" />
      <Equal Value1="?SysInfo().OsName" Value2="ANDROID" />
    </Conditions>
    <Actions>
      <TapjoyActionCall EngagementID="5873b88f-247b-4391-9f07-49b398b61c76" />
    </Actions>
  </Quest>

  <Quest Name="TapjoyOnTutorialCompletionIOS" >
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="TapjoyTutorialCompleted" />
      <Equal Value1="?SysInfo().OsName" Value2="IPHONE" />
    </Conditions>
    <Actions>
      <TapjoyActionCall EngagementID="6de15cc2-c643-437a-9b7e-b20477f0da7c" />
    </Actions>
  </Quest>

  <Quest Name="TapjoyOnThirdLevelAndroid" Priority="-10">
    <Events>
      <FightEnd />
    </Events>
    <Conditions>
      <Equal Value1="?SysInfo().OsName" Value2="ANDROID" />
      <Equal Value1="?Player().Level" Value2="3" />
      <Equal Not="1" Value1="_$FightResult" Value2="Surrender" />
      <Equal Value1="_$LevelUp" Value2="1" />
    </Conditions>
    <Actions>
      <TapjoyActionCall EngagementID="9471dec8-e956-407e-b417-8fefbcbf6e2b" />
    </Actions>
  </Quest>

  <Quest Name="TapjoyOnThirdLevelIOS" Priority="-10">
    <Events>
      <FightEnd />
    </Events>
    <Conditions>
      <Equal Value1="?SysInfo().OsName" Value2="IPHONE" />
      <Equal Value1="?Player().Level" Value2="3" />
      <Equal Not="1" Value1="_$FightResult" Value2="Surrender" />
      <Equal Value1="_$LevelUp" Value2="1" />
    </Conditions>
    <Actions>
      <TapjoyActionCall EngagementID="a9291432-ad10-48a1-9fd8-eb6cd4430132" />
    </Actions>
  </Quest>

  <Quest Name="SetDojoDiscipleFlag" Unresumable="1" Priority="-110">
    <Events>
      <Purchase />
    </Events>
    <Conditions>
      <Equal Value1="?Purchase(_$Purchase).Type" Value2="RealMoneyItem" />
      <Operator Type="And">
        <Equal Value1="_DiscipleFlag" Value2="1" Not="1"/>
        <Equal Value1="_DiscipleFlag" Value2="2" Not="1"/>
      </Operator>
    </Conditions>
    <Actions>
      <SetVariable Name="DiscipleFlag" Value="1" />
    </Actions>
  </Quest>

  <Quest Name="DojoDiscipleGreetings" Priority="-110">
    <Events>
      <ChangeTab />
    </Events>
    <Conditions>
      <Equal Value1="_$SceneTo" Value2="Map" />
      <Operator Type="Or">
        <Equal Not="1" Value1="_$SceneFrom" Value2="Fight" />
        <Equal Value1="?Fight(_$Fight).Zone" Value2="Punchbag" />
      </Operator>
      <Equal Value1="_DiscipleFlag" Value2="1" />
    </Conditions>
    <Actions>
      <ChangeScene Destination="Map" />
      <SetSessionSettings Name="ShowDojoDisciple" Value="1"/>
      <SetVariable Name="DiscipleFlag" Value="2" />
      <Dialog Type="Regular" Title="characterDisciple" Image="character_disciple" >
        <Line Text="dlgDiscipleGreetings" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Text="dlgStoryBtnOk" >
          <Dialog Type="Regular" Title="characterDisciple" Image="character_disciple" >
            <Line Text="dlgDiscipleAccept{textures/misc/btn_disciple_small.png}" ButtonText="dlgStoryBtnOk" />
            <Button Type="Right" Text="dlgStoryBtnOk" />
          </Dialog>
        </Button>
        <Button Type="Left" Text="dlgStoryBtnReject" >
          <Dialog Type="Regular" Title="characterDisciple" Image="character_disciple" >
            <Line Text="dlgDiscipleReject{textures/misc/btn_disciple_small.png}" ButtonText="dlgStoryBtnOk" />
            <Button Type="Right" Text="dlgStoryBtnOk" />
          </Dialog>
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="UpdateStart" Priority="1000" Unresumable="1">
    <Events>
      <SessionStart />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'8'1'2Mark" Value2="1" Not="1" />
    </Conditions>
    <Actions>
      <Activate ActionID="Update" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'1'0'0Part1" Priority="999">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'1'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="0" />
      <Equal Value1="?ItemsOfType(Armor).Quantity" Value2="1" Not="1" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="ArmorAdvice" Value="1" />
      <SetVariable Name="ArmorRegister" Value="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'1'0'0Part2" Priority="999">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'1'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="0" />
      <Equal Value1="?ItemsOfType(Helm).Quantity" Value2="1" Not="1" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="HelmAdvice" Value="1" />
      <SetVariable Name="HelmRegister" Value="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'1'0'0Part3" Priority="999">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'1'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="0" />
      <Operator Type="Or">
        <Operator Type="And">
          <Less Value1="?Player().Money" Value2="?Item(WEAPON_SAI).NextMoneyUpgradePrice" Not="1" />
          <Less Value1="?Item(WEAPON_SAI).Quantity" Value2="1" Not="1" />
        </Operator>
        <Operator Type="And">
          <Less Value1="?Player().Money" Value2="?Item(WEAPON_STEEL_BATONS).NextMoneyUpgradePrice" Not="1" />
          <Less Value1="?Item(WEAPON_STEEL_BATONS).Quantity" Value2="1" Not="1" />
        </Operator>
        <Greater Value1="?Player().Level" Value2="4" />
      </Operator>
      <Equal Value1="_ShowUpgrades" Value2="1" Not="1" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <ForceExecution Name="ShowUpgrades" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'1'0'0Part4" Priority="999">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'1'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="0" />
      <Greater Value1="?Fight(ZONE_1|BOSS_LYNX|6).WinCount" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <ChangeScene Destination="Map" />
      <ForceExecution Name="Lynx_beaten" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'1'0'0Final" Priority="998">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'1'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <HideBattle Name="ZONE_2|BOSS_BUTCHER|" />
      <ShowBattle Name="ZONE_2|BOSS_HERMIT_LOCKED|" />
      <ShowBattle Name="ZONE_3|BOSS_BUTCHER_LOCKED|" />
      <ShowBattle Name="ZONE_4|BOSS_WASP_LOCKED|" />
      <SetVariable Name="TournamentAdvice" Value="1" />
      <SetVariable Name="UpdateTo1'1'0'0Mark" Value="1" />
      <SetDataVersion Production="1" Major="1" Minor="0" DataVersion="0" />
      <Activate ActionID="Update" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'1'0'1Final" Priority="997">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'1'0'1Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="1" />
      <Equal Value1="?DataVersion().Minor" Value2="0" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="UpdateTo1'1'0'1Mark" Value="1" />
      <SetDataVersion Production="1" Major="1" Minor="0" DataVersion="1" />
      <Activate ActionID="Update" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'1'1'0Final" Priority="996">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'1'1'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="1" />
      <Equal Value1="?DataVersion().Minor" Value2="0" />
      <Equal Value1="?DataVersion().DataVersion" Value2="1" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="UpdateTo1'1'1'0Mark" Value="1" />
      <SetDataVersion Production="1" Major="1" Minor="1" DataVersion="0" />
      <Activate ActionID="Update" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'2'0'0Part1" Priority="996">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'2'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="1" />
      <Equal Value1="?DataVersion().Minor" Value2="1" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <Equal Value1="?Fight(ZONE_3|BOSS_BUTCHER|6).WinCount" Value2="0" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <ChangeScene Destination="Map" />
      <ForceExecution Name="Butcher_beaten" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'2'0'0AndroidPart1" Priority="996">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'2'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="1" />
      <Equal Value1="?DataVersion().Minor" Value2="1" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <Equal Value1="?SysInfo().OsName" Value2="ANDROID" />
    </Conditions>
    <Actions Place="Map">
      <Recount Lock="Visible" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'2'0'0Final" Priority="995">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'2'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="1" />
      <Equal Value1="?DataVersion().Minor" Value2="1" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <ShowBattle Name="ZONE_5|BOSS_HUNTRESS_LOCKED" />
      <SetVariable Name="UpdateTo1'2'0'0Mark" Value="1" />
      <SetVariable Name="NewItemsAnnounce" Value="1" />
      <SetDataVersion Production="1" Major="2" Minor="0" DataVersion="0" />
      <AttachQuestFile File="assets/quest_extensions/update_1_2_0_0.xml" />
      <Activate ActionID="ULTransform" />
      <Activate ActionID="Update" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'3'0'0Part1" Priority="996">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'3'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="2" />
      <Equal Value1="?DataVersion().Minor" Value2="0" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <Less Value1="?Fight(ZONE_1|BOSS_LYNX|6).WinCount" Value2="1" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <GiveItem Name="drop_name_blueseal" PutOn="0" Quantity="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'3'0'0Part2" Priority="995">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'3'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="2" />
      <Equal Value1="?DataVersion().Minor" Value2="0" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <Less Value1="?Fight(ZONE_2|BOSS_HERMIT|6).WinCount" Value2="1" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <GiveItem Name="drop_name_greenseal" PutOn="0" Quantity="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'3'0'0Part3" Priority="994">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'3'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="2" />
      <Equal Value1="?DataVersion().Minor" Value2="0" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <Less Value1="?Fight(ZONE_3|BOSS_BUTCHER|6).WinCount" Value2="1" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <GiveItem Name="drop_name_redseal" PutOn="0" Quantity="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'3'0'0Part4" Priority="993">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'3'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="2" />
      <Equal Value1="?DataVersion().Minor" Value2="0" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <Less Value1="?Fight(ZONE_4|BOSS_WASP|6).WinCount" Value2="1" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <GiveItem Name="drop_name_purpleseal" PutOn="0" Quantity="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'3'0'0Part5" Priority="992">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'3'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="2" />
      <Equal Value1="?DataVersion().Minor" Value2="0" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <Greater Value1="?Fight(ZONE_4|BOSS_WASP|6).WinCount" Value2="0" />
    </Conditions>
    <Actions Place="Map">
      <ChangeScene Destination="Map" />
      <SetMapFocus Battle="ZONE_4|BOSS_WASP|" />
      <ForceExecution Name="Wasp_beaten" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'3'0'0Part6" Priority="990">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'3'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="2" />
      <Equal Value1="?DataVersion().Minor" Value2="0" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <Greater Value1="?Fight(ZONE_3|BOSS_BUTCHER|6).WinCount" Value2="0" />
      <Equal Value1="?Battle(ZONE_3|BOSS_BUTCHER).Available" Value2="1" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <ChangeScene Destination="Map" />
      <ShowBattle Name="ZONE_3|BOSS_BUTCHER" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'3'0'0Final" Priority="989">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'3'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="2" />
      <Equal Value1="?DataVersion().Minor" Value2="0" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <GiveItem Name="NoRanged" PutOn="1" Quantity="1" />
      <GiveItem Name="NoMagic" PutOn="1" Quantity="1" />
      <SetVariable Name="UpdateTo1'3'0'0Mark" Value="1" />
      <ShowBattle Name="ZONE_6|BOSS_SAMURAI_LOCKED" />
      <SetDataVersion Production="1" Major="3" Minor="0" DataVersion="0" />
      <ResetPerks />
      <Activate ActionID="PerksWipe" />
      <Activate ActionID="Update" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'4'0'0Part1" Priority="988">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'4'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="3" />
      <Equal Value1="?DataVersion().Minor" Value2="0" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <Less Not="1" Value1="?Fight(ZONE_1|BOSS_LYNX|2).WinCount" Value2="1" />
    </Conditions>
    <Actions Place="Map">
      <ShowBattle Name="ZONE_1|Duel" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'4'0'0Part2" Priority="988">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'4'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="3" />
      <Equal Value1="?DataVersion().Minor" Value2="0" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <Less Not="1" Value1="?Fight(ZONE_2|BOSS_HERMIT|2).WinCount" Value2="1" />
    </Conditions>
    <Actions Place="Map">
      <ShowBattle Name="ZONE_2|Duel" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'4'0'0Part3" Priority="988">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'4'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="3" />
      <Equal Value1="?DataVersion().Minor" Value2="0" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <Less Not="1" Value1="?Fight(ZONE_3|BOSS_BUTCHER|2).WinCount" Value2="1" />
    </Conditions>
    <Actions Place="Map">
      <ShowBattle Name="ZONE_3|Duel" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'4'0'0Part4" Priority="988">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'4'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="3" />
      <Equal Value1="?DataVersion().Minor" Value2="0" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <Less Not="1" Value1="?Fight(ZONE_4|BOSS_WASP|2).WinCount" Value2="1" />
    </Conditions>
    <Actions Place="Map">
      <ShowBattle Name="ZONE_4|Duel" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'4'0'0Part5" Priority="988">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'4'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="3" />
      <Equal Value1="?DataVersion().Minor" Value2="0" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <Less Not="1" Value1="?Fight(ZONE_5|BOSS_HUNTRESS|2).WinCount" Value2="1" />
    </Conditions>
    <Actions Place="Map">
      <ShowBattle Name="ZONE_5|Duel" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'4'0'0Part6" Priority="988">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'4'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="3" />
      <Equal Value1="?DataVersion().Minor" Value2="0" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <Equal Value1="?Fight(ZONE_3|Tournament|6).WinCount" Value2="0" />
      <Equal Value1="?Battle(ZONE_3|BOSS_Butcher).Available" Value2="1" />
    </Conditions>
    <Actions Place="Map">
      <ShowBattle Name="ZONE_3|Challenge" Locked="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'4'0'0Part7" Priority="988">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'4'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="3" />
      <Equal Value1="?DataVersion().Minor" Value2="0" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <Equal Value1="?Fight(ZONE_4|Tournament|6).WinCount" Value2="0" />
      <Equal Value1="?Battle(ZONE_4|BOSS_WASP).Available" Value2="1" />
    </Conditions>
    <Actions Place="Map">
      <ShowBattle Name="ZONE_4|Challenge" Locked="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'4'0'0Part8" Priority="988">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'4'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="3" />
      <Equal Value1="?DataVersion().Minor" Value2="0" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <Equal Value1="?Fight(ZONE_5|Tournament|6).WinCount" Value2="0" />
      <Equal Value1="?Battle(ZONE_5|BOSS_HUNTRESS).Available" Value2="1" />
    </Conditions>
    <Actions Place="Map">
      <ShowBattle Name="ZONE_5|Challenge" Locked="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'4'0'0Part9" Priority="988">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'4'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="3" />
      <Equal Value1="?DataVersion().Minor" Value2="0" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <Equal Value1="?Fight(ZONE_2|BOSS_HERMIT|2).WinCount" Value2="0" />
      <Equal Value1="?Battle(ZONE_2|BOSS_HERMIT).Available" Value2="1" />
    </Conditions>
    <Actions Place="Map">
      <ShowBattle Name="ZONE_2|Duel" Locked="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'4'0'0Part10" Priority="988">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'4'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="3" />
      <Equal Value1="?DataVersion().Minor" Value2="0" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <Equal Value1="?Fight(ZONE_3|BOSS_BUTCHER|2).WinCount" Value2="0" />
      <Equal Value1="?Battle(ZONE_3|BOSS_BUTCHER).Available" Value2="1" />
    </Conditions>
    <Actions Place="Map">
      <ShowBattle Name="ZONE_3|Duel" Locked="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'4'0'0Part11" Priority="988">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'4'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="3" />
      <Equal Value1="?DataVersion().Minor" Value2="0" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <Equal Value1="?Fight(ZONE_4|BOSS_WASP|2).WinCount" Value2="0" />
      <Equal Value1="?Battle(ZONE_4|BOSS_WASP).Available" Value2="1" />
    </Conditions>
    <Actions Place="Map">
      <ShowBattle Name="ZONE_4|Duel" Locked="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'4'0'0Part12" Priority="988">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'4'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="3" />
      <Equal Value1="?DataVersion().Minor" Value2="0" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <Equal Value1="?Fight(ZONE_5|BOSS_HUNTRESS|2).WinCount" Value2="0" />
      <Equal Value1="?Battle(ZONE_5|BOSS_HUNTRESS).Available" Value2="1" />
    </Conditions>
    <Actions Place="Map">
      <ShowBattle Name="ZONE_5|Duel" Locked="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'4'0'0Part13" Priority="988">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'4'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="3" />
      <Equal Value1="?DataVersion().Minor" Value2="0" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <Equal Value1="_$LevelUp" Value2="1" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="PreUpdateLevel" Value="?Sub(?Player().Level,1)"/>
      <Dialog Type="Multiline" Title="characterSensei" Image="character_sensei" >
        <Line Text="dlgSenseiCongratulation" ButtonText="dlgStoryBtnMore" />
        <Line Text="dlgSenseiLevelIndicator{textures/misc/level.png}{?Player().Level}" FontName="carterOneLevel" ButtonText="dlgStoryBtnMore" />
        <Line Text="dlgSenseiText" ButtonText="dlgStoryBtnMore" />
        <Button Type="Left" Color="Red" Text="dlgServiceBtnLater" />
        <Button Type="Right" Color="Beige" Text="dlgSenseiProfile">
          <ClearQuestQueue Name="ShowUpgrades" />
          <ChangeScene Destination="Profile" />
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'4'0'0Part14" Priority="988">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'4'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="3" />
      <Equal Value1="?DataVersion().Minor" Value2="0" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <Equal Not="1" Value1="_$LevelUp" Value2="1" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="PreUpdateLevel" Value="?Player().Level"/>
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'4'0'0Final" Priority="989">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'4'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="3" />
      <Equal Value1="?DataVersion().Minor" Value2="0" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="UpdateTo1'4'0'0Mark" Value="1" />
      <SetDataVersion Production="1" Major="4" Minor="0" DataVersion="0" />
      <Activate ActionID="Update" Locked="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'4'1'0Final" Priority="989">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'4'1'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="4" />
      <Equal Value1="?DataVersion().Minor" Value2="0" />
      <Operator Type="Or">
        <Equal Value1="?DataVersion().DataVersion" Value2="0" />
        <Equal Value1="?DataVersion().DataVersion" Value2="1" />
      </Operator>
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="UpdateTo1'4'1'0Mark" Value="1" />
      <SetDataVersion Production="1" Major="4" Minor="1" DataVersion="0" />
      <Activate ActionID="Update" Locked="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'4'2'0Final" Priority="989">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'4'2'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="4" />
      <Equal Value1="?DataVersion().Minor" Value2="1" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="UpdateTo1'4'2'0Mark" Value="1" />
      <SetDataVersion Production="1" Major="4" Minor="2" DataVersion="0" />
      <Activate ActionID="Update" Locked="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'5'0'0Part1" Priority="995">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'5'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="4" />
      <Equal Value1="?DataVersion().Minor" Value2="2" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="StrangerTriggerLevel" Value="?UniformIntRandom(4,5)" />
      <Activate ActionID="FinetuneStrangerTriggerLevel" />
      <ToggleItems Label="ZONE_1_DONATE" Toggle="on" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'5'0'0Part2" Priority="994">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'5'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="4" />
      <Equal Value1="?DataVersion().Minor" Value2="2" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <Less Not="1" Value1="?Fight(ZONE_1|BOSS_LYNX|6).WinCount" Value2="1" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="StrangerTriggerLevel" Value="?UniformIntRandom(8,11)" />
      <SetVariable Name="Zone2CurrencyAlert" Value="1" />
      <Activate ActionID="FinetuneStrangerTriggerLevel" />
      <ToggleItems Label="ZONE_1_DONATE" Toggle="off" />
      <ToggleItems Label="ZONE_2_DONATE" Toggle="on" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'5'0'0Part3" Priority="993">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'5'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="4" />
      <Equal Value1="?DataVersion().Minor" Value2="2" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <Less Not="1" Value1="?Fight(ZONE_2|BOSS_HERMIT|6).WinCount" Value2="1" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="StrangerTriggerLevel" Value="?UniformIntRandom(14,17)" />
      <SetVariable Name="Zone3CurrencyAlert" Value="1" />
      <Activate ActionID="FinetuneStrangerTriggerLevel" />
      <ToggleItems Label="ZONE_2_DONATE" Toggle="off" />
      <ToggleItems Label="ZONE_3_DONATE" Toggle="on" />
      <SetVariable Name="RangedAvailableTag" Value="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'5'0'0Part4" Priority="992">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'5'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="4" />
      <Equal Value1="?DataVersion().Minor" Value2="2" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <Less Not="1" Value1="?Fight(ZONE_3|BOSS_BUTCHER|6).WinCount" Value2="1" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="StrangerTriggerLevel" Value="?UniformIntRandom(20,23)" />
      <SetVariable Name="Zone4CurrencyAlert" Value="1" />
      <Activate ActionID="FinetuneStrangerTriggerLevel" />
      <ToggleItems Label="ZONE_3_DONATE" Toggle="off" />
      <ToggleItems Label="ZONE_4_DONATE" Toggle="on" />
      <SetVariable Name="MagicAvailableTag" Value="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'5'0'0Part5" Priority="991">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'5'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="4" />
      <Equal Value1="?DataVersion().Minor" Value2="2" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <Less Not="1" Value1="?Fight(ZONE_4|BOSS_WASP|6).WinCount" Value2="1" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="StrangerTriggerLevel" Value="?UniformIntRandom(26,29)" />
      <SetVariable Name="Zone5CurrencyAlert" Value="1" />
      <Activate ActionID="FinetuneStrangerTriggerLevel" />
      <ToggleItems Label="ZONE_4_DONATE" Toggle="off" />
      <ToggleItems Label="ZONE_5_DONATE" Toggle="on" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'5'0'0Final" Priority="990">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'5'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="4" />
      <Equal Value1="?DataVersion().Minor" Value2="2" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="ChallengeUnlockCount" Value="?Sum(?Fight(ZONE_3|Tournament|6).WinCount,?Fight(ZONE_4|Tournament|6).WinCount,?Fight(ZONE_5|Tournament|6).WinCount)" />
      <SetVariable Name="DuelUnlockCount" Value="?Sum(?Fight(ZONE_3|BOSS_BUTCHER|2).WinCount,?Fight(ZONE_4|BOSS_WASP|2).WinCount,?Fight(ZONE_5|BOSS_HUNTRESS|2).WinCount)" />
      <SetVariable Name="UpdateTo1'5'0'0Mark" Value="1" />
      <SetDataVersion Production="1" Major="5" Minor="0" DataVersion="0" />
      <Activate ActionID="Update" Locked="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'5'0'1Final" Priority="990">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'5'0'1Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="5" />
      <Equal Value1="?DataVersion().Minor" Value2="0" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="UpdateTo1'5'0'1Mark" Value="1" />
      <SetDataVersion Production="1" Major="5" Minor="0" DataVersion="1" />
      <Activate ActionID="Update" Locked="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'5'1'0Final" Priority="990">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'5'1'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="5" />
      <Equal Value1="?DataVersion().Minor" Value2="0" />
      <Equal Value1="?DataVersion().DataVersion" Value2="1" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="UpdateTo1'5'1'0Mark" Value="1" />
      <SetDataVersion Production="1" Major="5" Minor="1" DataVersion="0" />
      <Activate ActionID="Update" Locked="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'5'2'0Final" Priority="990">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'5'2'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="5" />
      <Equal Value1="?DataVersion().Minor" Value2="1" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="UpdateTo1'5'2'0Mark" Value="1" />
      <SetDataVersion Production="1" Major="5" Minor="2" DataVersion="0" />
      <Activate ActionID="Update" Locked="1" />
      <SetVariable Name="langCurrent" Value="?Player().Language" />
      <Activate ActionID="LangReDownload" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'5'3'0Final" Priority="990">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'5'3'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="5" />
      <Equal Value1="?DataVersion().Minor" Value2="2" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="UpdateTo1'5'3'0Mark" Value="1" />
      <SetDataVersion Production="1" Major="5" Minor="3" DataVersion="0" />
      <Activate ActionID="Update" Locked="1" />
    </Actions>
  </Quest>

  <Quest Name="Update1'5'2'1To1'5'3'0" Priority="999">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'5'3'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="5" />
      <Equal Value1="?DataVersion().Minor" Value2="2" />
      <Equal Value1="?DataVersion().DataVersion" Value2="1" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="UpdateTo1'5'3'0Mark" Value="1" />
      <SetDataVersion Production="1" Major="5" Minor="3" DataVersion="0" />
      <Activate ActionID="Update" Locked="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'5'4'0Part1" Priority="999">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'5'4'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="5" />
      <Equal Value1="?DataVersion().Minor" Value2="3" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Less Not="1" Value1="?Fight(ZONE_2|Tournament|6).WinCount" Value2="1" />
    </Conditions>
    <Actions>
      <ShowBattle Name="ZONE_2|Challenge" Locked="0" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'5'4'0Part2" Priority="998">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'5'4'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="5" />
      <Equal Value1="?DataVersion().Minor" Value2="3" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Less Not="1" Value1="?Fight(ZONE_3|Tournament|6).WinCount" Value2="1" />
    </Conditions>
    <Actions>
      <ShowBattle Name="ZONE_3|Challenge" Locked="0" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'5'4'0Part3" Priority="997">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'5'4'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="5" />
      <Equal Value1="?DataVersion().Minor" Value2="3" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Less Not="1" Value1="?Fight(ZONE_4|Tournament|6).WinCount" Value2="1" />
    </Conditions>
    <Actions>
      <ShowBattle Name="ZONE_4|Challenge" Locked="0" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'5'4'0Part4" Priority="996">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'5'4'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="5" />
      <Equal Value1="?DataVersion().Minor" Value2="3" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Less Not="1" Value1="?Fight(ZONE_5|Tournament|6).WinCount" Value2="1" />
    </Conditions>
    <Actions>
      <ShowBattle Name="ZONE_5|Challenge" Locked="0" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'5'4'0Part5" Priority="995">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'5'4'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="5" />
      <Equal Value1="?DataVersion().Minor" Value2="3" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Less Not="1" Value1="?Fight(ZONE_1|BOSS_LYNX|2).WinCount" Value2="1" />
    </Conditions>
    <Actions>
      <ShowBattle Name="ZONE_1|Duel" Locked="0" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'5'4'0Part6" Priority="994">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'5'4'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="5" />
      <Equal Value1="?DataVersion().Minor" Value2="3" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Less Not="1" Value1="?Fight(ZONE_2|BOSS_HERMIT|2).WinCount" Value2="1" />
    </Conditions>
    <Actions>
      <ShowBattle Name="ZONE_2|Duel" Locked="0" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'5'4'0Part7" Priority="993">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'5'4'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="5" />
      <Equal Value1="?DataVersion().Minor" Value2="3" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Less Not="1" Value1="?Fight(ZONE_3|BOSS_BUTCHER|2).WinCount" Value2="1" />
    </Conditions>
    <Actions>
      <ShowBattle Name="ZONE_3|Duel" Locked="0" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'5'4'0Part8" Priority="992">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'5'4'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="5" />
      <Equal Value1="?DataVersion().Minor" Value2="3" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Less Not="1" Value1="?Fight(ZONE_4|BOSS_WASP|2).WinCount" Value2="1" />
    </Conditions>
    <Actions>
      <ShowBattle Name="ZONE_4|Duel" Locked="0" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'5'4'0Part9" Priority="991">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'5'4'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="5" />
      <Equal Value1="?DataVersion().Minor" Value2="3" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Less Not="1" Value1="?Fight(ZONE_5|BOSS_HUNTRESS|2).WinCount" Value2="1" />
    </Conditions>
    <Actions>
      <ShowBattle Name="ZONE_5|Duel" Locked="0" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'5'4'0Final" Priority="990">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'5'4'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="5" />
      <Equal Value1="?DataVersion().Minor" Value2="3" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="DuelUnlockCount" Value="?Sum(?Fight(ZONE_3|BOSS_BUTCHER|2).WinCount,?Fight(ZONE_4|BOSS_WASP|2).WinCount,?Fight(ZONE_5|BOSS_HUNTRESS|2).WinCount)" />
      <SetVariable Name="ChallengeUnlockCount" Value="?Sum(?Fight(ZONE_3|Tournament|6).WinCount,?Fight(ZONE_4|Tournament|6).WinCount,?Fight(ZONE_5|Tournament|6).WinCount)" />
      <SetVariable Name="UpdateTo1'5'4'0Mark" Value="1" />
      <SetDataVersion Production="1" Major="5" Minor="4" DataVersion="0" />
      <Activate ActionID="Update" Locked="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'6'0'0Part1" Priority="993">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'6'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="5" />
      <Equal Value1="?DataVersion().Minor" Value2="4" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <Greater Value1="?Fight(ZONE_5|BOSS_HUNTRESS|6).WinCount" Value2="0" />
    </Conditions>
    <Actions Place="Map">
      <ClearQuestQueue Name="ZONE_6_unlock_exception" />
      <ChangeScene Destination="Map" />
      <ForceExecution Name="Huntress_beaten" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'6'0'0Part2" Priority="992">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'6'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="5" />
      <Equal Value1="?DataVersion().Minor" Value2="4" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <Greater Value1="?Player().Level" Value2="?Item(HELM_SUPER_MASK).Level"/>
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="FirstSuperItemFlag" Value="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'6'0'0Part3" Priority="991">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'6'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="5" />
      <Equal Value1="?DataVersion().Minor" Value2="4" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <Greater Value1="?Fight(ZONE_1|BOSS_LYNX|6).WinCount" Value2="0" Not="1"/>
      <Greater Value1="?Fight(ZONE_1|Tournament|4).WinCount" Value2="0" />
    </Conditions>
    <Actions Place="Map">
      <ShowStarterPackTimer />
      <Activate ActionID="StarterPackDialog" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'6'0'0Final" Priority="990">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'6'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="5" />
      <Equal Value1="?DataVersion().Minor" Value2="4" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="DiscipleFlag" Value="0" />
      <Wait Frames="1" />
      <Foreach Type="PaidItems" Name="FindCoinItem" />
      <Wait Frames="1" />
      <SetVariable Name="UpdateTo1'6'0'0Mark" Value="1" />
      <SetDataVersion Production="1" Major="6" Minor="0" DataVersion="0" />
      <ResetPerks />
      <Activate ActionID="PerksWipe" />
      <Activate ActionID="Update" Locked="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'6'1'0Final" Priority="990">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'6'1'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="6" />
      <Equal Value1="?DataVersion().Minor" Value2="0" />
      <Operator Type="Or">
        <Equal Value1="?DataVersion().DataVersion" Value2="0" />
        <Equal Value1="?DataVersion().DataVersion" Value2="1" />
        <Equal Value1="?DataVersion().DataVersion" Value2="2" />
      </Operator>
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="UpdateTo1'6'1'0Mark" Value="1" />
      <SetDataVersion Production="1" Major="6" Minor="1" DataVersion="0" />
      <Activate ActionID="Update" Locked="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'6'1'1Final" Priority="990">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'6'1'1Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="6" />
      <Equal Value1="?DataVersion().Minor" Value2="1" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="UpdateTo1'6'1'1Mark" Value="1" />
      <SetDataVersion Production="1" Major="6" Minor="1" DataVersion="1" />
      <Activate ActionID="Update" Locked="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'6'1'2Part1" Priority="996">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'6'1'2Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="6" />
      <Equal Value1="?DataVersion().Minor" Value2="1" />
      <Equal Value1="?DataVersion().DataVersion" Value2="1" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <GreaterEqual Value1="?Fight(ZONE_3|Tournament|6).WinCount" Value2="1" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="Zone3ChallengeUnlock" Value="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'6'1'2Part2" Priority="995">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'6'1'2Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="6" />
      <Equal Value1="?DataVersion().Minor" Value2="1" />
      <Equal Value1="?DataVersion().DataVersion" Value2="1" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <GreaterEqual Value1="?Fight(ZONE_4|Tournament|6).WinCount" Value2="1" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="Zone4ChallengeUnlock" Value="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'6'1'2Part3" Priority="994">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'6'1'2Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="6" />
      <Equal Value1="?DataVersion().Minor" Value2="1" />
      <Equal Value1="?DataVersion().DataVersion" Value2="1" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <GreaterEqual Value1="?Fight(ZONE_5|Tournament|6).WinCount" Value2="1" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="Zone5ChallengeUnlock" Value="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'6'1'2Part4" Priority="993">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'6'1'2Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="6" />
      <Equal Value1="?DataVersion().Minor" Value2="1" />
      <Equal Value1="?DataVersion().DataVersion" Value2="1" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <GreaterEqual Value1="?Fight(ZONE_3|BOSS_BUTCHER|2).WinCount" Value2="1" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="Zone3DuelUnlock" Value="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'6'1'2Part5" Priority="992">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'6'1'2Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="6" />
      <Equal Value1="?DataVersion().Minor" Value2="1" />
      <Equal Value1="?DataVersion().DataVersion" Value2="1" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <GreaterEqual Value1="?Fight(ZONE_4|BOSS_WASP|2).WinCount" Value2="1" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="Zone4DuelUnlock" Value="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'6'1'2Part6" Priority="991">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'6'1'2Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="6" />
      <Equal Value1="?DataVersion().Minor" Value2="1" />
      <Equal Value1="?DataVersion().DataVersion" Value2="1" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <GreaterEqual Value1="?Fight(ZONE_5|BOSS_HUNTRESS|2).WinCount" Value2="1" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="Zone5DuelUnlock" Value="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'6'1'2Final" Priority="990">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'6'1'2Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="6" />
      <Equal Value1="?DataVersion().Minor" Value2="1" />
      <Equal Value1="?DataVersion().DataVersion" Value2="1" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="UpdateTo1'6'1'2Mark" Value="1" />
      <SetDataVersion Production="1" Major="6" Minor="1" DataVersion="2" />
      <Activate ActionID="Update" Locked="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'6'2'0Part1" Priority="991">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'6'2'0Mark" Value2="1" Not="1" />
      <Operator Type="Or">
        <Operator Type="And">
          <Equal Value1="?DataVersion().Production" Value2="1" />
          <Equal Value1="?DataVersion().Major" Value2="6" />
          <Equal Value1="?DataVersion().Minor" Value2="1" />
          <Equal Value1="?DataVersion().DataVersion" Value2="2" />
        </Operator>
        <Operator Type="And">
          <Equal Value1="?DataVersion().Production" Value2="1" />
          <Equal Value1="?DataVersion().Major" Value2="6" />
          <Equal Value1="?DataVersion().Minor" Value2="0" />
          <Equal Value1="?DataVersion().DataVersion" Value2="2" />
        </Operator>
      </Operator>
      <Equal Value1="_$ActionID" Value2="Update" />
      <LessEqual Value1="_StrangerTriggerLevel" Value2="6" />
      <Equal Not="1" Value1="_Zone1Stranger1Greetings" Value2="1" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="StrangerTriggerLevel" Value="5" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'6'2'0Final" Priority="990">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'6'2'0Mark" Value2="1" Not="1" />
      <Operator Type="Or">
        <Operator Type="And">
          <Equal Value1="?DataVersion().Production" Value2="1" />
          <Equal Value1="?DataVersion().Major" Value2="6" />
          <Equal Value1="?DataVersion().Minor" Value2="1" />
          <Equal Value1="?DataVersion().DataVersion" Value2="2" />
        </Operator>
        <Operator Type="And">
          <Equal Value1="?DataVersion().Production" Value2="1" />
          <Equal Value1="?DataVersion().Major" Value2="6" />
          <Equal Value1="?DataVersion().Minor" Value2="0" />
          <Equal Value1="?DataVersion().DataVersion" Value2="2" />
        </Operator>
      </Operator>
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="BestAcquiredArmorLevel" Value="0" />
      <SetVariable Name="BestAcquiredHelmLevel" Value="0" />
      <SetVariable Name="BestAcquiredWeaponLevel" Value="0" />
      <Wait Frames="1" />
      <Foreach Type="Items" Name="FindBestArmor" />
      <Wait Frames="1" />
      <Foreach Type="Items" Name="FindBestHelm" />
      <Wait Frames="1" />
      <Foreach Type="Items" Name="FindBestWeapon" />
      <Wait Frames="1" />
      <SetDataVersion Production="1" Major="6" Minor="2" DataVersion="0" />
      <SetVariable Name="UpdateTo1'6'2'0Mark" Value="1" />
      <Activate ActionID="Update" Locked="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'6'3'0Final" Priority="990">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'6'3'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="6" />
      <Equal Value1="?DataVersion().Minor" Value2="2" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <SetDataVersion Production="1" Major="6" Minor="3" DataVersion="0" />
      <SetVariable Name="UpdateTo1'6'3'0Mark" Value="1" />
      <Activate ActionID="Update" Locked="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'6'4'0Final" Priority="990">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'6'4'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="6" />
      <Equal Value1="?DataVersion().Minor" Value2="3" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <SetDataVersion Production="1" Major="6" Minor="4" DataVersion="0" />
      <SetVariable Name="UpdateTo1'6'4'0Mark" Value="1" />
      <Activate ActionID="Update" Locked="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'7'0'0Part1" Priority="996">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'7'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="6" />
      <Equal Value1="?DataVersion().Minor" Value2="4" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <GreaterEqual Value1="?Fight(ZONE_6|FINAL_BATTLE|1).WinCount" Value2="1" Not="1"/>
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="Avatar_Notification" Value="character_may_1_small" />
      <SetVariable Name="Avatar_Assistant_1" Value="character_may_1" />
      <SetVariable Name="Avatar_Assistant_2" Value="character_may_2" />
      <SetVariable Name="Avatar_Assistant_3" Value="character_may_3" />
      <SetVariable Name="Avatar_Assistant_4" Value="character_may_4" />
      <SetVariable Name="Avatar_Assistant_5" Value="character_may_5" />
      <SetVariable Name="Title_Assistant" Value="characterMay" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'7'0'0Part2" Priority="995">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'7'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="6" />
      <Equal Value1="?DataVersion().Minor" Value2="4" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <GreaterEqual Value1="?Fight(ZONE_6|FINAL_BATTLE|1).WinCount" Value2="1"/>
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="Avatar_Notification" Value="character_thief_small" />
      <SetVariable Name="Avatar_Assistant_1" Value="character_thief" />
      <SetVariable Name="Avatar_Assistant_2" Value="character_thief" />
      <SetVariable Name="Avatar_Assistant_3" Value="character_thief_2" />
      <SetVariable Name="Avatar_Assistant_4" Value="character_thief" />
      <SetVariable Name="Avatar_Assistant_5" Value="character_thief" />
      <SetVariable Name="Title_Assistant" Value="characterThief" />
      <ChangeScene Destination="Map" />
      <ForceExecution Name="Final_Battle_beaten" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'7'0'0Part3" Priority="994">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'7'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="6" />
      <Equal Value1="?DataVersion().Minor" Value2="4" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <Operator Type="Or">
        <GreaterEqual Value1="?Fight(ZONE_1|Stranger|lvl4).WinCount" Value2="1"/>
        <GreaterEqual Value1="?Fight(ZONE_1|Stranger|lvl5).WinCount" Value2="1"/>
        <GreaterEqual Value1="?Fight(ZONE_1|Stranger|lvl6).WinCount" Value2="1"/>
      </Operator>
      <Equal Value1="?Item(WEAPON_NUNCHAKU).Quantity" Value2="1" Not="1"/> 
    </Conditions>
    <Actions Place="Map">
      <ClearQuestQueue Name="Zone1Stranger1Drop" />
      <ForceExecution Name="Zone1Stranger1Drop" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'7'0'0Part4" Priority="994">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'7'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="6" />
      <Equal Value1="?DataVersion().Minor" Value2="4" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <GreaterEqual Not="1" Value1="?Fight(ZONE_1|BOSS_LYNX|6).WinCount" Value2="1" />
    </Conditions>
    <Actions>
      <SetVariable Name="CurrentZone" Value="ZONE_1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'7'0'0Part5" Priority="993">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'7'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="6" />
      <Equal Value1="?DataVersion().Minor" Value2="4" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <GreaterEqual Value1="?Fight(ZONE_1|BOSS_LYNX|6).WinCount" Value2="1" />
      <GreaterEqual Not="1" Value1="?Fight(ZONE_2|BOSS_HERMIT|6).WinCount" Value2="1" />
    </Conditions>
    <Actions>
      <SetVariable Name="CurrentZone" Value="ZONE_2" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'7'0'0Part6" Priority="993">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'7'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="6" />
      <Equal Value1="?DataVersion().Minor" Value2="4" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <GreaterEqual Value1="?Fight(ZONE_2|BOSS_HERMIT|6).WinCount" Value2="1" />
      <GreaterEqual Not="1" Value1="?Fight(ZONE_3|BOSS_BUTCHER|6).WinCount" Value2="1" />
    </Conditions>
    <Actions>
      <SetVariable Name="CurrentZone" Value="ZONE_3" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'7'0'0Part7" Priority="994">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'7'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="6" />
      <Equal Value1="?DataVersion().Minor" Value2="4" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <GreaterEqual Value1="?Fight(ZONE_3|BOSS_BUTCHER|6).WinCount" Value2="1" />
      <GreaterEqual Not="1" Value1="?Fight(ZONE_4|BOSS_WASP|6).WinCount" Value2="1" />
    </Conditions>
    <Actions>
      <SetVariable Name="CurrentZone" Value="ZONE_4" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'7'0'0Part8" Priority="993">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'7'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="6" />
      <Equal Value1="?DataVersion().Minor" Value2="4" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <GreaterEqual Value1="?Fight(ZONE_4|BOSS_WASP|6).WinCount" Value2="1" />
      <GreaterEqual Not="1" Value1="?Fight(ZONE_5|BOSS_HUNTRESS|6).WinCount" Value2="1" />
    </Conditions>
    <Actions>
      <SetVariable Name="CurrentZone" Value="ZONE_5" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'7'0'0Part9" Priority="993">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'7'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="6" />
      <Equal Value1="?DataVersion().Minor" Value2="4" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <GreaterEqual Value1="?Fight(ZONE_5|BOSS_HUNTRESS|6).WinCount" Value2="1" />
    </Conditions>
    <Actions>
      <SetVariable Name="CurrentZone" Value="ZONE_6" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'7'0'0Final" Priority="991">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'7'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="6" />
      <Equal Value1="?DataVersion().Minor" Value2="4" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <ToggleItems Label="ZONE_1_DONATE" Toggle="off" />
      <ToggleItems Label="ZONE_2_DONATE" Toggle="off" />
      <ToggleItems Label="ZONE_3_DONATE" Toggle="off" />
      <ToggleItems Label="ZONE_4_DONATE" Toggle="off" />
      <ToggleItems Label="ZONE_5_DONATE" Toggle="off" />
      <ToggleItems Label="ZONE_6_DONATE" Toggle="off" />
      <ToggleItems Label="?Concat(_CurrentZone,_DONATE)" Toggle="on" />
      <SetVariable Name="BestAcquiredRangedLevel" Value="0" />
      <SetVariable Name="BestAcquiredMagicLevel" Value="0" />
      <Wait Frames="1" />
      <Foreach Type="Items" Name="FindBestRanged" />
      <Wait Frames="1" />
      <Foreach Type="Items" Name="FindBestMagic" />
      <Wait Frames="1" />
      <SetDataVersion Production="1" Major="7" Minor="0" DataVersion="0" />
      <SetVariable Name="UpdateTo1'7'0'0Mark" Value="1" />
      <Activate ActionID="Update" Locked="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'7'0'1Final" Priority="991">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'7'0'1Mark1" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="7" />
      <Equal Value1="?DataVersion().Minor" Value2="0" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <SetDataVersion Production="1" Major="7" Minor="0" DataVersion="1" />
      <ResetPerks />
      <Activate ActionID="PerksWipe" />
      <SetVariable Name="UpdateTo1'7'0'1Mark1" Value="1" />
      <Activate ActionID="Update" Locked="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'7'1'0Final" Priority="991">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'7'1'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="7" />
      <Equal Value1="?DataVersion().Minor" Value2="0" />
      <Equal Value1="?DataVersion().DataVersion" Value2="1" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <SetDataVersion Production="1" Major="7" Minor="1" DataVersion="0" />
      <SetVariable Name="UpdateTo1'7'1'0Mark" Value="1" />
      <Activate ActionID="Update" Locked="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'7'1'1Final" Priority="991">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'7'1'1Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="7" />
      <Equal Value1="?DataVersion().Minor" Value2="1" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <SetDataVersion Production="1" Major="7" Minor="1" DataVersion="1" />
      <SetVariable Name="UpdateTo1'7'1'1Mark" Value="1" />
      <Activate ActionID="Update" Locked="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'7'2'0Final" Priority="991">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'7'2'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="7" />
      <Equal Value1="?DataVersion().Minor" Value2="1" />
      <Equal Value1="?DataVersion().DataVersion" Value2="1" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <SetDataVersion Production="1" Major="7" Minor="2" DataVersion="0" />
      <SetVariable Name="UpdateTo1'7'2'0Mark" Value="1" />
      <Activate ActionID="Update" Locked="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'7'3'0Final" Priority="991">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'7'3'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="7" />
      <Equal Value1="?DataVersion().Minor" Value2="2" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <SetDataVersion Production="1" Major="7" Minor="3" DataVersion="0" />
      <SetVariable Name="UpdateTo1'7'3'0Mark" Value="1" />
      <Activate ActionID="Update" Locked="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'7'4'0Part1" Priority="999">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'7'4'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="7" />
      <Equal Value1="?DataVersion().Minor" Value2="3" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <GreaterEqual Value1="?Fight(ZONE_1|Tournament|5).WinCount" Value2="1" Not="1" />
      <GreaterEqual Not="1" Value1="?Item(WEAPON_STARTER_PACK_TONFA).Quantity" Value2="1" />
      <GreaterEqual Not="1" Value1="?Item(HELM_STARTER_PACK).Quantity" Value2="1" />
      <Greater Value1="?Timer(StarterPackTimer).Value" Value2="0" Not="1" />
    </Conditions>
    <Actions>
      <SetVariable Name="StarterPackOfferEnded" Value="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'7'4'0Part2" Priority="998">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'7'4'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="7" />
      <Equal Value1="?DataVersion().Minor" Value2="3" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <GreaterEqual Value1="?Fight(ZONE_1|Tournament|5).WinCount" Value2="1" Not="1" />
      <GreaterEqual Not="1" Value1="?Item(WEAPON_STARTER_PACK_TONFA).Quantity" Value2="1" />
      <GreaterEqual Not="1" Value1="?Item(HELM_STARTER_PACK).Quantity" Value2="1" />
      <Greater Value1="?Timer(StarterPackTimer).Value" Value2="0" />
    </Conditions>
    <Actions>
      <ActivateTimer Name="Timer_StarterPack" Value="?Timer(StarterPackTimer).Value" />
      <ShowMapButton Name="Button_StarterPack" Image="starter_pack" Timer="Timer_StarterPack" />
      <Activate ActionID="StarterPackDialog" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'7'4'0Part3" Priority="997">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'7'4'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="7" />
      <Equal Value1="?DataVersion().Minor" Value2="3" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <GreaterEqual Value1="?Fight(ZONE_6|FINAL_BATTLE|1).WinCount" Value2="1" Not="1" />
    </Conditions>
    <Actions>
      <SetVariable Name="promo_FirstPayment_Image" Value="pile_coins_platinum" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'7'4'0Part4" Priority="996">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'7'4'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="7" />
      <Equal Value1="?DataVersion().Minor" Value2="3" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <GreaterEqual Value1="?Fight(ZONE_6|FINAL_BATTLE|1).WinCount" Value2="1" />
    </Conditions>
    <Actions>
      <SetVariable Name="promo_FirstPayment_Image" Value="pile_coins" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'7'4'0Part5" Priority="995">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'7'4'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="7" />
      <Equal Value1="?DataVersion().Minor" Value2="3" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <Greater Value1="?Timer(StarterPackTimer).Value" Value2="0" />
    </Conditions>
    <Actions>
      <ActivateTimer Name="Timer_StarterPack" Value="?Timer(StarterPackTimer).Value" />
      <ShowMapButton Name="Button_StarterPack" Image="starter_pack" Timer="Timer_StarterPack" />
      <Activate ActionID="StarterPackDialog" />
    </Actions>
  </Quest>

  <Quest Name="FindLastPurchase">
    <Conditions>
      <Equal Value1="?Item(_$Iterator).SubType" Value2="Bonus" />
      <Equal Value1="?Item(_$Iterator).Availability" Value2="1" />
      <GreaterEqual Value1="?Item(_$Iterator).Quantity" Value2="1" />
    </Conditions>
    <Actions>
      <SetVariable Name="LastRealPurchase" Value="_$Iterator" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'7'4'0Final" Priority="991">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'7'4'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="7" />
      <Equal Value1="?DataVersion().Minor" Value2="3" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="LastRealPurchaseTime" Value="?SysInfo().Time" />
      <Foreach Type="PaidItems" Name="FindLastPurchase" />
      <SetVariable Name="promo_Multiplier" Value="2" />
      <SetDataVersion Production="1" Major="7" Minor="4" DataVersion="0" />
      <SetVariable Name="UpdateTo1'7'4'0Mark" Value="1" />
      <Activate ActionID="Update" Locked="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'7'5'0Final" Priority="991">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'7'5'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="7" />
      <Equal Value1="?DataVersion().Minor" Value2="4" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <SetDataVersion Production="1" Major="7" Minor="5" DataVersion="0" />
      <SetVariable Name="UpdateTo1'7'5'0Mark" Value="1" />
      <Activate ActionID="Update" Locked="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'7'6'0Final" Priority="991">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'7'6'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="7" />
      <Equal Value1="?DataVersion().Minor" Value2="5" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <SetDataVersion Production="1" Major="7" Minor="6" DataVersion="0" />
      <SetVariable Name="UpdateTo1'7'6'0Mark" Value="1" />
      <Activate ActionID="Update" Locked="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'7'7'0Part1" Priority="996">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'7'7'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="7" />
      <Equal Value1="?DataVersion().Minor" Value2="6" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <GreaterEqual Value1="?Item(WEAPON_HW14_BROOM).Quantity" Value2="1" />
      <Greater Not="1" Value1="?Purchase(WEAPON_HW14_BROOM).UpgradeLevel" Value2="0" />
    </Conditions>
    <Actions>
      <GiveItem Name="WEAPON_HW14_BROOM" PutOn="0" Quantity="-1" />
      <GiveItem Name="?Concat(WEAPON_HW14_BROOM,|,?Sum(?Multi(100,?Player().Level)))" PutOn="1" Quantity="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'7'7'0Part2" Priority="995">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'7'7'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="7" />
      <Equal Value1="?DataVersion().Minor" Value2="6" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <GreaterEqual Value1="?Item(WEAPON_HW14_SCYTHE).Quantity" Value2="1" />
      <Greater Not="1" Value1="?Purchase(WEAPON_HW14_SCYTHE).UpgradeLevel" Value2="0" />
    </Conditions>
    <Actions>
      <GiveItem Name="WEAPON_HW14_SCYTHE" PutOn="0" Quantity="-1" />
      <GiveItem Name="?Concat(WEAPON_HW14_SCYTHE,|,?Sum(?Multi(100,?Player().Level)))" PutOn="1" Quantity="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'7'7'0Part3" Priority="994">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'7'7'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="7" />
      <Equal Value1="?DataVersion().Minor" Value2="6" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <GreaterEqual Value1="?Item(ARMOR_HW14_WICKED_VEIL).Quantity" Value2="1" />
      <Greater Not="1" Value1="?Purchase(ARMOR_HW14_WICKED_VEIL).UpgradeLevel" Value2="0" />
    </Conditions>
    <Actions>
      <GiveItem Name="ARMOR_HW14_WICKED_VEIL" PutOn="0" Quantity="-1" />
      <GiveItem Name="?Concat(ARMOR_HW14_WICKED_VEIL,|,?Sum(?Multi(100,?Player().Level)))" PutOn="1" Quantity="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'7'7'0Part4" Priority="993">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'7'7'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="7" />
      <Equal Value1="?DataVersion().Minor" Value2="6" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <GreaterEqual Value1="?Item(HELM_HW14_PUMPKIN).Quantity" Value2="1" />
      <Greater Not="1" Value1="?Purchase(HELM_HW14_PUMPKIN).UpgradeLevel" Value2="0" />
    </Conditions>
    <Actions>
      <GiveItem Name="HELM_HW14_PUMPKIN" PutOn="0" Quantity="-1" />
      <GiveItem Name="?Concat(HELM_HW14_PUMPKIN,|,?Sum(?Multi(100,?Player().Level)))" PutOn="1" Quantity="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'7'7'0Part5" Priority="993">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'7'7'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="7" />
      <Equal Value1="?DataVersion().Minor" Value2="6" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <GreaterEqual Value1="?Item(HELM_HW14_WITCH).Quantity" Value2="1" />
      <Greater Not="1" Value1="?Purchase(HELM_HW14_WITCH).UpgradeLevel" Value2="0" />
    </Conditions>
    <Actions>
      <GiveItem Name="HELM_HW14_WITCH" PutOn="0" Quantity="-1" />
      <GiveItem Name="?Concat(HELM_HW14_WITCH,|,?Sum(?Multi(100,?Player().Level)))" PutOn="1" Quantity="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'7'7'0Final" Priority="991">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'7'7'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="7" />
      <Equal Value1="?DataVersion().Minor" Value2="6" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <RemovePack Name="halloween_pack" />
      <RemovePack Name="RubyInflation_High" />
      <ToggleGroup Name="RubyInflation_High" Toggle="off"/>
      <RemovePack Name="RubyInflation_Low" />
      <ToggleGroup Name="RubyInflation_Low" Toggle="off"/>
      <RemovePack Name="SuperItemsCost_High" />
      <ToggleGroup Name="SuperItemsCost_High" Toggle="off"/>
      <RemovePack Name="SuperItemsCost_Low" />
      <ToggleGroup Name="SuperItemsCost_Low" Toggle="off"/>
      <RemovePack Name="SurvivalsNeededZ1_High" />
      <ToggleGroup Name="SurvivalsNeededZ1_High" Toggle="off"/>
      <RemovePack Name="SurvivalsNeededZ1_Low" />
      <ToggleGroup Name="SurvivalsNeededZ1_Low" Toggle="off"/>
      <RemovePack Name="SurvivalsNeeded_High" />
      <ToggleGroup Name="SurvivalsNeeded_High" Toggle="off"/>
      <RemovePack Name="SurvivalsNeeded_Low" />
      <ToggleGroup Name="SurvivalsNeeded_Low" Toggle="off"/>
      <SetDataVersion Production="1" Major="7" Minor="7" DataVersion="0" />
      <SetVariable Name="UpdateTo1'7'7'0Mark" Value="1" />
      <ForceExecution Name="ABGroupSet_Roll" />
      <Activate ActionID="Update" Locked="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'7'7'1Final" Priority="991">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'7'7'1Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="7" />
      <Equal Value1="?DataVersion().Minor" Value2="7" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <SetDataVersion Production="1" Major="7" Minor="7" DataVersion="1" />
      <SetVariable Name="UpdateTo1'7'7'1Mark" Value="1" />
      <Activate ActionID="Update" Locked="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'7'8'0Final" Priority="991">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'7'8'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="7" />
      <Equal Value1="?DataVersion().Minor" Value2="7" />
      <Equal Value1="?DataVersion().DataVersion" Value2="1" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <SetDataVersion Production="1" Major="7" Minor="8" DataVersion="0" />
      <SetVariable Name="UpdateTo1'7'8'0Mark" Value="1" />
      <Activate ActionID="Update" Locked="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'8'0'0Part1" Priority="996">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'8'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="7" />
      <Equal Value1="?DataVersion().Minor" Value2="8" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <GreaterEqual Value1="?Fight(ZONE_1|Tournament|16).WinCount" Value2="1" />
      <GreaterEqual Value1="?Fight(ZONE_6|FINAL_BATTLE|1).WinCount" Value2="1" Not="1" />
    </Conditions>
    <Actions>
      <ShowMapButton Name="EclipseModeOn" X="?Sub(?Div(?Multi(768, ?SysInfo().DisplayWidth), ?SysInfo().DisplayHeight),440), " Y="600" Image="sun_icon"/>
      <SetVariable Name="EclipseModeEnabled" Value="1" />
      <SetVariable Name="EclipseModeTutorialFight" Value="?Concat(ZONE_,?Sub(?Slice(_globZoneToCheck,5,5),1),|Survival|)" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'8'0'0Part2" Priority="995">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'8'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="7" />
      <Equal Value1="?DataVersion().Minor" Value2="8" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <GreaterEqual Value1="?Fight(ZONE_6|FINAL_BATTLE|1).WinCount" Value2="1" />
    </Conditions>
    <Actions>
      <ShowMapButton Name="EclipseModeOn" X="?Sub(?Div(?Multi(768, ?SysInfo().DisplayWidth), ?SysInfo().DisplayHeight),440), " Y="600" Image="sun_icon"/>
      <SetVariable Name="EclipseModeEnabled" Value="1" />
      <SetVariable Name="EclipseModeTutorialFight" Value="?Concat(ZONE_,?Sub(?Slice(_globZoneToCheck,5,5),1),|Survival_INTERMISSION|)" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'8'0'0Part3" Priority="994">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'8'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="7" />
      <Equal Value1="?DataVersion().Minor" Value2="8" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
      <GreaterEqual Value1="?Fight(ZONE_1|Tournament|13).WinCount" Value2="1" />
      <Operator Type="Or">
        <GreaterEqual Value1="_BestAcquiredArmorLevel" Value2="400" />
        <GreaterEqual Not="1" Value1="_BestAcquiredArmorLevel" Value2="0" />
      </Operator>
    </Conditions>
    <Actions>
      <ShowForge />
      <SetVariable Name="ForgeEnabled" Value="1" />
      <Foreach Type="Items" Name="FindBestArmor" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'8'0'0Final" Priority="991">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'8'0'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="7" />
      <Equal Value1="?DataVersion().Minor" Value2="8" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <RemovePack Name="RubyInflation_High_v2" />
      <ToggleGroup Name="RubyInflation_High_v2" Toggle="off"/>
      <RemovePack Name="RubyInflation_Low_v2" />
      <ToggleGroup Name="RubyInflation_Low_v2" Toggle="off"/>
      <RemovePack Name="SuperItemsCost_High_v2" />
      <ToggleGroup Name="SuperItemsCost_High_v2" Toggle="off"/>
      <RemovePack Name="SuperItemsCost_Low_v2" />
      <ToggleGroup Name="SuperItemsCost_Low_v2" Toggle="off"/>
      <RemovePack Name="SurvivalsNeededZ1_High_v2" />
      <ToggleGroup Name="SurvivalsNeededZ1_High_v2" Toggle="off"/>
      <RemovePack Name="SurvivalsNeededZ1_Low_v2" />
      <ToggleGroup Name="SurvivalsNeededZ1_Low_v2" Toggle="off"/>
      <RemovePack Name="SurvivalsNeeded_High_v2" />
      <ToggleGroup Name="SurvivalsNeeded_High_v2" Toggle="off"/>
      <RemovePack Name="SurvivalsNeeded_Low_v2" />
      <ToggleGroup Name="SurvivalsNeeded_Low_v2" Toggle="off"/>
      <SetMapMask Color="0xffffff00" />
      <SetVariable Name="ABNewUserFlag" Value="1" />
      <ResetEnchantments />
      <SetDataVersion Production="1" Major="8" Minor="0" DataVersion="0" />
      <SetVariable Name="UpdateTo1'8'0'0Mark" Value="1" />
      <ResetPerks />
      <Activate ActionID="PerksWipe" />
      <Activate ActionID="Update" Locked="1" />
    </Actions>
  </Quest>

  <Quest Name="UpdateTo1'8'1'0Final" Priority="991">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'8'1'0Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="8" />
      <Equal Value1="?DataVersion().Minor" Value2="0" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <SetDataVersion Production="1" Major="8" Minor="1" DataVersion="0" />
      <SetVariable Name="UpdateTo1'8'1'0Mark" Value="1" />
      <Activate ActionID="Update" Locked="1" />
    </Actions>
  </Quest>
	
  <Quest Name="UpdateTo1'8'1'1Final" Priority="991">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'8'1'1Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="8" />
      <Equal Value1="?DataVersion().Minor" Value2="1" />
      <Equal Value1="?DataVersion().DataVersion" Value2="0" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <SetDataVersion Production="1" Major="8" Minor="1" DataVersion="1" />
      <SetVariable Name="UpdateTo1'8'1'1Mark" Value="1" />
      <Activate ActionID="Update" Locked="1" />
    </Actions>
  </Quest>
 
   <Quest Name="UpdateTo1'8'1'2Final" Priority="991">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'8'1'2Mark" Value2="1" Not="1" />
      <Equal Value1="?DataVersion().Production" Value2="1" />
      <Equal Value1="?DataVersion().Major" Value2="8" />
      <Equal Value1="?DataVersion().Minor" Value2="1" />
      <Equal Value1="?DataVersion().DataVersion" Value2="1" />
      <Equal Value1="_$ActionID" Value2="Update" />
    </Conditions>
    <Actions Place="Map">
      <SetDataVersion Production="1" Major="8" Minor="1" DataVersion="2" />
      <SetVariable Name="UpdateTo1'8'1'2Mark" Value="1" />
      <Activate ActionID="Update" Locked="1" />
    </Actions>
  </Quest>
 

  <Quest Name="PerksWipe" Unresumable="1" Priority="-9000">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="PerksWipe" />
      <Operator Type="Or">
        <Equal Value1="_UpdateTo1'3'0'0Wipe" Value2="1" Not="1" />
        <Equal Value1="_UpdateTo1'6'0'0Wipe" Value2="1" Not="1" />
        <Equal Value1="_UpdateTo1'7'0'1Wipe1" Value2="1" Not="1" />
        <Equal Value1="_UpdateTo1'8'0'0Wipe" Value2="1" Not="1" />
      </Operator>
      <Less Value1="?Player().Level" Value2="2" Not="1" />
    </Conditions>
    <Actions>
      <SetVariable Name="UpdateTo1'3'0'0Wipe" Value="1" />
      <SetVariable Name="UpdateTo1'6'0'0Wipe" Value="1" />
      <SetVariable Name="UpdateTo1'7'0'1Wipe1" Value="1" />
      <SetVariable Name="UpdateTo1'8'0'0Wipe" Value="1" />
      <ClearQuestQueue Name="ScriptsResumeOnStart" />
      <Dialog Type="NoAvatar" Title="dlgSenseiProfile" >
        <Line Text="update_1300_wipe" />
        <Button Type="Right" Color="Beige" Text="dlgStoryBtnOk">
          <ChangeScene Destination="Profile" />
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="EclipseModeTutorial">
    <Events>
      <ChangeTab />
    </Events>
    <Conditions>
      <Equal Value1="_EclipseModeEnabled" Value2="1" />
      <Equal Value1="_$SceneTo" Value2="Map" />
      <GreaterEqual Value1="?Fight(ZONE_1|Tournament|16).WinCount" Value2="1" />
    </Conditions>
    <Actions Place="Map">
      <ToggleEclipseMode Toggle="Off"/>
      <HideMapButton Name="EclipseModeOff"/>
      <ShowMapButton Name="EclipseModeOn" X="?Sub(?Div(?Multi(768, ?SysInfo().DisplayWidth), ?SysInfo().DisplayHeight),440)" Y="600" Image="sun_icon"/>
      <SetMapMask Color="0xffffff00" />
      <ChangeScene Destination="Map" />
      <SetMapFocus Battle="_EclipseModeTutorialFight" />
      <Dialog Type="Regular" Title="characterSensei" Image="character_sensei">
        <Line Text="tutorial_eclipsemode_beginning1"/>
        <Button Type="Right" Color="Beige" Text="dlgStoryBtnMore" />
      </Dialog>
      <Dialog Type="Regular" Title="characterSensei" Image="character_sensei">
        <Line Text="tutorial_eclipsemode_beginning2"/>
        <Button Type="Right" Color="Beige" Text="dlgStoryBtnMore" />
      </Dialog>
      <Dialog Type="Regular" Title="characterSensei" Image="character_sensei">
        <Line Text="tutorial_eclipsemode_switch"/>
        <Button Type="Right" Color="Beige" Text="dlgStoryBtnMore" />
      </Dialog>
      <ShowEclipseModeTutorial />
      <SetVariable Name="InEclipseMode" Value="1" />
      <Dialog Type="Regular" Title="characterSensei" Image="character_sensei">
        <Line Text="tutorial_eclipsemode_switch_back"/>
        <Button Type="Right" Color="Beige" Text="dlgStoryBtnOk" />
      </Dialog>
      <SetVariable Name="EclipseModeEnabled" Value="2" />
    </Actions>
  </Quest>

  <Quest Name="EclipseModeTutorialPart2">
    <Events>
      <FightEnd />
    </Events>
    <Conditions>
      <Equal Value1="_InEclipseMode" Value2="1" />
      <Equal Not="1" Value1="_EclipseModeTutorialPart2" Value2="1" />
    </Conditions>
    <Actions>
      <Dialog Type="Regular" Title="characterSensei" Image="character_sensei">
        <Line Text="tutorial_eclipsemode_switch_back_2"/>
        <Button Type="Right" Color="Beige" Text="dlgStoryBtnOk" />
      </Dialog>
      <ShowEclipseModeSwitchBackTutorial />
      <SetVariable Name="EclipseModeTutorialPart2" Value="1" />
    </Actions>
  </Quest>

  <Quest Name="ForgeTutorial" Unresumable="1">
    <Events>
      <ChangeTab />
    </Events>
    <Conditions>
      <Equal Value1="_$SceneTo" Value2="Shop" />
      <Equal Value1="_ForgeEnabled" Value2="1" />
      <GreaterEqual Value1="_BestAcquiredArmorLevel" Value2="400" />
    </Conditions>
    <Actions>
      <OpenShop Tab="Armor" Item="_BestArmor" />
      <Dialog Type="Regular" Title="characterSensei" Image="character_sensei">
        <Line Text="tutorial_forge_beginning1"/>
        <Button Type="Right" Color="Beige" Text="dlgStoryThanks" />
      </Dialog>
      <Dialog Type="Regular" Title="characterSensei" Image="character_sensei">
        <Line Text="tutorial_forge_beginning2"/>
        <Button Type="Right" Color="Beige" Text="dlgStoryThanks" />
      </Dialog>
      <ShowForgeTutorial />
      <Dialog Type="Regular" Title="characterSensei" Image="character_sensei">
        <Line Text="tutorial_forge_ending"/>
        <Button Type="Right" Color="Beige" Text="dlgStoryThanks" />
      </Dialog>
      <SetVariable Name="ForgeEnabled" Value="2" />
    </Actions>
  </Quest>

  <Quest Name="FirstDuelAfterUpgrade" Group="FightEnter" Priority="1000">
    <Events>
      <FightEnter />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'4'0'0Mark" Value2="1" />
      <Operator Type="Or">
        <Equal Value1="?Fight(_$Fight).Battle" Value2="Duel" />
        <Equal Value1="?Fight(_$Fight).Battle" Value2="Duel_INTERMISSION" />
      </Operator>
      <Equal Not="1" Value1="_UpdateDuelTutorial1" Value2="1" />
      <Equal Not="1" Value1="_UpdateDuelTutorial2" Value2="1" />
    </Conditions>
    <Actions>
      <SetVariable Name="UpdateDuelTutorial1" Value="1" />
      <SetVariable Name="UpdateDuelTutorial2" Value="1" />
      <Fight Name="_$Fight" />
    </Actions>
  </Quest>

  <Quest Name="UpdateDuelTutorial1" Group="FightEnter" Priority="100">
    <Events>
      <FightEnter />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'4'0'0Mark" Value2="1" />
      <Operator Type="Or">
        <Equal Value1="?Fight(_$Fight).Battle" Value2="Duel" />
        <Equal Value1="?Fight(_$Fight).Battle" Value2="Duel_INTERMISSION" />
      </Operator>
      <Equal Not="1" Value1="_UpdateDuelTutorial1" Value2="1" />
      <Equal Not="1" Value1="?Fight(ZONE_1|BOSS_LYNX|2).WinCount" Value2="0" />
    </Conditions>
    <Actions>
      <ClearQuestQueue Name="DuelRun" />
      <ClearQuestQueue Name="DuelEnter" />
      <ClearQuestQueue Name="DuelEnterNoDescription" />
      <Dialog Type="Regular" Title="_Title_Assistant" Image="_Avatar_Assistant_1" >
        <Line Text="tutorial_girl_duel_1" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Beige" Text="dlgStoryBtnOk" />
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="UpdateDuelTutorial2" Group="FightEnter" Priority="100">
    <Events>
      <FightEnter />
    </Events>
    <Conditions>
      <Equal Value1="_UpdateTo1'4'0'0Mark" Value2="1" />
      <Operator Type="Or">
        <Equal Value1="?Fight(_$Fight).Battle" Value2="Duel" />
        <Equal Value1="?Fight(_$Fight).Battle" Value2="Duel_INTERMISSION" />
      </Operator>
      <Equal Not="1" Value1="_UpdateDuelTutorial2" Value2="1" />
      <Equal Not="1" Value1="?Fight(ZONE_2|BOSS_HERMIT|2).WinCount" Value2="0" />
    </Conditions>
    <Actions>
      <Dialog Type="Regular" Title="_Title_Assistant" Image="_Avatar_Assistant_1" >
        <Line Text="tutorial_girl_duel_2" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Beige" Text="dlgStoryBtnOk" />
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="StrangerAfterUpdate_Cancel" Group="CrutchKenji|FightEnter" Priority="998">
    <Events>
      <FightEnter />
    </Events>
    <Conditions>
      <Equal Value1="?Fight(_$Fight).Zone" Value2="Punchbag" Not="1" />
      <Equal Value1="_UpdateTo1'1'0'0Mark" Value2="1" />
      <Equal Value1="_CrutchStranger" Value2="1" Not="1" />
      <Less Value1="?Player().Level" Value2="2" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="CrutchStranger" Value="1" />
      <Fight Name="_$Fight" />
    </Actions>
  </Quest>

  <Quest Name="StrangerAfterUpdate2" Group="CrutchKenji|FightEnter" Priority="800">
    <Events>
      <FightEnter />
    </Events>
    <Conditions>
      <Equal Value1="?Fight(_$Fight).Zone" Value2="Punchbag" Not="1" />
      <Equal Value1="?Fight(_$Fight).Battle" Value2="Stranger" Not="1" />
      <Equal Not="1" Value1="?Fight(_$Fight).Battle" Value2="Ambush1400" />
      <Equal Not="1" Value1="?Fight(_$Fight).Battle" Value2="Duel" />
      <Equal Not="1" Value1="?Fight(_$Fight).Battle" Value2="Challenge" />
      <Equal Value1="_UpdateTo1'1'0'0Mark" Value2="1" />
      <Equal Value1="_CrutchStranger" Value2="1" Not="1" />
      <Equal Value1="?Player().Level" Value2="2" />
    </Conditions>
    <Actions Place="Map">
      <Dialog Type="Regular" Title="NAME_KENJI" Image="man_kungfu" >
        <Line Text="zone_1_Kenji_crutch" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Beige" Text="dlgStoryBtnFight">
          <Fight Name="ZONE_1|Stranger|2" />
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="StrangerAfterUpdate3" Group="CrutchKenji|FightEnter" Priority="800">
    <Events>
      <FightEnter />
    </Events>
    <Conditions>
      <Equal Value1="?Fight(_$Fight).Zone" Value2="Punchbag" Not="1" />
      <Equal Value1="?Fight(_$Fight).Battle" Value2="Stranger" Not="1" />
      <Equal Not="1" Value1="?Fight(_$Fight).Battle" Value2="Ambush1400" />
      <Equal Not="1" Value1="?Fight(_$Fight).Battle" Value2="Duel" />
      <Equal Not="1" Value1="?Fight(_$Fight).Battle" Value2="Challenge" />
      <Equal Value1="_UpdateTo1'1'0'0Mark" Value2="1" />
      <Equal Value1="_CrutchStranger" Value2="1" Not="1" />
      <Equal Value1="?Player().Level" Value2="3" />
    </Conditions>
    <Actions Place="Map">
      <Dialog Type="Regular" Title="NAME_KENJI" Image="man_kungfu" >
        <Line Text="zone_1_Kenji_crutch" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Beige" Text="dlgStoryBtnFight">
          <Fight Name="ZONE_1|Stranger|3" />
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="StrangerAfterUpdate4" Group="CrutchKenji|FightEnter" Priority="800">
    <Events>
      <FightEnter />
    </Events>
    <Conditions>
      <Equal Value1="?Fight(_$Fight).Zone" Value2="Punchbag" Not="1" />
      <Equal Value1="?Fight(_$Fight).Battle" Value2="Stranger" Not="1" />
      <Equal Not="1" Value1="?Fight(_$Fight).Battle" Value2="Ambush1400" />
      <Equal Not="1" Value1="?Fight(_$Fight).Battle" Value2="Duel" />
      <Equal Not="1" Value1="?Fight(_$Fight).Battle" Value2="Challenge" />
      <Equal Value1="_UpdateTo1'1'0'0Mark" Value2="1" />
      <Equal Value1="_CrutchStranger" Value2="1" Not="1" />
      <Equal Value1="?Player().Level" Value2="4" />
    </Conditions>
    <Actions Place="Map">
      <Dialog Type="Regular" Title="NAME_KENJI" Image="man_kungfu" >
        <Line Text="zone_1_Kenji_crutch" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Beige" Text="dlgStoryBtnFight">
          <Fight Name="ZONE_1|Stranger|4" />
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="StrangerAfterUpdate5" Group="CrutchKenji|FightEnter" Priority="800">
    <Events>
      <FightEnter />
    </Events>
    <Conditions>
      <Equal Value1="?Fight(_$Fight).Zone" Value2="Punchbag" Not="1" />
      <Equal Value1="?Fight(_$Fight).Battle" Value2="Stranger" Not="1" />
      <Equal Not="1" Value1="?Fight(_$Fight).Battle" Value2="Ambush1400" />
      <Equal Not="1" Value1="?Fight(_$Fight).Battle" Value2="Duel" />
      <Equal Not="1" Value1="?Fight(_$Fight).Battle" Value2="Challenge" />
      <Equal Value1="_UpdateTo1'1'0'0Mark" Value2="1" />
      <Equal Value1="_CrutchStranger" Value2="1" Not="1" />
      <Equal Value1="?Player().Level" Value2="5" />
    </Conditions>
    <Actions Place="Map">
      <Dialog Type="Regular" Title="NAME_KENJI" Image="man_kungfu" >
        <Line Text="zone_1_Kenji_crutch" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Beige" Text="dlgStoryBtnFight">
          <Fight Name="ZONE_1|Stranger|5" />
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="StrangerAfterUpdate6" Group="CrutchKenji|FightEnter" Priority="800">
    <Events>
      <FightEnter />
    </Events>
    <Conditions>
      <Equal Value1="?Fight(_$Fight).Zone" Value2="Punchbag" Not="1" />
      <Equal Value1="?Fight(_$Fight).Battle" Value2="Stranger" Not="1" />
      <Equal Not="1" Value1="?Fight(_$Fight).Battle" Value2="Ambush1400" />
      <Equal Not="1" Value1="?Fight(_$Fight).Battle" Value2="Duel" />
      <Equal Not="1" Value1="?Fight(_$Fight).Battle" Value2="Challenge" />
      <Equal Value1="_UpdateTo1'1'0'0Mark" Value2="1" />
      <Equal Value1="_CrutchStranger" Value2="1" Not="1" />
      <Equal Value1="?Player().Level" Value2="6" />
    </Conditions>
    <Actions Place="Map">
      <Dialog Type="Regular" Title="NAME_KENJI" Image="man_kungfu" >
        <Line Text="zone_1_Kenji_crutch" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Beige" Text="dlgStoryBtnFight">
          <Fight Name="ZONE_1|Stranger|6" />
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="StrangerAfterUpdate7" Group="CrutchKenji|FightEnter" Priority="800">
    <Events>
      <FightEnter />
    </Events>
    <Conditions>
      <Equal Value1="?Fight(_$Fight).Zone" Value2="Punchbag" Not="1" />
      <Equal Value1="?Fight(_$Fight).Battle" Value2="Stranger" Not="1" />
      <Equal Not="1" Value1="?Fight(_$Fight).Battle" Value2="Ambush1400" />
      <Equal Value1="_UpdateTo1'2'0'0Mark" Value2="1" />
      <Equal Value1="_CrutchStranger2" Value2="1" Not="1" />
      <Equal Value1="?Fight(ZONE_3|BOSS_BUTCHER|6).WinCount" Value2="0" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <Dialog Type="Regular" Title="NAME_KENJI" Image="man_kungfu" >
        <Line Text="zone_1_Kenji_crutch" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Beige" Text="dlgStoryBtnFight">
          <Fight Name="ZONE_1|Stranger|7" />
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="StrangerAfterUpdate8" Group="CrutchKenji|FightEnter" Priority="800">
    <Events>
      <FightEnter />
    </Events>
    <Conditions>
      <Equal Value1="?Fight(_$Fight).Zone" Value2="Punchbag" Not="1" />
      <Equal Value1="?Fight(_$Fight).Battle" Value2="Stranger" Not="1" />
      <Equal Not="1" Value1="?Fight(_$Fight).Battle" Value2="Ambush1400" />
      <Equal Value1="_UpdateTo1'3'0'0Mark" Value2="1" />
      <Equal Value1="_CrutchStranger3" Value2="1" Not="1" />
      <Equal Value1="?Fight(ZONE_4|BOSS_WASP|6).WinCount" Value2="0" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <Dialog Type="Regular" Title="NAME_KENJI" Image="man_kungfu" >
        <Line Text="zone_1_Kenji_crutch" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Beige" Text="dlgStoryBtnFight">
          <Fight Name="ZONE_1|Stranger|8" />
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="Ambush1400" Group="Ambush|FightEnter" Priority="801" >
    <Events>
      <FightEnter />
    </Events>
    <Conditions>
      <Equal Not="1" Value1="?Fight(_$Fight).Zone" Value2="Punchbag" />
      <Equal Not="1" Value1="?Fight(_$Fight).Battle" Value2="Duel" />
      <Equal Value1="_UpdateTo1'4'0'0Mark" Value2="1" />
      <Equal Value1="_Ambush1400" Value2="1" Not="1" />
      <Equal Value1="?Fight(_$Fight).Battle" Value2="Stranger" Not="1" />
      <Operator Type="Or">
        <Equal Value1="_PreUpdateLevel" Value2="9" />
        <Equal Value1="_PreUpdateLevel" Value2="10" />
        <Equal Value1="_PreUpdateLevel" Value2="14" />
        <Equal Value1="_PreUpdateLevel" Value2="15" />
        <Equal Value1="_PreUpdateLevel" Value2="16" />
        <Equal Value1="_PreUpdateLevel" Value2="17" />
        <Equal Value1="_PreUpdateLevel" Value2="18" />
        <Equal Value1="_PreUpdateLevel" Value2="19" />
        <Equal Value1="_PreUpdateLevel" Value2="20" />
        <Equal Value1="_PreUpdateLevel" Value2="21" />
        <Equal Value1="_PreUpdateLevel" Value2="22" />
        <Equal Value1="_PreUpdateLevel" Value2="23" />
        <Equal Value1="_PreUpdateLevel" Value2="24" />
        <Equal Value1="_PreUpdateLevel" Value2="26" />
        <Equal Value1="_PreUpdateLevel" Value2="27" />
        <Equal Value1="_PreUpdateLevel" Value2="28" />
        <Equal Value1="_PreUpdateLevel" Value2="29" />
        <Equal Value1="_PreUpdateLevel" Value2="30" />
      </Operator>
    </Conditions>
    <Actions>
      <ClearQuestQueue Name="CrutchKenji" />
      <Dialog Type="Regular" Title="Ambush1400_title" Image="ninja_man_knives" >
        <Line Text="Ambush1400_announce" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Beige" Text="dlgStoryBtnFight">
          <Fight Name="?Concat(ZONE_1|Ambush1400|,_PreUpdateLevel)" />
          <ClearQuestQueue />
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="Ambush1400Alt" Group="Ambush|FightEnter" Priority="1500" >
    <Events>
      <FightEnter />
    </Events>
    <Conditions>
      <Equal Not="1" Value1="?Fight(_$Fight).Zone" Value2="Punchbag" />
      <Equal Not="1" Value1="?Fight(_$Fight).Battle" Value2="Duel" />
      <Equal Value1="_UpdateTo1'4'0'0Mark" Value2="1" />
      <Equal Value1="_Ambush1400" Value2="1" Not="1" />
      <Equal Value1="?Fight(_$Fight).Battle" Value2="Stranger" Not="1" />
      <Operator Type="Or" Not="1">
        <Equal Value1="_PreUpdateLevel" Value2="9" />
        <Equal Value1="_PreUpdateLevel" Value2="10" />
        <Equal Value1="_PreUpdateLevel" Value2="14" />
        <Equal Value1="_PreUpdateLevel" Value2="15" />
        <Equal Value1="_PreUpdateLevel" Value2="16" />
        <Equal Value1="_PreUpdateLevel" Value2="17" />
        <Equal Value1="_PreUpdateLevel" Value2="18" />
        <Equal Value1="_PreUpdateLevel" Value2="19" />
        <Equal Value1="_PreUpdateLevel" Value2="20" />
        <Equal Value1="_PreUpdateLevel" Value2="21" />
        <Equal Value1="_PreUpdateLevel" Value2="22" />
        <Equal Value1="_PreUpdateLevel" Value2="23" />
        <Equal Value1="_PreUpdateLevel" Value2="24" />
        <Equal Value1="_PreUpdateLevel" Value2="26" />
        <Equal Value1="_PreUpdateLevel" Value2="27" />
        <Equal Value1="_PreUpdateLevel" Value2="28" />
        <Equal Value1="_PreUpdateLevel" Value2="29" />
        <Equal Value1="_PreUpdateLevel" Value2="30" />
      </Operator>
    </Conditions>
    <Actions>
      <SetVariable Name="Ambush1400" Value="1" />
      <ClearQuestQueue />
      <Fight Name="_$Fight" />
    </Actions>
  </Quest>

  <Quest Name="Ambush1400CleanUp" Group="Ambush" Priority="1500" >
    <Events>
      <FightEnd />
    </Events>
    <Conditions>
      <Equal Value1="?Fight(_$Fight).Battle" Value2="Ambush1400" />
    </Conditions>
    <Actions>
      <SetVariable Name="Ambush1400" Value="1" />
      <Dialog Type="Regular" Title="_Title_Assistant" Image="_Avatar_Assistant_1" >
        <Line Text="Ambush1400_over" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Beige" Text="dlgStoryBtnOk"/>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="StrangerAfterUpdate7Alt" Group="CrutchKenji|FightEnter" Priority="998">
    <Events>
      <FightEnter />
    </Events>
    <Conditions>
      <Equal Value1="?Fight(_$Fight).Zone" Value2="Punchbag" Not="1" />
      <Equal Value1="?Fight(_$Fight).Battle" Value2="Stranger" Not="1" />
      <Equal Value1="_UpdateTo1'2'0'0Mark" Value2="1" />
      <Equal Value1="_CrutchStranger2" Value2="1" Not="1" />
      <Equal Value1="?Fight(ZONE_3|BOSS_BUTCHER|6).WinCount" Value2="0" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="CrutchStranger2" Value="1" />
      <ClearQuestQueue />
      <Fight Name="_$Fight" />
    </Actions>
  </Quest>

  <Quest Name="StrangerAfterUpdate8Alt" Group="CrutchKenji|FightEnter" Priority="998">
    <Events>
      <FightEnter />
    </Events>
    <Conditions>
      <Equal Value1="?Fight(_$Fight).Zone" Value2="Punchbag" Not="1" />
      <Equal Value1="?Fight(_$Fight).Battle" Value2="Stranger" Not="1" />
      <Equal Value1="_UpdateTo1'3'0'0Mark" Value2="1" />
      <Equal Value1="_CrutchStranger3" Value2="1" Not="1" />
      <Equal Value1="?Fight(ZONE_4|BOSS_WASP|6).WinCount" Value2="0" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="CrutchStranger3" Value="1" />
      <ClearQuestQueue />
      <Fight Name="_$Fight" />
    </Actions>
  </Quest>

  <Quest Name="StrangerAfterUpdate_cleanup" Priority="998">
    <Events>
      <FightEnd />
    </Events>
    <Conditions>
      <Operator Type="Or">
        <Equal Value1="_$Fight" Value2="ZONE_1|Stranger|2" />
        <Equal Value1="_$Fight" Value2="ZONE_1|Stranger|3" />
        <Equal Value1="_$Fight" Value2="ZONE_1|Stranger|4" />
        <Equal Value1="_$Fight" Value2="ZONE_1|Stranger|5" />
        <Equal Value1="_$Fight" Value2="ZONE_1|Stranger|6" />
        <Equal Value1="_$Fight" Value2="ZONE_1|Stranger|7" />
        <Equal Value1="_$Fight" Value2="ZONE_1|Stranger|8" />
      </Operator>
      <Equal Value1="_$FightResult" Value2="Win" />
    </Conditions>
    <Actions Place="Map">
      <SetVariable Name="CrutchStranger" Value="1" />
      <SetVariable Name="CrutchStranger2" Value="1" />
      <SetVariable Name="CrutchStranger3" Value="1" />
    </Actions>
  </Quest>

  <Quest Name="PurchaseUnsuccessful_Verification" Priority="9999" Unresumable="1">
    <Events>
      <PurchaseUnsuccessful />
    </Events>
    <Conditions>
      <Equal Value1="?Purchase(_$PurchaseUnsuccessful).Failure" Value2="Verification" />
    </Conditions>
    <Actions>
      <Dialog Type="NoAvatar" Title="payFailedTitle" >
        <Line Text="payFailedMessage" ButtonText="dlgStoryBtnMore" />
        <Button Type="Left" Color="Beige" Text="payFailedButton" />
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="PurchaseUnsuccessful_Connection" Priority="9999" Unresumable="1">
    <Events>
      <PurchaseUnsuccessful />
    </Events>
    <Conditions>
      <Equal Value1="?Purchase(_$PurchaseUnsuccessful).Failure" Value2="Connection" />
    </Conditions>
    <Actions>
      <Dialog Type="NoAvatar" Title="dlgNotNetworkTitle" >
        <Line Text="dlgNotNetworkMessage" ButtonText="dlgStoryBtnMore" />
        <Button Type="Left" Color="Beige" Text="payFailedButton" />
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="PurchaseUnsuccessful_Coins" Priority="9999" Unresumable="1">
    <Events>
      <PurchaseUnsuccessful />
    </Events>
    <Conditions>
      <Equal Value1="?Purchase(_$PurchaseUnsuccessful).Failure" Value2="Coins" />
    </Conditions>
    <Actions>
      <Dialog Type="Multiline" Title="_Title_Assistant" Image="_Avatar_Assistant_1" >
        <Line Text="dlgNotEnoughGoldMessage" ButtonText="dlgStoryBtnMore" />
        <Button Type="Left" Color="Red" Text="dlgStoryBtnCancel" >
        </Button>
        <Button Type="Right" Color="Green" Text="dlgBuyButton">
          <OpenShop Tab="Ruby" Item="_CurrentCoinItem"/>
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="PurchaseUnsuccessful_Ruby" Priority="9999" Unresumable="1">
    <Events>
      <PurchaseUnsuccessful />
      <EnchantmentUnsuccessful />
    </Events>
    <Conditions>
      <Operator Type="Or">
        <Equal Value1="?Purchase(_$PurchaseUnsuccessful).Failure" Value2="Ruby" />
        <Greater Value1="?Enchantment(_$Enchantment).Timeout" Value2="0" />
      </Operator>
    </Conditions>
    <Actions>
      <Dialog Type="Multiline" Title="_Title_Assistant" Image="_Avatar_Assistant_1" >
        <Line Text="dlgNotEnoughRubyMessage" ButtonText="dlgStoryBtnMore" />
        <Button Type="Left" Color="Red" Text="dlgStoryBtnCancel" >
          <Activate ActionID="FreeRubyReminder" />
        </Button>
        <Button Type="Right" Color="Green" Text="dlgBuyButton">
          <OpenShop Tab="Ruby" Item="Casket_Gems"/>
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="FreeReminderOnTabLeave" Unresumable="1">
    <Events>
      <ChangeTab />
    </Events>
    <Conditions>
      <Equal Value1="?SysInfo().Amazon" Value2="1" Not="1"/>
      <Equal Value1="?SysInfo().OsName" Value2="WP8" Not="1"/>
      <Equal Value1="?SysInfo().China" Value2="1" Not="1"/>
      <Greater Not="1" Value1="_DiscipleFlag" Value2="0" />
      <Equal Value1="_$TabFrom" Value2="Ruby" />
      <Equal Not="1" Value1="_$TabTo" Value2="Free" />
      <Equal Not="1" Value1="_$TabTo" Value2="Ruby" />
      <Equal Not="1" Value1="_FreeReminderShown" Value2="1" />
    </Conditions>
    <Actions>
      <SetVariable Name="FreeReminderShown" Value="1" />
      <Dialog Type="Multiline" Title="_Title_Assistant" Image="_Avatar_Assistant_3" >
        <Line Text="dlgFreeRubyReminder" ButtonText="dlgStoryBtnMore" />
        <Button Type="Left" Color="Red" Text="dlgStoryBtnNothanks">
          <ChangeScene Destination="_$SceneTo" />
          <ChangeTab Tab="_$TabTo" />
        </Button>
        <Button Type="Right" Color="Green" Text="dlgStoryBtnOk">
          <OpenShop Tab="Free" />
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="FreeReminder" Unresumable="1">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="?SysInfo().Amazon" Value2="1" Not="1"/>
      <Equal Value1="?SysInfo().China" Value2="1" Not="1"/>
      <Equal Value1="?SysInfo().OsName" Value2="WP8" Not="1"/>
      <Equal Not="1" Value1="_AdvertRate" Value2="0" />
      <Greater Not="1" Value1="_DiscipleFlag" Value2="0" />
      <Equal Value1="_$ActionID" Value2="FreeRubyReminder" />
      <Equal Not="1" Value1="_FreeReminderShown" Value2="1" />
    </Conditions>
    <Actions>
      <SetVariable Name="FreeReminderShown" Value="1" />
      <Dialog Type="Multiline" Title="_Title_Assistant" Image="_Avatar_Assistant_3" >
        <Line Text="dlgFreeRubyReminder" ButtonText="dlgStoryBtnMore" />
        <Button Type="Left" Color="Red" Text="dlgStoryBtnNothanks" />
        <Button Type="Right" Color="Green" Text="dlgStoryBtnOk">
          <OpenShop Tab="Free" />
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="FreeTabFocus" Unresumable="1">
    <Events>
      <ChangeTab />
    </Events>
    <Conditions>
      <Equal Value1="_$TabTo" Value2="Free" />
    </Conditions>
    <Actions>
      <OpenShop Tab="Free" Item="Tapjoy"/>
    </Actions>
  </Quest>

  <Quest Name="GetGift" Unresumable="1">
    <Events>
      <ServerCurrencyMessage />
    </Events>
    <Conditions>
      <Equal Value1="?Gift().Exist" Value2="1" />
    </Conditions>
    <Actions>
      <Activate ActionID="GetGift" />
    </Actions>
  </Quest>

  <Quest Name="GetGiftMoney" Priority="100" Unresumable="1">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="GetGift" />
      <Greater Value1="?Gift().Money" Value2="0" />
    </Conditions>
    <Actions>
      <Dialog Type="NoAvatar" Title="dlgAlertTitle" Sound="buy">
        <Line Text="dlgGotGift{textures/misc/gold.png}{?Gift().Money}" ButtonText="dlgStoryBtnOk" />
        <Button Type="Right" Text="dlgStoryBtnOk" />
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="GetGiftBonus" Priority="99" Unresumable="1">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="GetGift" />
      <Greater Value1="?Gift().Bonus" Value2="0" />
    </Conditions>
    <Actions>
      <Dialog Type="NoAvatar" Title="dlgAlertTitle" Sound="buy">
        <Line Text="dlgGotGift{textures/misc/ruby.png}{?Gift().Bonus}" ButtonText="dlgStoryBtnOk" />
        <Button Type="Right" Text="dlgStoryBtnOk" />
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="GetGiftItem" Priority="98" Unresumable="1">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="GetGift" />
      <Greater Value1="?Gift().Items" Value2="0" />
    </Conditions>
    <Actions>
      <Dialog Type="NoAvatar" Title="dlgAlertTitle" >
        <Line Text="dlgGotItems{?Gift().Items}" ButtonText="dlgStoryBtnOk" />
        <Button Type="Right" Text="dlgStoryBtnOk" />
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="FindCoinItem">
    <Conditions>
      <Equal Value1="?Item(_$Iterator).SubType" Value2="Gold" />
      <Equal Value1="?Item(_$Iterator).Availability" Value2="1" />
    </Conditions>
    <Actions>
      <SetVariable Name="CurrentCoinItem" Value="_$Iterator" />
    </Actions>
  </Quest>

  <Quest Name="SurvivalCounter">
    <Events>
      <FightEnd />
    </Events>
    <Conditions>
      <Operator Type="Or">
        <Equal Value1="?Fight(_$Fight).Battle" Value2="Survival" />
        <Equal Value1="?Fight(_$Fight).Battle" Value2="Survival_INTERMISSION" />
      </Operator>
    </Conditions>
    <Actions>
      <SetVariable Name="SurvivalsInARowCount" Value="?Sum(_SurvivalsInARowCount,1)" />
      <Activate ActionID="SurvivalReminder" />
    </Actions>
  </Quest>

  <Quest Name="SurvivalCounterReset" Priority="9999">
    <Events>
      <FightEnd />
    </Events>
    <Conditions>
      <Equal Not="1" Value1="?Fight(_$Fight).Battle" Value2="Survival" />
      <Equal Not="1" Value1="?Fight(_$Fight).Battle" Value2="Duel" />
      <Equal Not="1" Value1="?Fight(_$Fight).Battle" Value2="Survival_INTERMISSION" />
      <Equal Not="1" Value1="?Fight(_$Fight).Battle" Value2="Duel_INTERMISSION" />
    </Conditions>
    <Actions>
      <SetVariable Name="SurvivalsInARowCount" Value="0" />
    </Actions>
  </Quest>

  <Quest Name="SurvivalPayReminder" Priority="-1" Unresumable="1">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="SurvivalReminder" />
      <Operator Type="Or">
        <Operator Type="And">
          <Equal Value1="_SurvivalsInARowCount" Value2="3" />
          <Less Not="1" Value1="?Fight(ZONE_1|BOSS_LYNX|6).WinCount" Value2="1" />
        </Operator>
        <Equal Value1="_SurvivalsInARowCount" Value2="10" />
      </Operator>
    </Conditions>
    <Actions>
      <Dialog Type="Multiline" Title="_Title_Assistant" Image="_Avatar_Assistant_3" >
        <Line Text="dlgSurvivalPayReminder" ButtonText="dlgStoryBtnMore" />
        <Button Type="Left" Color="Red" Text="dlgLaterBtn" />
        <Button Type="Right" Color="Green" Text="dlgStoryBtnStore">
          <OpenShop Tab="Ruby" Item="_CurrentCoinItem"/>
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="TournamentsLeftReminderWrapper" Unresumable="1">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="FightsLeftReminder" />
      <GreaterEqual Not="1" Value1="?Fight(?Concat(ZONE_,?Sub(?Slice(_globZoneToCheck,5,5),1),|Tournament|24)).WinCount" Value2="1" />
    </Conditions>
    <Actions>
      <ClearQuestQueue Name="ChallengesLeftReminderWrapper" />
      <SetVariable Name="TournamentsLeftReminderFlag" Value="1" />
    </Actions>
  </Quest>

  <Quest Name="ChallengesLeftReminderWrapper" Unresumable="1">
    <Events>
      <Activate />
    </Events>
    <Conditions>
      <Equal Value1="_$ActionID" Value2="FightsLeftReminder" />
      <GreaterEqual Value1="?Fight(ZONE_2|BOSS_HERMIT|6).WinCount" Value2="1" />
      <GreaterEqual Not="1" Value1="?Fight(?Concat(ZONE_,?Sub(?Slice(_globZoneToCheck,5,5),1),|Challenge|24)).WinCount" Value2="1" />
    </Conditions>
    <Actions>
      <SetVariable Name="ChallengesLeftReminderFlag" Value="1" />
    </Actions>
  </Quest>

  <Quest Name="TournamentsLeftReminder" Unresumable="1" Group="FightsLeft">
    <Events>
      <ChangeTab />
    </Events>
    <Conditions>
      <Equal Value1="_TournamentsLeftReminderFlag" Value2="1" />
      <Equal Value1="_$SceneFrom" Value2="Map" />
      <Operator Type="Or">
        <Equal Value1="_$SceneTo" Value2="Shop" />
        <Equal Value1="_$SceneTo" Value2="Profile" />
      </Operator>
      <GreaterEqual Not="1" Value1="?Fight(?Concat(ZONE_,?Sub(?Slice(_globZoneToCheck,5,5),1),|Tournament|24)).WinCount" Value2="1" />
    </Conditions>
    <Actions>
      <SetVariable Name="TournamentsLeftReminderFlag" Value="0" />
      <ClearQuestQueue Name="ChallengesLeftReminder" />
      <Dialog Type="Multiline" Title="_Title_Assistant" Image="_Avatar_Assistant_3" >
        <Line Text="dlgFightsLeftReminder" ButtonText="dlgStoryBtnMore" />
        <Button Type="Left" Color="Red" Text="dlgLaterBtn" >
          <ChangeScene Destination="_$SceneTo" />
        </Button>
        <Button Type="Right" Color="Green" Text="dlgStoryBtnShowme">
          <SetMapFocus Battle="?Concat(ZONE_,?Sub(?Slice(_globZoneToCheck,5,5),1),|Tournament|)" Frames="100" />
          <Wait Frames="100" Lock="Silent" />
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="ChallengesLeftReminder" Unresumable="1" Group="FightsLeft">
    <Events>
      <ChangeTab />
    </Events>
    <Conditions>
      <Equal Value1="_ChallengesLeftReminderFlag" Value2="1" />
      <Equal Value1="_$SceneFrom" Value2="Map" />
      <Operator Type="Or">
        <Equal Value1="_$SceneTo" Value2="Shop" />
        <Equal Value1="_$SceneTo" Value2="Profile" />
      </Operator>
      <GreaterEqual Not="1" Value1="?Fight(?Concat(ZONE_,?Sub(?Slice(_globZoneToCheck,5,5),1),|Challenge|24)).WinCount" Value2="1" />
    </Conditions>
    <Actions>
      <SetVariable Name="ChallengesLeftReminderFlag" Value="0" />
      <Dialog Type="Multiline" Title="_Title_Assistant" Image="_Avatar_Assistant_3" >
        <Line Text="dlgFightsLeftReminder" ButtonText="dlgStoryBtnMore" />
        <Button Type="Left" Color="Red" Text="dlgLaterBtn" >
          <ChangeScene Destination="_$SceneTo" />
        </Button>
        <Button Type="Right" Color="Green" Text="dlgStoryBtnShowme">
          <SetMapFocus Battle="?Concat(ZONE_,?Sub(?Slice(_globZoneToCheck,5,5),1),|Challenge|)" Frames="100" />
          <Wait Frames="100" Lock="Silent" />
        </Button>
      </Dialog>
    </Actions>
  </Quest>

  <Quest Name="UpgradeToLevelReminder" Unresumable="1" >
    <Events>
      <Purchase />
    </Events>
    <Conditions>
      <GreaterEqual Value1="?Sub(?Multi(100,?Player().Level),?Purchase(_$Purchase).UpgradeLevel)" Value2="100" />
      <Operator Type="Or">
        <Equal Value1="?Purchase(_$Purchase).Type" Value2="Armor" />
        <Equal Value1="?Purchase(_$Purchase).Type" Value2="Weapon" />
        <Equal Value1="?Purchase(_$Purchase).Type" Value2="Helm" />
        <Equal Value1="?Purchase(_$Purchase).Type" Value2="Ranged" />
        <Equal Value1="?Purchase(_$Purchase).Type" Value2="Magic" />
      </Operator>
      <Equal Not="1" Value1="_UpgradeToLevelReminderShown" Value2="1" />
      <Equal Not="1" Value1="_UpgradeToLevelReminderCheckBox" Value2="1" />
    </Conditions>
    <Actions>
      <Dialog Type="Multiline" Title="_Title_Assistant" Image="_Avatar_Assistant_1" >
        <Line Text="dlgUpgradeToLevelReminder" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Text="dlgStoryThanks" Color="Green" />
        <CheckBox Text="dlgDontShowAgain" InitialValue="_UpgradeToLevelReminderCheckBox">
          <On>
            <SetVariable Name="UpgradeToLevelReminderCheckBox" Value="1" />
          </On>
          <Off>
            <SetVariable Name="UpgradeToLevelReminderCheckBox" Value="0" />
          </Off>
        </CheckBox>
      </Dialog>
      <SetVariable Name="UpgradeToLevelReminderShown" Value="1" />
    </Actions>
  </Quest>

  <Quest Name="LastBattleLost">
    <Events>
      <FightEnd />
    </Events>
    <Conditions>
      <Equal Not="1" Value1="_$FightResult" Value2="Win" />
    </Conditions>
    <Actions>
      <SetVariable Name="LastBattleLost" Value="1"/>
    </Actions>
  </Quest>

  <Quest Name="ShopAdviceArmor" Priority="-1">
    <Events>
      <ChangeTab />
    </Events>
    <Conditions>
      <LessEqual Value1="?Purchase(?Player().Armor).UpgradeLevel" Value2="?Sub(?Multi(?Player().Level,100),100)"/>
      <LessEqual Value1="?Purchase(?Player().Armor).UpgradeLevel" Value2="?Purchase(?Player().Weapon).UpgradeLevel"/>
      <LessEqual Value1="?Purchase(?Player().Armor).UpgradeLevel" Value2="?Purchase(?Player().Helm).UpgradeLevel"/>
      <Equal Value1="_$SceneTo" Value2="Shop" />
      <Equal Value1="_ShopAdviceOnCurrentLevel" Value2="1" Not="1"/>
      <Equal Value1="_LastBattleLost" Value2="1"/>
    </Conditions>
    <Actions>
      <OpenShop Tab="Armor" />
      <Dialog Type="Regular" Title="_Title_Assistant" Image="_Avatar_Assistant_3">
        <Line Text="dlgMayShop_Armor" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Green" Text="dlgStoryBtnShowme" />
      </Dialog>
      <ClearQuestQueue Name="ShopAdviceWeapon|ShopAdviceHelm" />
      <SetVariable Name="ShopAdviceOnCurrentLevel" Value="1"/>
      <SetVariable Name="LastBattleLost" Value="0"/>
    </Actions>
  </Quest>  

  <Quest Name="ShopAdviceWeapon" Priority="-1">
    <Events>
      <ChangeTab />
    </Events>
    <Conditions>
      <LessEqual Value1="?Purchase(?Player().Weapon).UpgradeLevel" Value2="?Sub(?Multi(?Player().Level,100),100)"/>
      <LessEqual Value1="?Purchase(?Player().Weapon).UpgradeLevel" Value2="?Purchase(?Player().Armor).UpgradeLevel"/>
      <LessEqual Value1="?Purchase(?Player().Weapon).UpgradeLevel" Value2="?Purchase(?Player().Helm).UpgradeLevel"/>
      <Equal Value1="_$SceneTo" Value2="Shop" />
      <Equal Value1="_ShopAdviceOnCurrentLevel" Value2="1" Not="1"/>
      <Equal Value1="_LastBattleLost" Value2="1"/>
    </Conditions>
    <Actions>
      <OpenShop Tab="Weapon" />
      <Dialog Type="Regular" Title="_Title_Assistant" Image="_Avatar_Assistant_3">
        <Line Text="dlgMayShop_Weapon" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Green" Text="dlgStoryBtnShowme" />
      </Dialog>
      <ClearQuestQueue Name="ShopAdviceHelm|ShopAdviceArmor" />
      <SetVariable Name="ShopAdviceOnCurrentLevel" Value="1"/>
      <SetVariable Name="LastBattleLost" Value="0"/>
    </Actions>
  </Quest>

  <Quest Name="ShopAdviceHelm" Priority="-1">
    <Events>
      <ChangeTab />
    </Events>
    <Conditions>
      <LessEqual Value1="?Purchase(?Player().Helm).UpgradeLevel" Value2="?Sub(?Multi(?Player().Level,100),100)"/>
      <LessEqual Value1="?Purchase(?Player().Helm).UpgradeLevel" Value2="?Purchase(?Player().Weapon).UpgradeLevel"/>
      <LessEqual Value1="?Purchase(?Player().Helm).UpgradeLevel" Value2="?Purchase(?Player().Armor).UpgradeLevel"/>
      <Equal Value1="_$SceneTo" Value2="Shop" />
      <Equal Value1="_ShopAdviceOnCurrentLevel" Value2="1" Not="1"/>
      <Equal Value1="_LastBattleLost" Value2="1"/>
    </Conditions>
    <Actions>
      <OpenShop Tab="Helm" />
      <Dialog Type="Regular" Title="_Title_Assistant" Image="_Avatar_Assistant_3">
        <Line Text="dlgMayShop_Helm" ButtonText="dlgStoryBtnMore" />
        <Button Type="Right" Color="Green" Text="dlgStoryBtnShowme" />
      </Dialog>
      <ClearQuestQueue Name="ShopAdviceWeapon|ShopAdviceArmor" />
      <SetVariable Name="ShopAdviceOnCurrentLevel" Value="1"/>
      <SetVariable Name="LastBattleLost" Value="0"/>
    </Actions>
  </Quest>

  <Quest Name="promo_MapButtonRemover_FirstPayment" Priority="999999" >
    <Events>
      <ApplicationStart />
      <FightEnd />
    </Events>
    <Conditions>
      <Greater Not="1" Value1="?Timer(Timer_FirstPayment).Value" Value2="0" />
    </Conditions>
    <Actions>
      <HideMapButton Name="Button_FirstPayment"/>
    </Actions>
  </Quest>

  <Quest Name="promo_MapButtonRemover_RepeatPayment" Priority="999999" >
    <Events>
      <ApplicationStart />
      <FightEnd />
    </Events>
    <Conditions>
      <Greater Not="1" Value1="?Timer(Timer_RepeatPayment).Value" Value2="0" />
    </Conditions>
    <Actions>
      <HideMapButton Name="Button_RepeatPayment"/>
    </Actions>
  </Quest>

  <Quest Name="promo_MapButtonRemover_IncreasePayment" Priority="999999" >
    <Events>
      <ApplicationStart />
      <FightEnd />
    </Events>
    <Conditions>
      <Greater Not="1" Value1="?Timer(Timer_IncreasePayment).Value" Value2="0" />
    </Conditions>
    <Actions>
      <HideMapButton Name="Button_IncreasePayment"/>
    </Actions>
  </Quest>

  <Quest Name="promo_MapButtonRemover_StarterPack" Priority="999999" >
    <Events>
      <ApplicationStart />
      <FightEnd />
    </Events>
    <Conditions>
      <Greater Not="1" Value1="?Timer(Timer_StarterPack).Value" Value2="0" />
    </Conditions>
    <Actions>
      <HideMapButton Name="Button_StarterPack"/>
    </Actions>
  </Quest>

  <Quest Name="ZONE_2_unlock_exception" Priority="980">
    <Events>
      <ApplicationStart />
    </Events>
    <Conditions>
      <Equal Value1="?Battle(ZONE_2|Survival).Available" Value2="1" Not="1" />
      <Less Value1="?Fight(ZONE_1|BOSS_LYNX|6).WinCount" Value2="1" Not="1" />
      <GreaterEqual Value1="?Fight(ZONE_6|FINAL_BATTLE|1).WinCount" Value2="1" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <AttachQuestFile File="assets/quest_extensions/zone_2/core.xml" />
      <AttachQuestFile File="assets/quest_extensions/zone_2/story.xml" />
      <ToggleItems Label="ZONE_1_DONATE" Toggle="off" />
      <ToggleItems Label="ZONE_2_DONATE" Toggle="on" />
      <GiveItem Name="drop_name_blueseal" PutOn="0" Quantity="1" />
      <HideBattle Name="ZONE_2|BOSS_HERMIT_LOCKED|" />
      <ShowBattle Name="ZONE_2|BOSS_HERMIT|" />
      <ShowBattle Name="ZONE_2|Tournament|" />
      <ShowBattle Name="ZONE_2|Duel|" Locked="1" />
      <ShowBattle Name="ZONE_2|Survival|" />
      <ShowBattle Name="ZONE_2|Challenge" Locked="1" />
      <SetMapFocus Battle="ZONE_2|BOSS_HERMIT|" />
      <SetVariable Name="promo_FirstPayment_Flag" Value="0" />
      <SetVariable Name="SurvivalsInARowCount" Value="0" />
      <Activate ActionID="FightsLeftReminder" />
    </Actions>
  </Quest>

  <Quest Name="ZONE_3_unlock_exception" Priority="980">
    <Events>
      <ApplicationStart />
    </Events>
    <Conditions>
      <Equal Value1="?Battle(ZONE_3|Survival).Available" Value2="1" Not="1" />
      <Less Value1="?Fight(ZONE_2|BOSS_HERMIT|6).WinCount" Value2="1" Not="1" />
      <GreaterEqual Value1="?Fight(ZONE_6|FINAL_BATTLE|1).WinCount" Value2="1" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <AttachQuestFile File="assets/quest_extensions/zone_3/core.xml" />
      <AttachQuestFile File="assets/quest_extensions/zone_3/story.xml" />
      <ToggleItems Label="ZONE_2_DONATE" Toggle="off" />
      <ToggleItems Label="ZONE_3_DONATE" Toggle="on" />
      <GiveItem Name="drop_name_greenseal" PutOn="0" Quantity="1" />
      <HideBattle Name="ZONE_3|BOSS_BUTCHER_LOCKED|" />
      <ShowBattle Name="ZONE_3|BOSS_BUTCHER|" />
      <ShowBattle Name="ZONE_3|Tournament|" />
      <ShowBattle Name="ZONE_3|Duel|" Locked="1" />
      <ShowBattle Name="ZONE_3|Survival|" />
      <ShowBattle Name="ZONE_3|Challenge|" Locked="1" />
      <SetMapFocus Battle="ZONE_3|BOSS_BUTCHER|" />
      <SetVariable Name="promo_FirstPayment_Flag" Value="0" />
      <SetVariable Name="SurvivalsInARowCount" Value="0" />
      <Activate ActionID="FightsLeftReminder" />
    </Actions>
  </Quest>

  <Quest Name="ZONE_4_unlock_exception" Priority="980">
    <Events>
      <ApplicationStart />
    </Events>
    <Conditions>
      <Equal Value1="?Battle(ZONE_4|Survival).Available" Value2="1" Not="1" />
      <Less Value1="?Fight(ZONE_3|BOSS_BUTCHER|6).WinCount" Value2="1" Not="1" />
      <GreaterEqual Value1="?Fight(ZONE_6|FINAL_BATTLE|1).WinCount" Value2="1" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <AttachQuestFile File="assets/quest_extensions/zone_4/core.xml" />
      <AttachQuestFile File="assets/quest_extensions/zone_4/story.xml" />
      <ToggleItems Label="ZONE_3_DONATE" Toggle="off" />
      <ToggleItems Label="ZONE_4_DONATE" Toggle="on" />
      <GiveItem Name="drop_name_redseal" PutOn="0" Quantity="1" />
      <HideBattle Name="ZONE_4|BOSS_WASP_LOCKED|" />
      <ShowBattle Name="ZONE_4|BOSS_WASP|" />
      <ShowBattle Name="ZONE_4|Tournament|" />
      <ShowBattle Name="ZONE_4|Duel|" Locked="1" />
      <ShowBattle Name="ZONE_4|Survival|" />
      <ShowBattle Name="ZONE_4|Challenge|" Locked="1" />
      <SetMapFocus Battle="ZONE_4|BOSS_WASP|" />
      <SetVariable Name="promo_FirstPayment_Flag" Value="0" />
      <SetVariable Name="SurvivalsInARowCount" Value="0" />
      <Activate ActionID="FightsLeftReminder" />
    </Actions>
  </Quest>

  <Quest Name="ZONE_5_unlock_exception" Priority="980">
    <Events>
      <ApplicationStart />
    </Events>
    <Conditions>
      <Equal Value1="?Battle(ZONE_5|Survival).Available" Value2="1" Not="1" />
      <Less Value1="?Fight(ZONE_4|BOSS_WASP|6).WinCount" Value2="1" Not="1" />
      <GreaterEqual Value1="?Fight(ZONE_6|FINAL_BATTLE|1).WinCount" Value2="1" Not="1" />
    </Conditions>
    <Actions Place="Map">
      <AttachQuestFile File="assets/quest_extensions/zone_5/core.xml" />
      <AttachQuestFile File="assets/quest_extensions/zone_5/story.xml" />
      <ToggleItems Label="ZONE_4_DONATE" Toggle="off" />
      <ToggleItems Label="ZONE_5_DONATE" Toggle="on" />
      <GiveItem Name="drop_name_purpleseal" PutOn="0" Quantity="1" />
      <HideBattle Name="ZONE_5|BOSS_HUNTRESS_LOCKED|" />
      <ShowBattle Name="ZONE_5|BOSS_HUNTRESS|" />
      <ShowBattle Name="ZONE_5|Tournament|" />
      <ShowBattle Name="ZONE_5|Duel|" Locked="1" />
      <ShowBattle Name="ZONE_5|Survival|" />
      <ShowBattle Name="ZONE_5|Challenge|" Locked="1" />
      <SetMapFocus Battle="ZONE_5|BOSS_HUNTRESS|" />
      <SetVariable Name="promo_FirstPayment_Flag" Value="0" />
      <SetVariable Name="SurvivalsInARowCount" Value="0" />
      <Activate ActionID="FightsLeftReminder" />
    </Actions>
  </Quest>

  <Quest Name="ZONE_6_unlock_exception" Priority="980">
    <Events>
      <ApplicationStart />
    </Events>
    <Conditions>
      <Equal Value1="?Battle(ZONE_6|Survival).Available" Value2="1" Not="1" />
      <Less Value1="?Fight(ZONE_5|BOSS_HUNTRESS|6).WinCount" Value2="1" Not="1" />
      <GreaterEqual Value1="?Fight(ZONE_6|FINAL_BATTLE|1).WinCount" Value2="1" Not="1" />
      <GreaterEqual Value1="?DataVersion().Production" Value2="1" />
      <GreaterEqual Value1="?DataVersion().Major" Value2="6" />
      <GreaterEqual Value1="?DataVersion().Minor" Value2="0" />
    </Conditions>
    <Actions Place="Map">
      <AttachQuestFile File="assets/quest_extensions/zone_6/story.xml" />
      <ToggleItems Label="ZONE_5_DONATE" Toggle="off" />
      <ToggleItems Label="ZONE_6_DONATE" Toggle="on" />
      <GiveItem Name="drop_name_orangeseal" PutOn="0" Quantity="1" />
      <HideBattle Name="ZONE_6|BOSS_SAMURAI_LOCKED|" />
      <ShowBattle Name="ZONE_6|BOSS_SAMURAI|" />
      <ShowBattle Name="ZONE_6|Tournament|" />
      <ShowBattle Name="ZONE_6|Duel|" Locked="1" />
      <ShowBattle Name="ZONE_6|Survival|" />
      <ShowBattle Name="ZONE_6|Challenge|" Locked="1" />
      <SetMapFocus Battle="ZONE_6|BOSS_SAMURAI|" />
      <SetVariable Name="promo_FirstPayment_Flag" Value="0" />
      <SetVariable Name="SurvivalsInARowCount" Value="0" />
      <Activate ActionID="FightsLeftReminder" />
    </Actions>
  </Quest>
</Quests>
